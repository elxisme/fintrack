var So=Object.defineProperty;var No=(s,e,t)=>e in s?So(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var $=(s,e,t)=>No(s,typeof e!="symbol"?e+"":e,t);import{r as j,a as Co,b as To,c as ve,R as Ji}from"./vendor-Cu3A5fdw.js";import{c as Xi}from"./store-BBwJGlAv.js";import{E as Ao,a as Qi,U as Oo,L as Eo,D as Zi,b as ea,H as ta,C as at,T as Ts,S as Po,M as Io,c as Do,d as Mo,W as Ro,e as Lo,R as As,P as wt,f as ar,g as Ks,h as gn,i as $o,j as Fo,F as sa,k as Bo,X as ye,B as qr,l as Vr,A as Uo,m as ra,n as Os,o as Es,p as yt,q as Ps,r as Is,s as na,t as zo,u as mn,v as or,w as Wo,x as Ho,y as qo,z as Vo,I as Ko,G as Go,J as Yo,K as Jo,N as Xo}from"./ui-DkTcTZQz.js";import{f as We,s as lr,e as Ct,a as Qo,b as Zo}from"./utils-D1mUarl-.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var ia={exports:{}},Gs={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var el=j,tl=Symbol.for("react.element"),sl=Symbol.for("react.fragment"),rl=Object.prototype.hasOwnProperty,nl=el.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,il={key:!0,ref:!0,__self:!0,__source:!0};function aa(s,e,t){var r,n={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)rl.call(e,r)&&!il.hasOwnProperty(r)&&(n[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:tl,type:s,key:i,ref:a,props:n,_owner:nl.current}}Gs.Fragment=sl;Gs.jsx=aa;Gs.jsxs=aa;ia.exports=Gs;var d=ia.exports,oa,pn=Co;oa=pn.createRoot,pn.hydrateRoot;const al="modulepreload",ol=function(s){return"/"+s},bn={},ts=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=ol(l),l in bn)return;bn[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":al,c||(u.as="script"),u.crossOrigin="",u.href=l,o&&u.setAttribute("nonce",o),document.head.appendChild(u),c)return new Promise((f,g)=>{u.addEventListener("load",f),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},ll=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ts(async()=>{const{default:r}=await Promise.resolve().then(()=>jt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Kr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class cl extends Kr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class dl extends Kr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class hl extends Kr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Cr;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(Cr||(Cr={}));var ul=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};class fl{constructor(e,{headers:t={},customFetch:r,region:n=Cr.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ll(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ul(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let o={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(o["x-region"]=l);let c;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=a):typeof a=="string"?(o["Content-Type"]="text/plain",c=a):typeof FormData<"u"&&a instanceof FormData?c=a:(o["Content-Type"]="application/json",c=JSON.stringify(a)));const h=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:c}).catch(p=>{throw new cl(p)}),u=h.headers.get("x-relay-error");if(u&&u==="true")throw new dl(h);if(!h.ok)throw new hl(h);let f=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield h.json():f==="application/octet-stream"?g=yield h.blob():f==="text/event-stream"?g=h:f==="multipart/form-data"?g=yield h.formData():g=yield h.text(),{data:g,error:null}}catch(n){return{data:null,error:n}}})}}var he={},Gr={},Ys={},ss={},Js={},Xs={},gl=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},_t=gl();const ml=_t.fetch,la=_t.fetch.bind(_t),ca=_t.Headers,pl=_t.Request,bl=_t.Response,jt=Object.freeze(Object.defineProperty({__proto__:null,Headers:ca,Request:pl,Response:bl,default:la,fetch:ml},Symbol.toStringTag,{value:"Module"})),xl=To(jt);var Qs={};Object.defineProperty(Qs,"__esModule",{value:!0});let yl=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Qs.default=yl;var da=ve&&ve.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Xs,"__esModule",{value:!0});const vl=da(xl),wl=da(Qs);let _l=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=vl.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,l;let c=null,h=null,u=null,f=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=x:h=JSON.parse(x))}const b=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),m=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");b&&m&&m.length>1&&(u=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(c={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,u=null,f=406,g="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const b=await i.text();try{c=JSON.parse(b),Array.isArray(c)&&i.status===404&&(h=[],c=null,f=200,g="OK")}catch{i.status===404&&b===""?(f=204,g="No Content"):c={message:b}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,f=200,g="OK"),c&&this.shouldThrowOnError)throw new wl.default(c)}return{error:c,data:h,count:u,status:f,statusText:g}});return this.shouldThrowOnError||(n=n.catch(i=>{var a,o,l;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Xs.default=_l;var kl=ve&&ve.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Js,"__esModule",{value:!0});const jl=kl(Xs);let Sl=class extends jl.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${l};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Js.default=Sl;var Nl=ve&&ve.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ss,"__esModule",{value:!0});const Cl=Nl(Js);let Tl=class extends Cl.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};ss.default=Tl;var Al=ve&&ve.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ys,"__esModule",{value:!0});const Tt=Al(ss);let Ol=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new Tt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new Tt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(l.length>0){const c=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",c.join(","))}}return new Tt.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new Tt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Tt.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Ys.default=Ol;var Zs={},er={};Object.defineProperty(er,"__esModule",{value:!0});er.version=void 0;er.version="0.0.0-automated";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.DEFAULT_HEADERS=void 0;const El=er;Zs.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${El.version}`};var ha=ve&&ve.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Gr,"__esModule",{value:!0});const Pl=ha(Ys),Il=ha(ss),Dl=Zs;let Ml=class ua{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Dl.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Pl.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new ua(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let l;r||n?(a=r?"HEAD":"GET",Object.entries(t).filter(([h,u])=>u!==void 0).map(([h,u])=>[h,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([h,u])=>{o.searchParams.append(h,u)})):(a="POST",l=t);const c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new Il.default({method:a,url:o,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Gr.default=Ml;var St=ve&&ve.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(he,"__esModule",{value:!0});he.PostgrestError=he.PostgrestBuilder=he.PostgrestTransformBuilder=he.PostgrestFilterBuilder=he.PostgrestQueryBuilder=he.PostgrestClient=void 0;const fa=St(Gr);he.PostgrestClient=fa.default;const ga=St(Ys);he.PostgrestQueryBuilder=ga.default;const ma=St(ss);he.PostgrestFilterBuilder=ma.default;const pa=St(Js);he.PostgrestTransformBuilder=pa.default;const ba=St(Xs);he.PostgrestBuilder=ba.default;const xa=St(Qs);he.PostgrestError=xa.default;var Rl=he.default={PostgrestClient:fa.default,PostgrestQueryBuilder:ga.default,PostgrestFilterBuilder:ma.default,PostgrestTransformBuilder:pa.default,PostgrestBuilder:ba.default,PostgrestError:xa.default};const{PostgrestClient:Ll,PostgrestQueryBuilder:Fg,PostgrestFilterBuilder:Bg,PostgrestTransformBuilder:Ug,PostgrestBuilder:zg,PostgrestError:Wg}=Rl;function $l(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Fl=$l(),Bl="2.11.15",Ul=`realtime-js/${Bl}`,zl="1.0.0",ya=1e4,Wl=1e3;var Ut;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ut||(Ut={}));var ae;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(ae||(ae={}));var ke;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(ke||(ke={}));var Tr;(function(s){s.websocket="websocket"})(Tr||(Tr={}));var nt;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(nt||(nt={}));class Hl{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+n));a=a+n;const l=r.decode(e.slice(a,a+i));a=a+i;const c=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class va{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var K;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(K||(K={}));const xn=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=ql(a,s,e,n),i),{})},ql=(s,e,t,r)=>{const n=e.find(o=>o.name===s),i=n==null?void 0:n.type,a=t[s];return i&&!r.includes(i)?wa(i,a):Ar(a)},wa=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return Yl(e,t)}switch(s){case K.bool:return Vl(e);case K.float4:case K.float8:case K.int2:case K.int4:case K.int8:case K.numeric:case K.oid:return Kl(e);case K.json:case K.jsonb:return Gl(e);case K.timestamp:return Jl(e);case K.abstime:case K.date:case K.daterange:case K.int4range:case K.int8range:case K.money:case K.reltime:case K.text:case K.time:case K.timestamptz:case K.timetz:case K.tsrange:case K.tstzrange:return Ar(e);default:return Ar(e)}},Ar=s=>s,Vl=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Kl=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},Gl=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},Yl=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const a=s.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>wa(e,o))}return s},Jl=s=>typeof s=="string"?s.replace(" ","T"):s,_a=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class cr{constructor(e,t,r={},n=ya){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var yn;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(yn||(yn={}));class zt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=zt.syncState(this.state,n,i,a),this.pendingDiffs.forEach(l=>{this.state=zt.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=zt.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(c,h)=>{a[c]||(l[c]=h)}),this.map(a,(c,h)=>{const u=i[c];if(u){const f=h.map(m=>m.presence_ref),g=u.map(m=>m.presence_ref),p=h.filter(m=>g.indexOf(m.presence_ref)<0),b=u.filter(m=>f.indexOf(m.presence_ref)<0);p.length>0&&(o[c]=p),b.length>0&&(l[c]=b)}else o[c]=h}),this.syncDiff(i,{joins:o,leaves:l},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(o,l)=>{var c;const h=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),h.length>0){const u=e[o].map(g=>g.presence_ref),f=h.filter(g=>u.indexOf(g.presence_ref)<0);e[o].unshift(...f)}r(o,h,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const h=l.map(u=>u.presence_ref);c=c.filter(u=>h.indexOf(u.presence_ref)<0),e[o]=c,n(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var vn;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(vn||(vn={}));var wn;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(wn||(wn={}));var Me;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Me||(Me={}));class Yr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ae.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new cr(this,ke.join,this.params,this.timeout),this.rejoinTimer=new va(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ae.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ae.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=ae.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ae.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ke.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new zt(this),this.broadcastEndpointURL=_a(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ae.closed){const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(h=>e==null?void 0:e(Me.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(Me.CLOSED));const l={},c={broadcast:i,presence:a,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var u;if(this.socket.setAuth(),h===void 0){e==null||e(Me.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,g=(u=f==null?void 0:f.length)!==null&&u!==void 0?u:0,p=[];for(let b=0;b<g;b++){const m=f[b],{filter:{event:x,schema:w,table:y,filter:v}}=m,k=h&&h[b];if(k&&k.event===x&&k.schema===w&&k.table===y&&k.filter===v)p.push(Object.assign(Object.assign({},m),{id:k.id}));else{this.unsubscribe(),this.state=ae.errored,e==null||e(Me.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(Me.SUBSCRIBED);return}}).receive("error",h=>{this.state=ae.errored,e==null||e(Me.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Me.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ae.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ke.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new cr(this,ke.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new cr(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:h}=ke;if(r&&[o,l,c,h].indexOf(a)>=0&&r!==this._joinRef())return;let f=this._onMessage(a,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(g=>{var p,b,m;return((p=g.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(b=g.filter)===null||b===void 0?void 0:b.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===a}).map(g=>g.callback(f,r)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var p,b,m,x,w,y;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const v=g.id,k=(p=g.filter)===null||p===void 0?void 0:p.event;return v&&((b=t.ids)===null||b===void 0?void 0:b.includes(v))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const v=(w=(x=g==null?void 0:g.filter)===null||x===void 0?void 0:x.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return v==="*"||v===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:b,table:m,commit_timestamp:x,type:w,errors:y}=p;f=Object.assign(Object.assign({},{schema:b,table:m,commit_timestamp:x,eventType:w,new:{},old:{},errors:y}),this._getPayloadRecords(p))}g.callback(f,r)})}_isClosed(){return this.state===ae.closed}_isJoined(){return this.state===ae.joined}_isJoining(){return this.state===ae.joining}_isLeaving(){return this.state===ae.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Yr.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ke.close,{},e)}_onError(e){this._on(ke.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ae.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=xn(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=xn(e.columns,e.old_record)),t}}const _n=()=>{},Xl=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ql{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ya,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=_n,this.ref=0,this.logger=_n,this.conn=null,this.sendBuffer=[],this.serializer=new Hl,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>ts(async()=>{const{default:l}=await Promise.resolve().then(()=>jt);return{default:l}},void 0).then(({default:l})=>l(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${Tr.websocket}`,this.httpEndpoint=_a(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new va(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Fl),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:zl}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ut.connecting:return nt.Connecting;case Ut.open:return nt.Open;case Ut.closing:return nt.Closing;default:return nt.Closed}}isConnected(){return this.connectionState()===nt.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new Yr(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:n,ref:i}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Ul};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(ke.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Wl,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:i,ref:a}=t;r==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${a&&"("+a+")"||""}`,i),Array.from(this.channels).filter(o=>o._isMember(r)).forEach(o=>o._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ke.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Xl],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Jr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function re(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class Zl extends Jr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Or extends Jr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ec=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};const ka=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ts(async()=>{const{default:r}=await Promise.resolve().then(()=>jt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},tc=()=>ec(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ts(()=>Promise.resolve().then(()=>jt),void 0)).Response:Response}),Er=s=>{if(Array.isArray(s))return s.map(t=>Er(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Er(r)}),e};var dt=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};const dr=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),sc=(s,e,t)=>dt(void 0,void 0,void 0,function*(){const r=yield tc();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{e(new Zl(dr(n),s.status||500))}).catch(n=>{e(new Or(dr(n),n))}):e(new Or(dr(s),s))}),rc=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),t))};function rs(s,e,t,r,n,i){return dt(this,void 0,void 0,function*(){return new Promise((a,o)=>{s(t,rc(e,r,n,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>sc(l,o,r))})})}function Ds(s,e,t,r){return dt(this,void 0,void 0,function*(){return rs(s,"GET",e,t,r)})}function Ue(s,e,t,r,n){return dt(this,void 0,void 0,function*(){return rs(s,"POST",e,r,n,t)})}function nc(s,e,t,r,n){return dt(this,void 0,void 0,function*(){return rs(s,"PUT",e,r,n,t)})}function ic(s,e,t,r){return dt(this,void 0,void 0,function*(){return rs(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function ja(s,e,t,r,n){return dt(this,void 0,void 0,function*(){return rs(s,"DELETE",e,r,n,t)})}var ce=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};const ac={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class oc{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ka(n)}uploadOrUpdate(e,t,r,n){return ce(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},kn),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield u.json();return u.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(re(i))return{data:null,error:i};throw i}})}upload(e,t,r){return ce(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return ce(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:kn.upsert},n),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType);const u=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:h}),f=yield u.json();return u.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(re(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return ce(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield Ue(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new Jr("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}update(e,t,r){return ce(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ce(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(re(n))return{data:null,error:n};throw n}})}copy(e,t,r){return ce(this,void 0,void 0,function*(){try{return{data:{path:(yield Ue(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(re(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return ce(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield Ue(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(re(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return ce(this,void 0,void 0,function*(){try{const n=yield Ue(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(re(n))return{data:null,error:n};throw n}})}download(e,t){return ce(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Ds(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(re(o))return{data:null,error:o};throw o}})}info(e){return ce(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Ds(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Er(r),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}exists(e){return ce(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield ic(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(re(r)&&r instanceof Or){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${c}`)}}}remove(e){return ce(this,void 0,void 0,function*(){try{return{data:yield ja(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}list(e,t,r){return ce(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},ac),t),{prefix:e||""});return{data:yield Ue(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(re(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const lc="2.7.1",cc={"X-Client-Info":`storage-js/${lc}`};var ht=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};class dc{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},cc),t),this.fetch=ka(r)}listBuckets(){return ht(this,void 0,void 0,function*(){try{return{data:yield Ds(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(re(e))return{data:null,error:e};throw e}})}getBucket(e){return ht(this,void 0,void 0,function*(){try{return{data:yield Ds(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ht(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ht(this,void 0,void 0,function*(){try{return{data:yield nc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ht(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ht(this,void 0,void 0,function*(){try{return{data:yield ja(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}}class hc extends dc{constructor(e,t={},r){super(e,t,r)}from(e){return new oc(this.url,this.headers,e,this.fetch)}}const uc="2.50.2";let Dt="";typeof Deno<"u"?Dt="deno":typeof document<"u"?Dt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Dt="react-native":Dt="node";const fc={"X-Client-Info":`supabase-js-${Dt}/${uc}`},gc={headers:fc},mc={schema:"public"},pc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bc={};var xc=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};const yc=s=>{let e;return s?e=s:typeof fetch>"u"?e=la:e=fetch,(...t)=>e(...t)},vc=()=>typeof Headers>"u"?ca:Headers,wc=(s,e,t)=>{const r=yc(t),n=vc();return(i,a)=>xc(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:s;let c=new n(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},a),{headers:c}))})};var _c=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};function kc(s){return s.endsWith("/")?s:s+"/"}function jc(s,e){var t,r;const{db:n,auth:i,realtime:a,global:o}=s,{db:l,auth:c,realtime:h,global:u}=e,f={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},h),a),global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},(t=u==null?void 0:u.headers)!==null&&t!==void 0?t:{}),(r=o==null?void 0:o.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>_c(this,void 0,void 0,function*(){return""})};return s.accessToken?f.accessToken=s.accessToken:delete f.accessToken,f}const Sa="2.70.0",xt=30*1e3,Pr=3,hr=Pr*xt,Sc="http://localhost:9999",Nc="supabase.auth.token",Cc={"X-Client-Info":`gotrue-js/${Sa}`},Ir="X-Supabase-Api-Version",Na={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Tc=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ac=6e5;class Xr extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function R(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Oc extends Xr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Ec(s){return R(s)&&s.name==="AuthApiError"}class Ca extends Xr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ye extends Xr{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class Be extends Ye{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Pc(s){return R(s)&&s.name==="AuthSessionMissingError"}class as extends Ye{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class os extends Ye{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ls extends Ye{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ic(s){return R(s)&&s.name==="AuthImplicitGrantRedirectError"}class jn extends Ye{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Dr extends Ye{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ur(s){return R(s)&&s.name==="AuthRetryableFetchError"}class Sn extends Ye{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Wt extends Ye{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ms="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Nn=` 	
\r=`.split(""),Dc=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Nn.length;e+=1)s[Nn[e].charCodeAt(0)]=-2;for(let e=0;e<Ms.length;e+=1)s[Ms[e].charCodeAt(0)]=e;return s})();function Cn(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ms[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ms[r]),e.queuedBits-=6}}function Ta(s,e,t){const r=Dc[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function Tn(s){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=a=>{Lc(a,r,t)};for(let a=0;a<s.length;a+=1)Ta(s.charCodeAt(a),n,i);return e.join("")}function Mc(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Rc(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Mc(r,e)}}function Lc(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function $c(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)Ta(s.charCodeAt(n),t,r);return new Uint8Array(e)}function Fc(s){const e=[];return Rc(s,t=>e.push(t)),new Uint8Array(e)}function Bc(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>Cn(n,t,r)),Cn(null,t,r),e.join("")}function Uc(s){return Math.round(Date.now()/1e3)+s}function zc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const _e=()=>typeof window<"u"&&typeof document<"u",Xe={tested:!1,writable:!1},Ht=()=>{if(!_e())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Xe.tested)return Xe.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Xe.tested=!0,Xe.writable=!0}catch{Xe.tested=!0,Xe.writable=!1}return Xe.writable};function Wc(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Aa=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ts(async()=>{const{default:r}=await Promise.resolve().then(()=>jt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Hc=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Oa=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},cs=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ds=async(s,e)=>{await s.removeItem(e)};class tr{constructor(){this.promise=new tr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}tr.promiseConstructor=Promise;function fr(s){const e=s.split(".");if(e.length!==3)throw new Wt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Tc.test(e[r]))throw new Wt("JWT not in base64url format");return{header:JSON.parse(Tn(e[0])),payload:JSON.parse(Tn(e[1])),signature:$c(e[2]),raw:{header:e[0],payload:e[1]}}}async function qc(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function Vc(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await s(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function Kc(s){return("0"+s.toString(16)).substr(-2)}function Gc(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,Kc).join("")}async function Yc(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Jc(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await Yc(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ut(s,e,t=!1){const r=Gc();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await Oa(s,`${e}-code-verifier`,n);const i=await Jc(r);return[i,r===i?"plain":"s256"]}const Xc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Qc(s){const e=s.headers.get(Ir);if(!e||!e.match(Xc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Zc(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function ed(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const td=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ft(s){if(!td.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var sd=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const st=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),rd=[502,503,504];async function An(s){var e;if(!Hc(s))throw new Dr(st(s),0);if(rd.includes(s.status))throw new Dr(st(s),s.status);let t;try{t=await s.json()}catch(i){throw new Ca(st(i),i)}let r;const n=Qc(s);if(n&&n.getTime()>=Na["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Sn(st(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Be}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new Sn(st(t),s.status,t.weak_password.reasons);throw new Oc(st(t),s.status||500,r)}const nd=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function B(s,e,t,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[Ir]||(i[Ir]=Na["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await id(s,e,t+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function id(s,e,t,r,n,i){const a=nd(e,r,n,i);let o;try{o=await s(t,Object.assign({},a))}catch(l){throw console.error(l),new Dr(st(l),0)}if(o.ok||await An(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(l){await An(l)}}function Pe(s){var e;let t=null;cd(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Uc(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function On(s){const e=Pe(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function ze(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function ad(s){return{data:s,error:null}}function od(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,a=sd(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function ld(s){return s}function cd(s){return s.access_token&&s.refresh_token&&s.expires_in}const gr=["global","local","others"];var dd=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class hd{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Aa(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=gr[0]){if(gr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${gr.join(", ")}`);try{return await B(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(R(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await B(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ze})}catch(r){if(R(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=dd(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await B(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:od,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(R(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await B(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ze})}catch(t){if(R(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},h=await B(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:ld});if(h.error)throw h.error;const u=await h.json(),f=(a=h.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(p=>{const b=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=b}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(R(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){ft(e);try{return await B(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ze})}catch(t){if(R(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ft(e);try{return await B(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ze})}catch(r){if(R(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ft(e);try{return await B(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ze})}catch(r){if(R(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ft(e.userId);try{const{data:t,error:r}=await B(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(R(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ft(e.userId),ft(e.id);try{return{data:await B(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}}}const ud={getItem:s=>Ht()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{Ht()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{Ht()&&globalThis.localStorage.removeItem(s)}};function En(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function fd(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const gt={debug:!!(globalThis&&Ht()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ea extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class gd extends Ea{}async function md(s,e,t){gt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),gt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){gt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{gt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw gt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new gd(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(gt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}fd();const pd={url:Sc,storageKey:Nc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Cc,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Pn(s,e,t){return await t()}class Jt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jt.nextInstanceID,Jt.nextInstanceID+=1,this.instanceID>0&&_e()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},pd),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new hd({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Aa(n.fetch),this.lock=n.lock||Pn,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:_e()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=md:this.lock=Pn,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:Ht()?this.storage=ud:(this.memoryStorage={},this.storage=En(this.memoryStorage)):(this.memoryStorage={},this.storage=En(this.memoryStorage)),_e()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Sa}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Wc(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),_e()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Ic(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return R(t)?{error:t}:{error:new Ca("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:Pe}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(R(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:h,password:u,options:f}=e;let g=null,p=null;this.flowType==="pkce"&&([g,p]=await ut(this.storage,this.storageKey)),i=await B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:h,password:u,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:p},xform:Pe})}else if("phone"in e){const{phone:h,password:u,options:f}=e;i=await B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:u,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Pe})}else throw new os("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(R(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:On})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:On})}else throw new os("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new as}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,n,i,a,o,l,c,h,u,f,g;let p,b;if("message"in e)p=e.message,b=e.signature;else{const{chain:m,wallet:x,statement:w,options:y}=e;let v;if(_e())if(typeof x=="object")v=x;else{const N=window;if("solana"in N&&typeof N.solana=="object"&&("signIn"in N.solana&&typeof N.solana.signIn=="function"||"signMessage"in N.solana&&typeof N.solana.signMessage=="function"))v=N.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=x}const k=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in v&&v.signIn){const N=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),w?{statement:w}:null));let A;if(Array.isArray(N)&&N[0]&&typeof N[0]=="object")A=N[0];else if(N&&typeof N=="object"&&"signedMessage"in N&&"signature"in N)A=N;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)p=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),b=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${k.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(n=(r=y==null?void 0:y.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((u=(h=y==null?void 0:y.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||u===void 0)&&u.length?["Resources",...y.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const N=await v.signMessage(new TextEncoder().encode(p),"utf8");if(!N||!(N instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=N}}try{const{data:m,error:x}=await B(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Bc(b)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Pe});if(x)throw x;return!m||!m.session||!m.user?{data:{user:null,session:null},error:new as}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign({},m),error:x})}catch(m){if(R(m))return{data:{user:null,session:null},error:m};throw m}}async _exchangeCodeForSession(e){const t=await cs(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:a}=await B(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Pe});if(await ds(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new as}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(R(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:a}=e,o=await B(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Pe}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new as}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,i,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await ut(this.storage,this.storageKey));const{error:u}=await B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:h}=await B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:h}}throw new os("You must provide either an email or phone number.")}catch(o){if(R(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await B(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Pe});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(R(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await ut(this.storage,this.storageKey)),await B(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:ad})}catch(i){if(R(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Be;const{error:n}=await B(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(R(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:a}=await B(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:a,error:o}=await B(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new os("You must provide either an email or phone number and a type")}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await cs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<hr:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,h)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,h))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ze}):await this._useSession(async t=>{var r,n,i;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Be}:await B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:ze})})}catch(t){if(R(t))return Pc(t)&&(await this._removeSession(),await ds(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new Be;const a=n.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await ut(this.storage,this.storageKey));const{data:c,error:h}=await B(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:ze});if(h)throw h;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(R(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Be;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:a}=fr(e.access_token);if(a.exp&&(r=a.exp,n=r<=t),n){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(R(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Be;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!_e())throw new ls("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ls(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new jn("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ls("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new jn("No code detected.");const{data:w,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!i||!o||!a||!c)throw new ls("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(o);let f=h+u;l&&(f=parseInt(l));const g=f-h;g*1e3<=xt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const p=f-u;h-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,h):h-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,h);const{data:b,error:m}=await this._getUser(i);if(m)throw m;const x={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:u,expires_at:f,refresh_token:a,token_type:c,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(r){if(R(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await cs(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{error:i};const a=(r=n.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Ec(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await ds(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=zc(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await ut(this.storage,this.storageKey,!0));try{return await B(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(R(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var a,o,l,c,h;const{data:u,error:f}=i;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await B(this.fetch,"GET",g,{headers:this.headers,jwt:(h=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(n)throw n;return _e()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(R(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:a}=t;if(a)throw a;return await B(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(R(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Vc(async n=>(n>0&&await qc(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await B(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Pe})),(n,i)=>{const a=200*Math.pow(2,n);return i&&ur(i)&&Date.now()+a-r<xt})}catch(r){if(this._debug(t,"error",r),R(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),_e()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await cs(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<hr;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${hr}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),ur(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Be;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new tr;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Be;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),R(i)){const a={session:null,error:i};return ur(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Oa(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await ds(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&_e()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),xt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/xt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${xt}ms, refresh threshold is ${Pr} ticks`),n<=Pr&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ea)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!_e()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await ut(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await B(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(R(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await B(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(R(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await B(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(R(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await B(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(R(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=fr(n.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const h=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(a=>a.kid===e);if(r||(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+Ac>Date.now()))return r;const{data:n,error:i}=await B(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new Wt("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),r=n.keys.find(a=>a.kid===e),!r)throw new Wt("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:g,error:p}=await this.getSession();if(p||!g.session)return{data:null,error:p};r=g.session.access_token}const{header:n,payload:i,signature:a,raw:{header:o,payload:l}}=fr(r);if(Zc(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:i,header:n,signature:a},error:null}}const c=ed(n.alg),h=await this.fetchJwk(n.kid,t),u=await crypto.subtle.importKey("jwk",h,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,a,Fc(`${o}.${l}`)))throw new Wt("Invalid JWT signature");return{data:{claims:i,header:n,signature:a},error:null}}catch(r){if(R(r))return{data:null,error:r};throw r}}}Jt.nextInstanceID=0;const bd=Jt;class xd extends bd{constructor(e){super(e)}}var yd=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{c(r.next(h))}catch(u){a(u)}}function l(h){try{c(r.throw(h))}catch(u){a(u)}}function c(h){h.done?i(h.value):n(h.value).then(o,l)}c((r=r.apply(s,e||[])).next())})};class vd{constructor(e,t,r){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=kc(e),l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,h={db:mc,realtime:bc,auth:Object.assign(Object.assign({},pc),{storageKey:c}),global:gc},u=jc(r??{},h);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=wc(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Ll(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new fl(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new hc(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return yd(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:i,flowType:a,lock:o,debug:l},c,h){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new xd({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:a,lock:o,debug:l,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Ql(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const wd=(s,e,t)=>new vd(s,e,t),_d="https://pxnhxfwbookofnumbedz.supabase.co",kd="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bmh4Zndib29rb2ZudW1iZWR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NjI4MDIsImV4cCI6MjA2ODUzODgwMn0.doJ5lv5m09L2DSIbhmaEoMUm6oMuQoklmSxdNCLjIlQ",J=wd(_d,kd),$e=Xi((s,e)=>({user:null,userProfile:null,isAdmin:!1,loading:!0,signIn:async(t,r)=>{const{data:n,error:i}=await J.auth.signInWithPassword({email:t,password:r});if(i)throw i;s({user:n.user}),n.user&&await e().loadUserProfile()},signUp:async(t,r,n)=>{const{data:i,error:a}=await J.auth.signUp({email:t,password:r,options:{data:{full_name:n}}});if(a)throw a;i.user&&(s({user:i.user}),setTimeout(async()=>{await e().loadUserProfile()},1e3))},signOut:async()=>{const{error:t}=await J.auth.signOut();if(t)throw t;s({user:null,userProfile:null,isAdmin:!1})},loadUserProfile:async()=>{const{user:t}=e();if(!t){s({userProfile:null,isAdmin:!1});return}try{const{data:r,error:n}=await J.from("user_profiles").select("*").eq("id",t.id).single();if(n){console.error("Error loading user profile:",n),s({userProfile:null,isAdmin:!1});return}const i=(r==null?void 0:r.role)==="admin";s({userProfile:r,isAdmin:i})}catch(r){console.error("Error loading user profile:",r),s({userProfile:null,isAdmin:!1})}},initialize:async()=>{try{const{data:{user:t}}=await J.auth.getUser();s({user:t,loading:!1}),t&&await e().loadUserProfile(),J.auth.onAuthStateChange(async(r,n)=>{const i=(n==null?void 0:n.user)??null;s({user:i}),i?await e().loadUserProfile():s({userProfile:null,isAdmin:!1})})}catch(t){console.error("Auth initialization error:",t),s({loading:!1})}}})),jd=(s,e)=>e.some(t=>s instanceof t);let In,Dn;function Sd(){return In||(In=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Nd(){return Dn||(Dn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pa=new WeakMap,Mr=new WeakMap,Ia=new WeakMap,mr=new WeakMap,Qr=new WeakMap;function Cd(s){const e=new Promise((t,r)=>{const n=()=>{s.removeEventListener("success",i),s.removeEventListener("error",a)},i=()=>{t(Ve(s.result)),n()},a=()=>{r(s.error),n()};s.addEventListener("success",i),s.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Pa.set(t,s)}).catch(()=>{}),Qr.set(e,s),e}function Td(s){if(Mr.has(s))return;const e=new Promise((t,r)=>{const n=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",a),s.removeEventListener("abort",a)},i=()=>{t(),n()},a=()=>{r(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",i),s.addEventListener("error",a),s.addEventListener("abort",a)});Mr.set(s,e)}let Rr={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Mr.get(s);if(e==="objectStoreNames")return s.objectStoreNames||Ia.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ve(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Ad(s){Rr=s(Rr)}function Od(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=s.call(pr(this),e,...t);return Ia.set(r,e.sort?e.sort():[e]),Ve(r)}:Nd().includes(s)?function(...e){return s.apply(pr(this),e),Ve(Pa.get(this))}:function(...e){return Ve(s.apply(pr(this),e))}}function Ed(s){return typeof s=="function"?Od(s):(s instanceof IDBTransaction&&Td(s),jd(s,Sd())?new Proxy(s,Rr):s)}function Ve(s){if(s instanceof IDBRequest)return Cd(s);if(mr.has(s))return mr.get(s);const e=Ed(s);return e!==s&&(mr.set(s,e),Qr.set(e,s)),e}const pr=s=>Qr.get(s);function Pd(s,e,{blocked:t,upgrade:r,blocking:n,terminated:i}={}){const a=indexedDB.open(s,e),o=Ve(a);return r&&a.addEventListener("upgradeneeded",l=>{r(Ve(a.result),l.oldVersion,l.newVersion,Ve(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{i&&l.addEventListener("close",()=>i()),n&&l.addEventListener("versionchange",c=>n(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const Id=["get","getKey","getAll","getAllKeys","count"],Dd=["put","add","delete","clear"],br=new Map;function Mn(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(br.get(e))return br.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,n=Dd.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(n||Id.includes(t)))return;const i=async function(a,...o){const l=this.transaction(a,n?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),n&&l.done]))[0]};return br.set(e,i),i}Ad(s=>({...s,get:(e,t,r)=>Mn(e,t)||s.get(e,t,r),has:(e,t)=>!!Mn(e,t)||s.has(e,t)}));let hs;async function ee(){return hs||(hs=await Pd("FinanceTracker",1,{upgrade(s){s.createObjectStore("accounts",{keyPath:"id"}).createIndex("by-user","user_id");const t=s.createObjectStore("transactions",{keyPath:"id"});t.createIndex("by-account","account_id"),t.createIndex("by-sync","is_synced"),s.createObjectStore("categories",{keyPath:"id"}).createIndex("by-user","user_id"),s.createObjectStore("sync_queue",{keyPath:"id"})}}),hs)}async function Md(s){const e=await ee();await e.put("accounts",{...s,is_synced:!1}),await e.put("sync_queue",{id:`account_${s.id}_${Date.now()}`,table:"accounts",action:"create",data:s,timestamp:Date.now()})}async function Rn(s){return(await ee()).getAllFromIndex("accounts","by-user",s)}async function ge(s){const e=await ee();await e.put("accounts",{...s,is_synced:!1}),await e.put("sync_queue",{id:`account_${s.id}_${Date.now()}`,table:"accounts",action:"update",data:s,timestamp:Date.now()})}async function Rd(s){const e=await ee();await e.put("transactions",{...s,is_synced:!1,sync_status:"pending"}),await e.put("sync_queue",{id:`transaction_${s.id}_${Date.now()}`,table:"transactions",action:"create",data:s,timestamp:Date.now()})}async function Ln(s){return(await ee()).getAll("transactions")}async function Ld(s){const e=await ee();await e.put("transactions",{...s,is_synced:!1,sync_status:"pending"}),await e.put("sync_queue",{id:`transaction_${s.id}_${Date.now()}`,table:"transactions",action:"update",data:s,timestamp:Date.now()})}async function $n(s){const t=(await ee()).transaction("categories","readwrite");for(const r of s)await t.store.put({...r,is_synced:!0});await t.done}async function Fn(){return(await ee()).getAll("categories")}async function $d(){return(await ee()).getAll("sync_queue")}async function Qe(s){await(await ee()).delete("sync_queue",s)}async function mt(s,e){const t=await ee();if(s==="accounts"){const r=await t.get("accounts",e);r&&await t.put("accounts",{...r,is_synced:!0})}else if(s==="transactions"){const r=await t.get("transactions",e);r&&await t.put("transactions",{...r,is_synced:!0,sync_status:"synced"})}else if(s==="categories"){const r=await t.get("categories",e);r&&await t.put("categories",{...r,is_synced:!0})}}class Fd{constructor(){this.isOnline=navigator.onLine,this.syncInProgress=!1,this.syncCallbacks=[],this.dbInitialized=!1,this.setupNetworkListeners(),this.startPeriodicSync()}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.sync()}),window.addEventListener("offline",()=>{this.isOnline=!1})}startPeriodicSync(){setInterval(()=>{this.isOnline&&!this.syncInProgress&&this.sync()},3e4)}async sync(){if(!(!this.isOnline||this.syncInProgress)){this.syncInProgress=!0;try{const{data:{user:e},error:t}=await J.auth.getUser();if(t||!e){console.log("No authenticated user, skipping sync");return}console.log("Starting sync for user:",e.id),await this.syncFromServer(e.id),await this.syncToServer(),this.notifyCallbacks()}catch(e){console.error("Sync failed:",e)}finally{this.syncInProgress=!1}}}async syncFromServer(e){try{console.log("Syncing data from server for user:",e),await this.syncCategoriesFromServer(),await this.syncAccountsFromServer(e),await this.syncTransactionsFromServer(e),this.dbInitialized=!0,console.log("Server sync completed successfully")}catch(t){console.error("Failed to sync from server:",t),await this.createDefaultCategoriesOffline()}}async syncAccountsFromServer(e){try{console.log("Fetching accounts from server for user:",e);const{data:t,error:r}=await J.from("accounts").select("*").eq("user_id",e);if(r){r.code==="42P01"?console.warn("Accounts table does not exist in database. Please apply migrations to your Supabase project."):console.error("Error syncing accounts from server:",r);return}if(t&&t.length>0){console.log("Found accounts on server:",t.length);const n=await ee(),i=await n.getAllFromIndex("accounts","by-user",e),a=new Map(i.map(o=>[o.id,o]));for(const o of t){const l=a.get(o.id);if(!l)await n.put("accounts",{...o,is_synced:!0}),console.log("Added new account from server:",o.name);else{const c=new Date(o.updated_at).getTime(),h=new Date(l.updated_at).getTime();c>h&&l.is_synced?(await n.put("accounts",{...o,is_synced:!0}),console.log("Updated account from server (newer):",o.name)):l.is_synced||console.log("Keeping local account (has unsynced changes):",l.name)}}}else console.log("No accounts found on server for user:",e)}catch(t){console.error("Failed to sync accounts from server:",t)}}async syncTransactionsFromServer(e){try{console.log("Fetching transactions from server for user:",e);const{data:t,error:r}=await J.from("transactions").select(`
          *,
          accounts!transactions_account_id_fkey!inner(user_id)
        `).eq("accounts.user_id",e);if(r){r.code==="42P01"?console.warn("Transactions table does not exist in database. Please apply migrations to your Supabase project."):console.error("Error syncing transactions from server:",r);return}if(t&&t.length>0){console.log("Found transactions on server:",t.length);const n=await ee(),i=await n.getAll("transactions"),a=new Map(i.map(o=>[o.id,o]));for(const o of t){const{accounts:l,...c}=o,h=a.get(c.id);if(!h)await n.put("transactions",{...c,is_synced:!0,sync_status:"synced"}),console.log("Added new transaction from server:",c.description||"Untitled");else{const u=new Date(c.updated_at).getTime(),f=new Date(h.updated_at).getTime();u>f&&h.is_synced?(await n.put("transactions",{...c,is_synced:!0,sync_status:"synced"}),console.log("Updated transaction from server (newer):",c.description||"Untitled")):(!h.is_synced||h.sync_status==="pending")&&console.log("Keeping local transaction (has unsynced changes):",h.description||"Untitled")}}}else console.log("No transactions found on server for user:",e)}catch(t){console.error("Failed to sync transactions from server:",t)}}async syncToServer(){const{data:{user:e},error:t}=await J.auth.getUser();if(t){console.error("Failed to get current user for sync:",t);return}if(!e){console.log("No authenticated user found, skipping server sync");return}console.log("Syncing to server for user:",e.id);const r=await $d();console.log("Syncing to server, queue items:",r.length);const n=await ee();for(const i of r)try{let a=!1;if(i.table==="accounts")i.data.user_id===e.id?a=!0:console.warn(`Skipping account sync - user_id mismatch. Expected: ${e.id}, Got: ${i.data.user_id}`);else if(i.table==="transactions")try{const o=await n.get("accounts",i.data.account_id);o&&o.user_id===e.id?a=!0:console.warn(`Skipping transaction sync - account not found or user_id mismatch. Account ID: ${i.data.account_id}, Expected user: ${e.id}`)}catch(o){console.error("Error checking account ownership for transaction:",o)}else i.table==="categories"&&(i.data.user_id===e.id?a=!0:console.warn(`Skipping category sync - user_id mismatch. Expected: ${e.id}, Got: ${i.data.user_id}`));if(!a){await Qe(i.id);continue}if(i.table==="accounts"){const{is_synced:o,...l}=i.data;if(i.action==="create"){console.log("Creating account:",l.name,"for user:",e.id);const{error:c}=await J.from("accounts").insert(l);c?c.code==="42501"?console.error("RLS Policy Violation for account creation:",{error:c,accountData:l,currentUserId:e.id,accountUserId:l.user_id}):c.code==="42P01"?console.error("Database table does not exist. Please apply migrations to your Supabase project."):console.error("Supabase error creating account:",c):(console.log("Account created successfully, marking as synced"),await mt("accounts",i.data.id),await Qe(i.id))}else if(i.action==="update"){console.log("Updating account:",l.name,"for user:",e.id);const{error:c}=await J.from("accounts").update(l).eq("id",l.id);c?c.code==="42501"?console.error("RLS Policy Violation for account update:",{error:c,accountData:l,currentUserId:e.id,accountUserId:l.user_id}):c.code==="42P01"?console.error("Database table does not exist. Please apply migrations to your Supabase project."):console.error("Supabase error updating account:",c):(console.log("Account updated successfully, marking as synced"),await mt("accounts",i.data.id),await Qe(i.id))}}else if(i.table==="transactions"){const{is_synced:o,...l}=i.data;if(i.action==="create"){console.log("Creating transaction:",l.description,"for account:",l.account_id);const c={...l,sync_status:"synced"},{error:h}=await J.from("transactions").insert(c);if(h)if(h.code==="42501"){const u=await n.get("accounts",l.account_id);console.error("RLS Policy Violation for transaction creation:",{error:h,transactionData:l,currentUserId:e.id,accountId:l.account_id,accountUserId:u==null?void 0:u.user_id,accountExists:!!u})}else h.code==="42P01"?console.error("Database table does not exist. Please apply migrations to your Supabase project."):console.error("Supabase error creating transaction:",h);else console.log("Transaction created successfully, marking as synced"),await mt("transactions",i.data.id),await Qe(i.id)}else if(i.action==="update"){console.log("Updating transaction:",l.description,"for account:",l.account_id);const c={...l,sync_status:"synced"},{error:h}=await J.from("transactions").update(c).eq("id",l.id);if(h)if(h.code==="42501"){const u=await n.get("accounts",l.account_id);console.error("RLS Policy Violation for transaction update:",{error:h,transactionData:l,currentUserId:e.id,accountId:l.account_id,accountUserId:u==null?void 0:u.user_id,accountExists:!!u})}else h.code==="42P01"?console.error("Database table does not exist. Please apply migrations to your Supabase project."):console.error("Supabase error updating transaction:",h);else console.log("Transaction updated successfully, marking as synced"),await mt("transactions",i.data.id),await Qe(i.id)}}else if(i.table==="categories"){const{is_synced:o,...l}=i.data;if(i.action==="create"){console.log("Creating category:",l.name,"for user:",e.id);const{error:c}=await J.from("categories").insert(l);c?c.code==="42501"?console.error("RLS Policy Violation for category creation:",{error:c,categoryData:l,currentUserId:e.id,categoryUserId:l.user_id}):c.code==="42P01"?console.error("Database table does not exist. Please apply migrations to your Supabase project."):console.error("Supabase error creating category:",c):(console.log("Category created successfully, marking as synced"),await mt("categories",i.data.id),await Qe(i.id))}else if(i.action==="update"){console.log("Updating category:",l.name,"for user:",e.id);const{error:c}=await J.from("categories").update(l).eq("id",l.id);c?c.code==="42501"?console.error("RLS Policy Violation for category update:",{error:c,categoryData:l,currentUserId:e.id,categoryUserId:l.user_id}):c.code==="42P01"?console.error("Database table does not exist. Please apply migrations to your Supabase project."):console.error("Supabase error updating category:",c):(console.log("Category updated successfully, marking as synced"),await mt("categories",i.data.id),await Qe(i.id))}}}catch(a){console.error(`Failed to sync ${i.table} ${i.action}:`,a)}}async syncCategoriesFromServer(){try{const{data:e,error:t}=await J.from("categories").select("*");t?t.code==="42P01"?(console.warn("Categories table does not exist in database. Please apply migrations to your Supabase project."),await this.createDefaultCategoriesOffline()):console.error("Error syncing categories from server:",t):e&&(console.log("Synced categories from server:",e.length),await $n(e.map(r=>({...r,is_synced:!0}))))}catch(e){console.error("Failed to sync categories from server:",e),await this.createDefaultCategoriesOffline()}}async createDefaultCategoriesOffline(){try{const e=[{id:"default-salary",user_id:null,name:"Salary",type:"income",color:"#10b981",created_at:new Date().toISOString(),is_synced:!1},{id:"default-freelance",user_id:null,name:"Freelance",type:"income",color:"#059669",created_at:new Date().toISOString(),is_synced:!1},{id:"default-investment",user_id:null,name:"Investment",type:"income",color:"#047857",created_at:new Date().toISOString(),is_synced:!1},{id:"default-business",user_id:null,name:"Business",type:"income",color:"#065f46",created_at:new Date().toISOString(),is_synced:!1},{id:"default-other-income",user_id:null,name:"Other Income",type:"income",color:"#064e3b",created_at:new Date().toISOString(),is_synced:!1},{id:"default-food",user_id:null,name:"Food & Dining",type:"expense",color:"#ef4444",created_at:new Date().toISOString(),is_synced:!1},{id:"default-transport",user_id:null,name:"Transportation",type:"expense",color:"#dc2626",created_at:new Date().toISOString(),is_synced:!1},{id:"default-shopping",user_id:null,name:"Shopping",type:"expense",color:"#b91c1c",created_at:new Date().toISOString(),is_synced:!1},{id:"default-bills",user_id:null,name:"Bills & Utilities",type:"expense",color:"#991b1b",created_at:new Date().toISOString(),is_synced:!1},{id:"default-entertainment",user_id:null,name:"Entertainment",type:"expense",color:"#7c2d12",created_at:new Date().toISOString(),is_synced:!1},{id:"default-healthcare",user_id:null,name:"Healthcare",type:"expense",color:"#92400e",created_at:new Date().toISOString(),is_synced:!1},{id:"default-travel",user_id:null,name:"Travel",type:"expense",color:"#a16207",created_at:new Date().toISOString(),is_synced:!1},{id:"default-education",user_id:null,name:"Education",type:"expense",color:"#a3a3a3",created_at:new Date().toISOString(),is_synced:!1},{id:"default-personal",user_id:null,name:"Personal Care",type:"expense",color:"#737373",created_at:new Date().toISOString(),is_synced:!1},{id:"default-other-expense",user_id:null,name:"Other Expense",type:"expense",color:"#525252",created_at:new Date().toISOString(),is_synced:!1}];await $n(e),console.log("Created default categories offline")}catch(e){console.error("Failed to create default categories offline:",e)}}onSync(e){this.syncCallbacks.push(e)}notifyCallbacks(){this.syncCallbacks.forEach(e=>e())}getStatus(){return{isOnline:this.isOnline,syncInProgress:this.syncInProgress,dbInitialized:this.dbInitialized}}}const Te=new Fd,Bd=()=>{try{const s=localStorage.getItem("fintrack-exchange-rate");return s?parseFloat(s):null}catch{return null}},we=Xi((s,e)=>({accounts:[],transactions:[],categories:[],isOnline:navigator.onLine,syncInProgress:!1,exchangeRate:Bd(),loadData:async t=>{try{console.log("Loading data for user:",t);const[r,n,i]=await Promise.all([Rn(t),Ln(),Fn()]);console.log("Loaded from offline storage:",{accounts:r.length,transactions:n.length,categories:i.length}),s({accounts:r,transactions:n,categories:i}),navigator.onLine?(console.log("Online - initiating sync to get latest data..."),await Te.sync(),console.log("Sync completed, reloading data from local storage..."),await e().reloadDataFromLocal(t)):console.log("Offline - using local data only")}catch(r){console.error("Error loading data:",r)}},reloadDataFromLocal:async t=>{try{console.log("Reloading data from local storage for user:",t);const[r,n,i]=await Promise.all([Rn(t),Ln(),Fn()]);console.log("Reloaded from offline storage:",{accounts:r.length,transactions:n.length,categories:i.length}),s({accounts:r,transactions:n,categories:i})}catch(r){console.error("Error reloading data from local storage:",r)}},createAccount:async t=>{const r={...t,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_synced:!1};await Md(r),s(n=>({accounts:[...n.accounts,r]})),navigator.onLine&&Te.sync()},updateAccount:async t=>{const r={...t,updated_at:new Date().toISOString(),is_synced:!1};await ge(r),s(n=>({accounts:n.accounts.map(i=>i.id===t.id?r:i)})),navigator.onLine&&Te.sync()},deleteAccount:async t=>{try{const r=await ee(),n=e();if(!n.accounts.find(l=>l.id===t))throw new Error("Account not found");const a=n.transactions.filter(l=>l.account_id===t),o=r.transaction(["accounts","transactions"],"readwrite");await o.objectStore("accounts").delete(t);for(const l of a)await o.objectStore("transactions").delete(l.id);if(await o.done,navigator.onLine){const{error:l}=await J.from("accounts").delete().eq("id",t);l&&console.error("Error deleting account from Supabase:",l)}s(l=>({accounts:l.accounts.filter(c=>c.id!==t),transactions:l.transactions.filter(c=>c.account_id!==t)}))}catch(r){throw console.error("Error deleting account:",r),r}},createTransaction:async t=>{const r={...t,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_synced:!1,sync_status:"pending"},n=e();if(r.type==="transfer"){const i=n.accounts.find(c=>c.id===r.account_id),a=n.accounts.find(c=>c.id===r.target_account_id);if(!i||!a)throw new Error("Source or target account not found for transfer");const o={...i,current_balance:i.current_balance-r.amount,updated_at:new Date().toISOString(),is_synced:!1},l={...a,current_balance:a.current_balance+r.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(o),await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===i.id?o:h.id===a.id?l:h)}))}else{const i=n.accounts.find(a=>a.id===r.account_id);if(i){const a=r.type==="expense"?-r.amount:r.amount,o={...i,current_balance:i.current_balance+a,updated_at:new Date().toISOString(),is_synced:!1};await ge(o),s(l=>({accounts:l.accounts.map(c=>c.id===i.id?o:c)}))}}await Rd(r),s(i=>({transactions:[...i.transactions,r]})),navigator.onLine&&Te.sync()},updateTransaction:async t=>{const r=e(),n=r.transactions.find(a=>a.id===t.id);if(n){if(n.type==="transfer"){const a=r.accounts.find(l=>l.id===n.account_id),o=r.accounts.find(l=>l.id===n.target_account_id);if(a){const l={...a,current_balance:a.current_balance+n.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===a.id?l:h)}))}if(o){const l={...o,current_balance:o.current_balance-n.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===o.id?l:h)}))}}else{const a=r.accounts.find(o=>o.id===n.account_id);if(a){const o=n.type==="expense"?n.amount:-n.amount,l={...a,current_balance:a.current_balance+o,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===a.id?l:h)}))}}if(t.type==="transfer"){const a=e().accounts.find(l=>l.id===t.account_id),o=e().accounts.find(l=>l.id===t.target_account_id);if(a){const l={...a,current_balance:a.current_balance-t.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===a.id?l:h)}))}if(o){const l={...o,current_balance:o.current_balance+t.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===o.id?l:h)}))}}else{const a=e().accounts.find(o=>o.id===t.account_id);if(a){const o=t.type==="expense"?-t.amount:t.amount,l={...a,current_balance:a.current_balance+o,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===a.id?l:h)}))}}}const i={...t,updated_at:new Date().toISOString(),is_synced:!1,sync_status:"pending"};await Ld(i),s(a=>({transactions:a.transactions.map(o=>o.id===t.id?i:o)})),navigator.onLine&&Te.sync()},deleteTransaction:async t=>{try{const r=await ee(),n=e(),i=n.transactions.find(a=>a.id===t);if(!i)throw new Error("Transaction not found");if(i.type==="transfer"){const a=n.accounts.find(l=>l.id===i.account_id),o=n.accounts.find(l=>l.id===i.target_account_id);if(a){const l={...a,current_balance:a.current_balance+i.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===a.id?l:h)}))}if(o){const l={...o,current_balance:o.current_balance-i.amount,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===o.id?l:h)}))}}else{const a=n.accounts.find(o=>o.id===i.account_id);if(a){const o=i.type==="expense"?i.amount:-i.amount,l={...a,current_balance:a.current_balance+o,updated_at:new Date().toISOString(),is_synced:!1};await ge(l),s(c=>({accounts:c.accounts.map(h=>h.id===a.id?l:h)}))}}if(await r.delete("transactions",t),navigator.onLine){const{error:a}=await J.from("transactions").delete().eq("id",t);a&&console.error("Error deleting transaction from Supabase:",a)}s(a=>({transactions:a.transactions.filter(o=>o.id!==t)}))}catch(r){throw console.error("Error deleting transaction:",r),r}},createCategory:async t=>{const r={...t,id:crypto.randomUUID(),created_at:new Date().toISOString(),is_synced:!1};try{const n=await ee();await n.put("categories",r),await n.put("sync_queue",{id:`category_${r.id}_${Date.now()}`,table:"categories",action:"create",data:r,timestamp:Date.now()}),s(i=>({categories:[...i.categories,r]})),navigator.onLine&&Te.sync()}catch(n){throw console.error("Error creating category:",n),n}},updateCategory:async t=>{try{const r={...t,is_synced:!1},n=await ee();await n.put("categories",r),await n.put("sync_queue",{id:`category_${t.id}_${Date.now()}`,table:"categories",action:"update",data:r,timestamp:Date.now()}),s(i=>({categories:i.categories.map(a=>a.id===t.id?r:a)})),navigator.onLine&&Te.sync()}catch(r){throw console.error("Error updating category:",r),r}},deleteCategory:async t=>{try{if(await(await ee()).delete("categories",t),navigator.onLine){const{error:n}=await J.from("categories").delete().eq("id",t);n&&console.error("Error deleting category from Supabase:",n)}s(n=>({categories:n.categories.filter(i=>i.id!==t)}))}catch(r){throw console.error("Error deleting category:",r),r}},setExchangeRate:t=>{s({exchangeRate:t}),t!==null?localStorage.setItem("fintrack-exchange-rate",t.toString()):localStorage.removeItem("fintrack-exchange-rate")},updateSyncStatus:()=>{const t=Te.getStatus();s({isOnline:t.isOnline,syncInProgress:t.syncInProgress})}}));Te.onSync(async()=>{const s=we.getState();s.updateSyncStatus();try{const{data:{user:e}}=await J.auth.getUser();e&&(console.log("Sync completed, reloading data for user:",e.id),await s.reloadDataFromLocal(e.id))}catch(e){console.error("Error reloading data after sync:",e)}});function Ud(){const[s,e]=j.useState([]),t=j.useCallback(n=>{const a={id:Math.random().toString(36).substr(2,9),...n,onClose:()=>{}};e(o=>[...o,a])},[]),r=j.useCallback(n=>{e(i=>i.filter(a=>a.id!==n))},[]);return{toasts:s,addToast:t,removeToast:r}}function Da(){const[s,e]=j.useState(()=>{if(typeof window<"u"){const r=localStorage.getItem("theme");return r==="dark"||!r&&window.matchMedia("(prefers-color-scheme: dark)").matches}return!1});return j.useEffect(()=>{const r=window.document.documentElement;s?r.classList.add("dark"):r.classList.remove("dark"),localStorage.setItem("theme",s?"dark":"light")},[s]),{isDark:s,toggleTheme:()=>e(!s)}}function zd(s){const[e,t]=j.useState({isInstallable:!1,isInstalled:!1,isStandalone:!1,showInstallPrompt:!1,isIOS:!1,isAndroid:!1,timeSpent:0,pagesVisited:0,engagementMet:!1}),[r,n]=j.useState(null),[i,a]=j.useState(null),o=j.useRef(new Set),l=j.useRef(Date.now()),c=j.useRef(null);j.useEffect(()=>{const g=()=>{const p=Date.now(),b=Math.floor((p-l.current)/1e3);t(m=>({...m,timeSpent:b}))};return c.current=setInterval(g,1e3),()=>{c.current&&clearInterval(c.current)}},[]),j.useEffect(()=>{if(s){o.current.add(s);const g=o.current.size;t(p=>({...p,pagesVisited:g}))}},[s]),j.useEffect(()=>{const{timeSpent:g,pagesVisited:p}=e,b=g>=30&&p>=2;t(m=>({...m,engagementMet:b}))},[e.timeSpent,e.pagesVisited]),j.useEffect(()=>{const g=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),p=/iPad|iPhone|iPod/.test(navigator.userAgent),b=/Android/.test(navigator.userAgent),m=g||localStorage.getItem("pwa-installed")==="true",x=window.location.hostname.includes("stackblitz")||window.location.hostname.includes("webcontainer")||window.location.hostname==="localhost";t(v=>({...v,isStandalone:g,isInstalled:m,isIOS:p,isAndroid:b}));const w=v=>{v.preventDefault(),n(v),t(N=>({...N,isInstallable:!0}))},y=()=>{console.log("PWA was installed"),localStorage.setItem("pwa-installed","true"),t(v=>({...v,isInstalled:!0,showInstallPrompt:!1,isInstallable:!1})),n(null),o.current.clear(),l.current=Date.now()};return window.addEventListener("beforeinstallprompt",w),window.addEventListener("appinstalled",y),"serviceWorker"in navigator&&!x?navigator.serviceWorker.register("/sw.js").then(v=>{console.log("Service Worker registered:",v),v.addEventListener("updatefound",()=>{const k=v.installing;k&&k.addEventListener("statechange",()=>{k.state==="installed"&&navigator.serviceWorker.controller&&(console.log("New content available"),a(k))})})}).catch(v=>{console.error("Service Worker registration failed:",v)}):x&&console.log("Service Worker registration skipped: Running in StackBlitz environment"),()=>{window.removeEventListener("beforeinstallprompt",w),window.removeEventListener("appinstalled",y)}},[]),j.useEffect(()=>{const{isInstallable:g,isInstalled:p,engagementMet:b}=e,m=g&&!p&&b&&f();t(x=>({...x,showInstallPrompt:m}))},[e.isInstallable,e.isInstalled,e.engagementMet]);const h=async()=>{if(!r)return!1;try{await r.prompt();const{outcome:g}=await r.userChoice;return g==="accepted"?(console.log("User accepted the install prompt"),localStorage.setItem("pwa-installed","true"),t(p=>({...p,isInstalled:!0,showInstallPrompt:!1,isInstallable:!1})),o.current.clear(),l.current=Date.now()):(console.log("User dismissed the install prompt"),t(p=>({...p,showInstallPrompt:!1})),localStorage.setItem("pwa-prompt-dismissed",Date.now().toString()),o.current.clear(),l.current=Date.now(),t(p=>({...p,timeSpent:0,pagesVisited:0,engagementMet:!1}))),n(null),g==="accepted"}catch(g){return console.error("Error during app installation:",g),!1}},u=()=>{t(g=>({...g,showInstallPrompt:!1})),localStorage.setItem("pwa-prompt-dismissed",Date.now().toString()),o.current.clear(),l.current=Date.now(),t(g=>({...g,timeSpent:0,pagesVisited:0,engagementMet:!1}))},f=()=>{const g=localStorage.getItem("pwa-prompt-dismissed");if(g){const p=parseInt(g),b=24*60*60*1e3;return Date.now()-p>b}return!0};return{...e,installApp:h,dismissInstallPrompt:u,shouldShowPrompt:f(),canInstall:!!r,newWorker:i}}function Wd(){const[s,e]=j.useState(!1),[t,r]=j.useState(""),[n,i]=j.useState(""),[a,o]=j.useState(""),[l,c]=j.useState(!1),[h,u]=j.useState(!1),[f,g]=j.useState(""),{signIn:p,signUp:b}=$e(),m=async x=>{x.preventDefault(),u(!0),g("");try{s?await b(t,n,a):await p(t,n)}catch(w){g(w.message||"An error occurred")}finally{u(!1)}};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 flex items-center justify-center p-3 sm:p-4 transition-colors duration-200",children:d.jsxs("div",{className:"max-w-md w-full",children:[d.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[d.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 dark:text-white",children:"ChurchTrack"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1 sm:mt-2 text-xs sm:text-sm md:text-base",children:"Church financial management system"})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 md:p-8 transition-colors duration-200",children:[d.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[d.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 dark:text-white",children:s?"Create Account":"Welcome Back"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1 text-xs sm:text-sm md:text-base",children:s?"Start tracking your finances today":"Sign in to your account"})]}),f&&d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg mb-3 sm:mb-4 text-xs sm:text-sm",children:f}),d.jsxs("form",{onSubmit:m,className:"space-y-3 sm:space-y-4",children:[s&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"fullName",className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name"}),d.jsx("input",{id:"fullName",type:"text",value:a,onChange:x=>o(x.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm sm:text-base placeholder-gray-400 dark:placeholder-gray-500",placeholder:"Enter your full name",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:t,onChange:x=>r(x.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm sm:text-base placeholder-gray-400 dark:placeholder-gray-500",placeholder:"Enter your email",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),d.jsxs("div",{className:"relative",children:[d.jsx("input",{id:"password",type:l?"text":"password",value:n,onChange:x=>i(x.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 pr-10 sm:pr-12 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm sm:text-base placeholder-gray-400 dark:placeholder-gray-500",placeholder:"Enter your password",required:!0,minLength:6}),d.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-2 sm:right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",children:l?d.jsx(Ao,{className:"w-4 h-4 sm:w-5 sm:h-5"}):d.jsx(Qi,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),d.jsx("button",{type:"submit",disabled:h,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 dark:from-blue-500 dark:to-indigo-500 dark:hover:from-blue-600 dark:hover:to-indigo-600 text-white px-3 sm:px-4 py-2 sm:py-3 rounded-lg font-medium focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:h?d.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):d.jsxs(d.Fragment,{children:[s?d.jsx(Oo,{className:"w-4 h-4 sm:w-5 sm:h-5"}):d.jsx(Eo,{className:"w-4 h-4 sm:w-5 sm:h-5"}),s?"Create Account":"Sign In"]})})]}),d.jsx("div",{className:"text-center mt-4 sm:mt-6",children:d.jsx("button",{onClick:()=>e(!s),className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium transition-colors text-xs sm:text-sm md:text-base",children:s?"Already have an account? Sign in":"Don't have an account? Sign up"})}),d.jsx("div",{className:"text-center mt-4 sm:mt-6 pt-3 sm:pt-4 border-t border-gray-200 dark:border-gray-700",children:d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ChurchTrack ver. 1.2.0 by"," ",d.jsx("a",{href:"https://elxis.com.ng",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors",children:"eLxis"})]})})]})]})})}function Hd({activeTab:s,onTabChange:e,isAdmin:t}){const{signOut:r}=$e(),n=[{id:"dashboard",name:"Dashboard",icon:ta},{id:"accounts",name:"Accounts",icon:at},{id:"transactions",name:"Transactions",icon:Ts},...t?[{id:"settings",name:"Settings",icon:Po}]:[]];return d.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 transition-colors duration-200",children:[d.jsxs("div",{className:"flex items-center gap-3 p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 rounded-lg flex items-center justify-center shadow-sm",children:d.jsx(Zi,{className:"w-5 h-5 text-white"})}),d.jsx("span",{className:"font-bold text-lg sm:text-xl text-gray-900 dark:text-white",children:"ChurchTrack"})]}),d.jsx("nav",{className:"flex-1 p-3 sm:p-4",children:d.jsx("ul",{className:"space-y-1 sm:space-y-2",children:n.map(i=>{const a=i.icon,o=s===i.id;return d.jsx("li",{children:d.jsxs("button",{onClick:()=>e(i.id),className:`w-full flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg text-left transition-all duration-200 group ${o?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-700 shadow-sm":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-white"}`,children:[d.jsx(a,{className:`w-5 h-5 flex-shrink-0 transition-transform duration-200 ${o?"scale-110":"group-hover:scale-105"}`}),d.jsx("span",{className:"font-medium text-sm sm:text-base",children:i.name})]})},i.id)})})}),d.jsxs("div",{className:"px-3 sm:px-4 py-2 border-t border-gray-200 dark:border-gray-700",children:[d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["ChurchTrack ver. 1.2.0 by"," ",d.jsx("a",{href:"https://elxis.com.ng",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors",children:"eLxis"})]}),t&&d.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 text-center mt-1 font-medium",children:"Administrator Access"})]}),d.jsx("div",{className:"p-3 sm:p-4 border-t border-gray-200 dark:border-gray-700",children:d.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 text-gray-700 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-700 dark:hover:text-red-400 rounded-lg transition-all duration-200 group",children:[d.jsx(ea,{className:"w-5 h-5 flex-shrink-0 group-hover:scale-105 transition-transform duration-200"}),d.jsx("span",{className:"font-medium text-sm sm:text-base",children:"Sign Out"})]})})]})}function qd({title:s,onMenuClick:e}){const{isOnline:t,syncInProgress:r}=we(),{isDark:n,toggleTheme:i}=Da();return d.jsx("header",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-3 sm:py-4 transition-colors duration-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[d.jsx("button",{onClick:e,className:"lg:hidden p-2 -ml-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:d.jsx(Io,{className:"w-5 h-5"})}),d.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 dark:text-white truncate",children:s})]}),d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[d.jsx("button",{onClick:i,className:"p-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-all duration-200 hover:scale-105 active:scale-95",title:n?"Switch to Light theme":"Switch to Dark theme",children:n?d.jsx(Do,{className:"w-4 h-4 sm:w-5 sm:h-5"}):d.jsx(Mo,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),d.jsxs("div",{className:`flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium transition-colors ${t?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:[t?d.jsx(Ro,{className:"w-3 h-3 sm:w-4 sm:h-4"}):d.jsx(Lo,{className:"w-3 h-3 sm:w-4 sm:h-4"}),d.jsx("span",{className:"hidden sm:inline",children:t?"Online":"Offline"})]}),r&&d.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1.5 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 text-xs sm:text-sm font-medium",children:[d.jsx(As,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}),d.jsx("span",{className:"hidden sm:inline",children:"Syncing..."})]})]})]})})}function Vd({activeTab:s,onTabChange:e,onAddTransaction:t,isAdmin:r}){const{signOut:n}=$e(),i=[{id:"dashboard",icon:ta,label:"Home"},{id:"accounts",icon:at,label:"Accounts"},...r?[{id:"add",icon:wt,label:"Add",isSpecial:!0}]:[],{id:"transactions",icon:Ts,label:"History"},{id:"logout",icon:ea,label:"Logout",isLogout:!0}],a=o=>{o.isSpecial?t():o.isLogout?n():e(o.id)};return d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 z-40 lg:hidden transition-colors duration-200",children:d.jsx("div",{className:"flex items-center justify-around py-2 px-2 pb-6 safe-area-pb",children:i.map(o=>{const l=o.icon,c=s===o.id&&!o.isSpecial&&!o.isLogout;return o.isSpecial?d.jsx("button",{onClick:()=>a(o),className:"flex flex-col items-center justify-center w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white rounded-full shadow-lg hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 transition-all duration-200 transform hover:scale-105 active:scale-95",children:d.jsx(l,{className:"w-5 h-5"})},o.id):d.jsxs("button",{onClick:()=>a(o),className:`flex flex-col items-center justify-center py-2 px-2 min-w-0 flex-1 transition-all duration-200 ${c?"text-blue-600 dark:text-blue-400":o.isLogout?"text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[d.jsx(l,{className:`w-4 h-4 mb-0.5 ${c?"scale-110":""} transition-transform duration-200`}),d.jsx("span",{className:`text-[10px] font-medium truncate ${c?"font-semibold":""}`,children:o.label})]},o.id)})})})}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function ns(s){return s+.5|0}const He=(s,e,t)=>Math.max(Math.min(s,t),e);function Mt(s){return He(ns(s*2.55),0,255)}function Ke(s){return He(ns(s*255),0,255)}function Re(s){return He(ns(s/2.55)/100,0,1)}function Bn(s){return He(ns(s*100),0,100)}const be={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Lr=[..."0123456789ABCDEF"],Kd=s=>Lr[s&15],Gd=s=>Lr[(s&240)>>4]+Lr[s&15],us=s=>(s&240)>>4===(s&15),Yd=s=>us(s.r)&&us(s.g)&&us(s.b)&&us(s.a);function Jd(s){var e=s.length,t;return s[0]==="#"&&(e===4||e===5?t={r:255&be[s[1]]*17,g:255&be[s[2]]*17,b:255&be[s[3]]*17,a:e===5?be[s[4]]*17:255}:(e===7||e===9)&&(t={r:be[s[1]]<<4|be[s[2]],g:be[s[3]]<<4|be[s[4]],b:be[s[5]]<<4|be[s[6]],a:e===9?be[s[7]]<<4|be[s[8]]:255})),t}const Xd=(s,e)=>s<255?e(s):"";function Qd(s){var e=Yd(s)?Kd:Gd;return s?"#"+e(s.r)+e(s.g)+e(s.b)+Xd(s.a,e):void 0}const Zd=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Ma(s,e,t){const r=e*Math.min(t,1-t),n=(i,a=(i+s/30)%12)=>t-r*Math.max(Math.min(a-3,9-a,1),-1);return[n(0),n(8),n(4)]}function eh(s,e,t){const r=(n,i=(n+s/60)%6)=>t-t*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function th(s,e,t){const r=Ma(s,1,.5);let n;for(e+t>1&&(n=1/(e+t),e*=n,t*=n),n=0;n<3;n++)r[n]*=1-e-t,r[n]+=e;return r}function sh(s,e,t,r,n){return s===n?(e-t)/r+(e<t?6:0):e===n?(t-s)/r+2:(s-e)/r+4}function Zr(s){const t=s.r/255,r=s.g/255,n=s.b/255,i=Math.max(t,r,n),a=Math.min(t,r,n),o=(i+a)/2;let l,c,h;return i!==a&&(h=i-a,c=o>.5?h/(2-i-a):h/(i+a),l=sh(t,r,n,h,i),l=l*60+.5),[l|0,c||0,o]}function en(s,e,t,r){return(Array.isArray(e)?s(e[0],e[1],e[2]):s(e,t,r)).map(Ke)}function tn(s,e,t){return en(Ma,s,e,t)}function rh(s,e,t){return en(th,s,e,t)}function nh(s,e,t){return en(eh,s,e,t)}function Ra(s){return(s%360+360)%360}function ih(s){const e=Zd.exec(s);let t=255,r;if(!e)return;e[5]!==r&&(t=e[6]?Mt(+e[5]):Ke(+e[5]));const n=Ra(+e[2]),i=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?r=rh(n,i,a):e[1]==="hsv"?r=nh(n,i,a):r=tn(n,i,a),{r:r[0],g:r[1],b:r[2],a:t}}function ah(s,e){var t=Zr(s);t[0]=Ra(t[0]+e),t=tn(t),s.r=t[0],s.g=t[1],s.b=t[2]}function oh(s){if(!s)return;const e=Zr(s),t=e[0],r=Bn(e[1]),n=Bn(e[2]);return s.a<255?`hsla(${t}, ${r}%, ${n}%, ${Re(s.a)})`:`hsl(${t}, ${r}%, ${n}%)`}const Un={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},zn={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function lh(){const s={},e=Object.keys(zn),t=Object.keys(Un);let r,n,i,a,o;for(r=0;r<e.length;r++){for(a=o=e[r],n=0;n<t.length;n++)i=t[n],o=o.replace(i,Un[i]);i=parseInt(zn[a],16),s[o]=[i>>16&255,i>>8&255,i&255]}return s}let fs;function ch(s){fs||(fs=lh(),fs.transparent=[0,0,0,0]);const e=fs[s.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const dh=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function hh(s){const e=dh.exec(s);let t=255,r,n,i;if(e){if(e[7]!==r){const a=+e[7];t=e[8]?Mt(a):He(a*255,0,255)}return r=+e[1],n=+e[3],i=+e[5],r=255&(e[2]?Mt(r):He(r,0,255)),n=255&(e[4]?Mt(n):He(n,0,255)),i=255&(e[6]?Mt(i):He(i,0,255)),{r,g:n,b:i,a:t}}}function uh(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${Re(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const xr=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,pt=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function fh(s,e,t){const r=pt(Re(s.r)),n=pt(Re(s.g)),i=pt(Re(s.b));return{r:Ke(xr(r+t*(pt(Re(e.r))-r))),g:Ke(xr(n+t*(pt(Re(e.g))-n))),b:Ke(xr(i+t*(pt(Re(e.b))-i))),a:s.a+t*(e.a-s.a)}}function gs(s,e,t){if(s){let r=Zr(s);r[e]=Math.max(0,Math.min(r[e]+r[e]*t,e===0?360:1)),r=tn(r),s.r=r[0],s.g=r[1],s.b=r[2]}}function La(s,e){return s&&Object.assign(e||{},s)}function Wn(s){var e={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(e={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(e.a=Ke(s[3]))):(e=La(s,{r:0,g:0,b:0,a:1}),e.a=Ke(e.a)),e}function gh(s){return s.charAt(0)==="r"?hh(s):ih(s)}class Xt{constructor(e){if(e instanceof Xt)return e;const t=typeof e;let r;t==="object"?r=Wn(e):t==="string"&&(r=Jd(e)||ch(e)||gh(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=La(this._rgb);return e&&(e.a=Re(e.a)),e}set rgb(e){this._rgb=Wn(e)}rgbString(){return this._valid?uh(this._rgb):void 0}hexString(){return this._valid?Qd(this._rgb):void 0}hslString(){return this._valid?oh(this._rgb):void 0}mix(e,t){if(e){const r=this.rgb,n=e.rgb;let i;const a=t===i?.5:t,o=2*a-1,l=r.a-n.a,c=((o*l===-1?o:(o+l)/(1+o*l))+1)/2;i=1-c,r.r=255&c*r.r+i*n.r+.5,r.g=255&c*r.g+i*n.g+.5,r.b=255&c*r.b+i*n.b+.5,r.a=a*r.a+(1-a)*n.a,this.rgb=r}return this}interpolate(e,t){return e&&(this._rgb=fh(this._rgb,e._rgb,t)),this}clone(){return new Xt(this.rgb)}alpha(e){return this._rgb.a=Ke(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=ns(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return gs(this._rgb,2,e),this}darken(e){return gs(this._rgb,2,-e),this}saturate(e){return gs(this._rgb,1,e),this}desaturate(e){return gs(this._rgb,1,-e),this}rotate(e){return ah(this._rgb,e),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Ee(){}const mh=(()=>{let s=0;return()=>s++})();function oe(s){return s==null}function ne(s){if(Array.isArray&&Array.isArray(s))return!0;const e=Object.prototype.toString.call(s);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function W(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function Le(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function Ne(s,e){return Le(s)?s:e}function V(s,e){return typeof s>"u"?e:s}const ph=(s,e)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100:+s/e,$a=(s,e)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*e:+s;function G(s,e,t){if(s&&typeof s.call=="function")return s.apply(t,e)}function q(s,e,t,r){let n,i,a;if(ne(s))for(i=s.length,n=0;n<i;n++)e.call(t,s[n],n);else if(W(s))for(a=Object.keys(s),i=a.length,n=0;n<i;n++)e.call(t,s[a[n]],a[n])}function Rs(s,e){let t,r,n,i;if(!s||!e||s.length!==e.length)return!1;for(t=0,r=s.length;t<r;++t)if(n=s[t],i=e[t],n.datasetIndex!==i.datasetIndex||n.index!==i.index)return!1;return!0}function Ls(s){if(ne(s))return s.map(Ls);if(W(s)){const e=Object.create(null),t=Object.keys(s),r=t.length;let n=0;for(;n<r;++n)e[t[n]]=Ls(s[t[n]]);return e}return s}function Fa(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function bh(s,e,t,r){if(!Fa(s))return;const n=e[s],i=t[s];W(n)&&W(i)?Qt(n,i,r):e[s]=Ls(i)}function Qt(s,e,t){const r=ne(e)?e:[e],n=r.length;if(!W(s))return s;t=t||{};const i=t.merger||bh;let a;for(let o=0;o<n;++o){if(a=r[o],!W(a))continue;const l=Object.keys(a);for(let c=0,h=l.length;c<h;++c)i(l[c],s,a,t)}return s}function qt(s,e){return Qt(s,e,{merger:xh})}function xh(s,e,t){if(!Fa(s))return;const r=e[s],n=t[s];W(r)&&W(n)?qt(r,n):Object.prototype.hasOwnProperty.call(e,s)||(e[s]=Ls(n))}const Hn={"":s=>s,x:s=>s.x,y:s=>s.y};function yh(s){const e=s.split("."),t=[];let r="";for(const n of e)r+=n,r.endsWith("\\")?r=r.slice(0,-1)+".":(t.push(r),r="");return t}function vh(s){const e=yh(s);return t=>{for(const r of e){if(r==="")break;t=t&&t[r]}return t}}function Zt(s,e){return(Hn[e]||(Hn[e]=vh(e)))(s)}function sn(s){return s.charAt(0).toUpperCase()+s.slice(1)}const $s=s=>typeof s<"u",Ge=s=>typeof s=="function",qn=(s,e)=>{if(s.size!==e.size)return!1;for(const t of s)if(!e.has(t))return!1;return!0};function wh(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const Y=Math.PI,te=2*Y,Fs=Number.POSITIVE_INFINITY,_h=Y/180,se=Y/2,Ze=Y/4,Vn=Y*2/3,Kn=Math.log10,Gn=Math.sign;function kh(s){const e=[],t=Math.sqrt(s);let r;for(r=1;r<t;r++)s%r===0&&(e.push(r),e.push(s/r));return t===(t|0)&&e.push(t),e.sort((n,i)=>n-i).pop(),e}function jh(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function Bs(s){return!jh(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function it(s){return s*(Y/180)}function Sh(s){return s*(180/Y)}function Ba(s,e){const t=e.x-s.x,r=e.y-s.y,n=Math.sqrt(t*t+r*r);let i=Math.atan2(r,t);return i<-.5*Y&&(i+=te),{angle:i,distance:n}}function Nh(s,e){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function Oe(s){return(s%te+te)%te}function Us(s,e,t,r){const n=Oe(s),i=Oe(e),a=Oe(t),o=Oe(i-n),l=Oe(a-n),c=Oe(n-i),h=Oe(n-a);return n===i||n===a||r&&i===a||o>l&&c<h}function xe(s,e,t){return Math.max(e,Math.min(t,s))}function Ch(s){return xe(s,-32768,32767)}function Rt(s,e,t,r=1e-6){return s>=Math.min(e,t)-r&&s<=Math.max(e,t)+r}function rn(s,e,t){t=t||(a=>s[a]<e);let r=s.length-1,n=0,i;for(;r-n>1;)i=n+r>>1,t(i)?n=i:r=i;return{lo:n,hi:r}}const $r=(s,e,t,r)=>rn(s,t,r?n=>{const i=s[n][e];return i<t||i===t&&s[n+1][e]===t}:n=>s[n][e]<t),Th=(s,e,t)=>rn(s,t,r=>s[r][e]>=t);function Ah(s,e,t){let r=0,n=s.length;for(;r<n&&s[r]<e;)r++;for(;n>r&&s[n-1]>t;)n--;return r>0||n<s.length?s.slice(r,n):s}const Ua=["push","pop","shift","splice","unshift"];function Oh(s,e){if(s._chartjs){s._chartjs.listeners.push(e);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Ua.forEach(t=>{const r="_onData"+sn(t),n=s[t];Object.defineProperty(s,t,{configurable:!0,enumerable:!1,value(...i){const a=n.apply(this,i);return s._chartjs.listeners.forEach(o=>{typeof o[r]=="function"&&o[r](...i)}),a}})})}function Yn(s,e){const t=s._chartjs;if(!t)return;const r=t.listeners,n=r.indexOf(e);n!==-1&&r.splice(n,1),!(r.length>0)&&(Ua.forEach(i=>{delete s[i]}),delete s._chartjs)}function Eh(s){const e=new Set(s);return e.size===s.length?s:Array.from(e)}const za=function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame}();function Wa(s,e){let t=[],r=!1;return function(...n){t=n,r||(r=!0,za.call(window,()=>{r=!1,s.apply(e,t)}))}}function Ph(s,e){let t;return function(...r){return e?(clearTimeout(t),t=setTimeout(s,e,r)):s.apply(this,r),e}}const Ha=s=>s==="start"?"left":s==="end"?"right":"center",me=(s,e,t)=>s==="start"?e:s==="end"?t:(e+t)/2,Ih=(s,e,t,r)=>s===(r?"left":"right")?t:s==="center"?(e+t)/2:e,ms=s=>s===0||s===1,Jn=(s,e,t)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-e)*te/t)),Xn=(s,e,t)=>Math.pow(2,-10*s)*Math.sin((s-e)*te/t)+1,Vt={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*se)+1,easeOutSine:s=>Math.sin(s*se),easeInOutSine:s=>-.5*(Math.cos(Y*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>ms(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>ms(s)?s:Jn(s,.075,.3),easeOutElastic:s=>ms(s)?s:Xn(s,.075,.3),easeInOutElastic(s){return ms(s)?s:s<.5?.5*Jn(s*2,.1125,.45):.5+.5*Xn(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let e=1.70158;return(s/=.5)<1?.5*(s*s*(((e*=1.525)+1)*s-e)):.5*((s-=2)*s*(((e*=1.525)+1)*s+e)+2)},easeInBounce:s=>1-Vt.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?Vt.easeInBounce(s*2)*.5:Vt.easeOutBounce(s*2-1)*.5+.5};function qa(s){if(s&&typeof s=="object"){const e=s.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function Qn(s){return qa(s)?s:new Xt(s)}function yr(s){return qa(s)?s:new Xt(s).saturate(.5).darken(.1).hexString()}const Dh=["x","y","borderWidth","radius","tension"],Mh=["color","borderColor","backgroundColor"];function Rh(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),s.set("animations",{colors:{type:"color",properties:Mh},numbers:{type:"number",properties:Dh}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Lh(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Zn=new Map;function $h(s,e){e=e||{};const t=s+JSON.stringify(e);let r=Zn.get(t);return r||(r=new Intl.NumberFormat(s,e),Zn.set(t,r)),r}function Va(s,e,t){return $h(e,t).format(s)}const Ka={values(s){return ne(s)?s:""+s},numeric(s,e,t){if(s===0)return"0";const r=this.chart.options.locale;let n,i=s;if(t.length>1){const c=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(c<1e-4||c>1e15)&&(n="scientific"),i=Fh(s,t)}const a=Kn(Math.abs(i)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:n,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),Va(s,r,l)},logarithmic(s,e,t){if(s===0)return"0";const r=t[e].significand||s/Math.pow(10,Math.floor(Kn(s)));return[1,2,3,5,10,15].includes(r)||e>.8*t.length?Ka.numeric.call(this,s,e,t):""}};function Fh(s,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&s!==Math.floor(s)&&(t=s-Math.floor(s)),t}var Bh={formatters:Ka};function Uh(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Bh.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const lt=Object.create(null),Fr=Object.create(null);function Kt(s,e){if(!e)return s;const t=e.split(".");for(let r=0,n=t.length;r<n;++r){const i=t[r];s=s[i]||(s[i]=Object.create(null))}return s}function vr(s,e,t){return typeof e=="string"?Qt(Kt(s,e),t):Qt(Kt(s,""),e)}class zh{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,n)=>yr(n.backgroundColor),this.hoverBorderColor=(r,n)=>yr(n.borderColor),this.hoverColor=(r,n)=>yr(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return vr(this,e,t)}get(e){return Kt(this,e)}describe(e,t){return vr(Fr,e,t)}override(e,t){return vr(lt,e,t)}route(e,t,r,n){const i=Kt(this,e),a=Kt(this,r),o="_"+t;Object.defineProperties(i,{[o]:{value:i[t],writable:!0},[t]:{enumerable:!0,get(){const l=this[o],c=a[n];return W(l)?Object.assign({},c,l):V(l,c)},set(l){this[o]=l}}})}apply(e){e.forEach(t=>t(this))}}var Q=new zh({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Rh,Lh,Uh]);function Wh(s){return!s||oe(s.size)||oe(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function ei(s,e,t,r,n){let i=e[n];return i||(i=e[n]=s.measureText(n).width,t.push(n)),i>r&&(r=i),r}function et(s,e,t){const r=s.currentDevicePixelRatio,n=t!==0?Math.max(t/2,.5):0;return Math.round((e-n)*r)/r+n}function ti(s,e){!e&&!s||(e=e||s.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,s.width,s.height),e.restore())}function si(s,e,t,r){Ga(s,e,t,r,null)}function Ga(s,e,t,r,n){let i,a,o,l,c,h,u,f;const g=e.pointStyle,p=e.rotation,b=e.radius;let m=(p||0)*_h;if(g&&typeof g=="object"&&(i=g.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){s.save(),s.translate(t,r),s.rotate(m),s.drawImage(g,-g.width/2,-g.height/2,g.width,g.height),s.restore();return}if(!(isNaN(b)||b<=0)){switch(s.beginPath(),g){default:n?s.ellipse(t,r,n/2,b,0,0,te):s.arc(t,r,b,0,te),s.closePath();break;case"triangle":h=n?n/2:b,s.moveTo(t+Math.sin(m)*h,r-Math.cos(m)*b),m+=Vn,s.lineTo(t+Math.sin(m)*h,r-Math.cos(m)*b),m+=Vn,s.lineTo(t+Math.sin(m)*h,r-Math.cos(m)*b),s.closePath();break;case"rectRounded":c=b*.516,l=b-c,a=Math.cos(m+Ze)*l,u=Math.cos(m+Ze)*(n?n/2-c:l),o=Math.sin(m+Ze)*l,f=Math.sin(m+Ze)*(n?n/2-c:l),s.arc(t-u,r-o,c,m-Y,m-se),s.arc(t+f,r-a,c,m-se,m),s.arc(t+u,r+o,c,m,m+se),s.arc(t-f,r+a,c,m+se,m+Y),s.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*b,h=n?n/2:l,s.rect(t-h,r-l,2*h,2*l);break}m+=Ze;case"rectRot":u=Math.cos(m)*(n?n/2:b),a=Math.cos(m)*b,o=Math.sin(m)*b,f=Math.sin(m)*(n?n/2:b),s.moveTo(t-u,r-o),s.lineTo(t+f,r-a),s.lineTo(t+u,r+o),s.lineTo(t-f,r+a),s.closePath();break;case"crossRot":m+=Ze;case"cross":u=Math.cos(m)*(n?n/2:b),a=Math.cos(m)*b,o=Math.sin(m)*b,f=Math.sin(m)*(n?n/2:b),s.moveTo(t-u,r-o),s.lineTo(t+u,r+o),s.moveTo(t+f,r-a),s.lineTo(t-f,r+a);break;case"star":u=Math.cos(m)*(n?n/2:b),a=Math.cos(m)*b,o=Math.sin(m)*b,f=Math.sin(m)*(n?n/2:b),s.moveTo(t-u,r-o),s.lineTo(t+u,r+o),s.moveTo(t+f,r-a),s.lineTo(t-f,r+a),m+=Ze,u=Math.cos(m)*(n?n/2:b),a=Math.cos(m)*b,o=Math.sin(m)*b,f=Math.sin(m)*(n?n/2:b),s.moveTo(t-u,r-o),s.lineTo(t+u,r+o),s.moveTo(t+f,r-a),s.lineTo(t-f,r+a);break;case"line":a=n?n/2:Math.cos(m)*b,o=Math.sin(m)*b,s.moveTo(t-a,r-o),s.lineTo(t+a,r+o);break;case"dash":s.moveTo(t,r),s.lineTo(t+Math.cos(m)*(n?n/2:b),r+Math.sin(m)*b);break;case!1:s.closePath();break}s.fill(),e.borderWidth>0&&s.stroke()}}function Ya(s,e,t){return t=t||.5,!e||s&&s.x>e.left-t&&s.x<e.right+t&&s.y>e.top-t&&s.y<e.bottom+t}function nn(s,e){s.save(),s.beginPath(),s.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),s.clip()}function an(s){s.restore()}function Hh(s,e){e.translation&&s.translate(e.translation[0],e.translation[1]),oe(e.rotation)||s.rotate(e.rotation),e.color&&(s.fillStyle=e.color),e.textAlign&&(s.textAlign=e.textAlign),e.textBaseline&&(s.textBaseline=e.textBaseline)}function qh(s,e,t,r,n){if(n.strikethrough||n.underline){const i=s.measureText(r),a=e-i.actualBoundingBoxLeft,o=e+i.actualBoundingBoxRight,l=t-i.actualBoundingBoxAscent,c=t+i.actualBoundingBoxDescent,h=n.strikethrough?(l+c)/2:c;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=n.decorationWidth||2,s.moveTo(a,h),s.lineTo(o,h),s.stroke()}}function Vh(s,e){const t=s.fillStyle;s.fillStyle=e.color,s.fillRect(e.left,e.top,e.width,e.height),s.fillStyle=t}function zs(s,e,t,r,n,i={}){const a=ne(e)?e:[e],o=i.strokeWidth>0&&i.strokeColor!=="";let l,c;for(s.save(),s.font=n.string,Hh(s,i),l=0;l<a.length;++l)c=a[l],i.backdrop&&Vh(s,i.backdrop),o&&(i.strokeColor&&(s.strokeStyle=i.strokeColor),oe(i.strokeWidth)||(s.lineWidth=i.strokeWidth),s.strokeText(c,t,r,i.maxWidth)),s.fillText(c,t,r,i.maxWidth),qh(s,t,r,c,i),r+=Number(n.lineHeight);s.restore()}function Br(s,e){const{x:t,y:r,w:n,h:i,radius:a}=e;s.arc(t+a.topLeft,r+a.topLeft,a.topLeft,1.5*Y,Y,!0),s.lineTo(t,r+i-a.bottomLeft),s.arc(t+a.bottomLeft,r+i-a.bottomLeft,a.bottomLeft,Y,se,!0),s.lineTo(t+n-a.bottomRight,r+i),s.arc(t+n-a.bottomRight,r+i-a.bottomRight,a.bottomRight,se,0,!0),s.lineTo(t+n,r+a.topRight),s.arc(t+n-a.topRight,r+a.topRight,a.topRight,0,-se,!0),s.lineTo(t+a.topLeft,r)}const Kh=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Gh=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Yh(s,e){const t=(""+s).match(Kh);if(!t||t[1]==="normal")return e*1.2;switch(s=+t[2],t[3]){case"px":return s;case"%":s/=100;break}return e*s}const Jh=s=>+s||0;function on(s,e){const t={},r=W(e),n=r?Object.keys(e):e,i=W(s)?r?a=>V(s[a],s[e[a]]):a=>s[a]:()=>s;for(const a of n)t[a]=Jh(i(a));return t}function Xh(s){return on(s,{top:"y",right:"x",bottom:"y",left:"x"})}function Gt(s){return on(s,["topLeft","topRight","bottomLeft","bottomRight"])}function je(s){const e=Xh(s);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function fe(s,e){s=s||{},e=e||Q.font;let t=V(s.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let r=V(s.style,e.style);r&&!(""+r).match(Gh)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const n={family:V(s.family,e.family),lineHeight:Yh(V(s.lineHeight,e.lineHeight),t),size:t,style:r,weight:V(s.weight,e.weight),string:""};return n.string=Wh(n),n}function ps(s,e,t,r){let n,i,a;for(n=0,i=s.length;n<i;++n)if(a=s[n],a!==void 0&&a!==void 0)return a}function Qh(s,e,t){const{min:r,max:n}=s,i=$a(e,(n-r)/2),a=(o,l)=>t&&o===0?0:o+l;return{min:a(r,-Math.abs(i)),max:a(n,i)}}function Nt(s,e){return Object.assign(Object.create(s),e)}function ln(s,e=[""],t,r,n=()=>s[0]){const i=t||s;typeof r>"u"&&(r=Za("_fallback",s));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:i,_fallback:r,_getTarget:n,override:o=>ln([o,...s],e,i,r)};return new Proxy(a,{deleteProperty(o,l){return delete o[l],delete o._keys,delete s[0][l],!0},get(o,l){return Xa(o,l,()=>au(l,e,s,o))},getOwnPropertyDescriptor(o,l){return Reflect.getOwnPropertyDescriptor(o._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(o,l){return ni(o).includes(l)},ownKeys(o){return ni(o)},set(o,l,c){const h=o._storage||(o._storage=n());return o[l]=h[l]=c,delete o._keys,!0}})}function kt(s,e,t,r){const n={_cacheable:!1,_proxy:s,_context:e,_subProxy:t,_stack:new Set,_descriptors:Ja(s,r),setContext:i=>kt(s,i,t,r),override:i=>kt(s.override(i),e,t,r)};return new Proxy(n,{deleteProperty(i,a){return delete i[a],delete s[a],!0},get(i,a,o){return Xa(i,a,()=>eu(i,a,o))},getOwnPropertyDescriptor(i,a){return i._descriptors.allKeys?Reflect.has(s,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,a)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(i,a){return Reflect.has(s,a)},ownKeys(){return Reflect.ownKeys(s)},set(i,a,o){return s[a]=o,delete i[a],!0}})}function Ja(s,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:r=e.indexable,_allKeys:n=e.allKeys}=s;return{allKeys:n,scriptable:t,indexable:r,isScriptable:Ge(t)?t:()=>t,isIndexable:Ge(r)?r:()=>r}}const Zh=(s,e)=>s?s+sn(e):e,cn=(s,e)=>W(e)&&s!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function Xa(s,e,t){if(Object.prototype.hasOwnProperty.call(s,e)||e==="constructor")return s[e];const r=t();return s[e]=r,r}function eu(s,e,t){const{_proxy:r,_context:n,_subProxy:i,_descriptors:a}=s;let o=r[e];return Ge(o)&&a.isScriptable(e)&&(o=tu(e,o,s,t)),ne(o)&&o.length&&(o=su(e,o,s,a.isIndexable)),cn(e,o)&&(o=kt(o,n,i&&i[e],a)),o}function tu(s,e,t,r){const{_proxy:n,_context:i,_subProxy:a,_stack:o}=t;if(o.has(s))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+s);o.add(s);let l=e(i,a||r);return o.delete(s),cn(s,l)&&(l=dn(n._scopes,n,s,l)),l}function su(s,e,t,r){const{_proxy:n,_context:i,_subProxy:a,_descriptors:o}=t;if(typeof i.index<"u"&&r(s))return e[i.index%e.length];if(W(e[0])){const l=e,c=n._scopes.filter(h=>h!==l);e=[];for(const h of l){const u=dn(c,n,s,h);e.push(kt(u,i,a&&a[s],o))}}return e}function Qa(s,e,t){return Ge(s)?s(e,t):s}const ru=(s,e)=>s===!0?e:typeof s=="string"?Zt(e,s):void 0;function nu(s,e,t,r,n){for(const i of e){const a=ru(t,i);if(a){s.add(a);const o=Qa(a._fallback,t,n);if(typeof o<"u"&&o!==t&&o!==r)return o}else if(a===!1&&typeof r<"u"&&t!==r)return null}return!1}function dn(s,e,t,r){const n=e._rootScopes,i=Qa(e._fallback,t,r),a=[...s,...n],o=new Set;o.add(r);let l=ri(o,a,t,i||t,r);return l===null||typeof i<"u"&&i!==t&&(l=ri(o,a,i,l,r),l===null)?!1:ln(Array.from(o),[""],n,i,()=>iu(e,t,r))}function ri(s,e,t,r,n){for(;t;)t=nu(s,e,t,r,n);return t}function iu(s,e,t){const r=s._getTarget();e in r||(r[e]={});const n=r[e];return ne(n)&&W(t)?t:n||{}}function au(s,e,t,r){let n;for(const i of e)if(n=Za(Zh(i,s),t),typeof n<"u")return cn(s,n)?dn(t,r,s,n):n}function Za(s,e){for(const t of e){if(!t)continue;const r=t[s];if(typeof r<"u")return r}}function ni(s){let e=s._keys;return e||(e=s._keys=ou(s._scopes)),e}function ou(s){const e=new Set;for(const t of s)for(const r of Object.keys(t).filter(n=>!n.startsWith("_")))e.add(r);return Array.from(e)}function hn(){return typeof window<"u"&&typeof document<"u"}function un(s){let e=s.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Ws(s,e,t){let r;return typeof s=="string"?(r=parseInt(s,10),s.indexOf("%")!==-1&&(r=r/100*e.parentNode[t])):r=s,r}const sr=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function lu(s,e){return sr(s).getPropertyValue(e)}const cu=["top","right","bottom","left"];function ot(s,e,t){const r={};t=t?"-"+t:"";for(let n=0;n<4;n++){const i=cu[n];r[i]=parseFloat(s[e+"-"+i+t])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const du=(s,e,t)=>(s>0||e>0)&&(!t||!t.shadowRoot);function hu(s,e){const t=s.touches,r=t&&t.length?t[0]:s,{offsetX:n,offsetY:i}=r;let a=!1,o,l;if(du(n,i,s.target))o=n,l=i;else{const c=e.getBoundingClientRect();o=r.clientX-c.left,l=r.clientY-c.top,a=!0}return{x:o,y:l,box:a}}function rt(s,e){if("native"in s)return s;const{canvas:t,currentDevicePixelRatio:r}=e,n=sr(t),i=n.boxSizing==="border-box",a=ot(n,"padding"),o=ot(n,"border","width"),{x:l,y:c,box:h}=hu(s,t),u=a.left+(h&&o.left),f=a.top+(h&&o.top);let{width:g,height:p}=e;return i&&(g-=a.width+o.width,p-=a.height+o.height),{x:Math.round((l-u)/g*t.width/r),y:Math.round((c-f)/p*t.height/r)}}function uu(s,e,t){let r,n;if(e===void 0||t===void 0){const i=s&&un(s);if(!i)e=s.clientWidth,t=s.clientHeight;else{const a=i.getBoundingClientRect(),o=sr(i),l=ot(o,"border","width"),c=ot(o,"padding");e=a.width-c.width-l.width,t=a.height-c.height-l.height,r=Ws(o.maxWidth,i,"clientWidth"),n=Ws(o.maxHeight,i,"clientHeight")}}return{width:e,height:t,maxWidth:r||Fs,maxHeight:n||Fs}}const bs=s=>Math.round(s*10)/10;function fu(s,e,t,r){const n=sr(s),i=ot(n,"margin"),a=Ws(n.maxWidth,s,"clientWidth")||Fs,o=Ws(n.maxHeight,s,"clientHeight")||Fs,l=uu(s,e,t);let{width:c,height:h}=l;if(n.boxSizing==="content-box"){const f=ot(n,"border","width"),g=ot(n,"padding");c-=g.width+f.width,h-=g.height+f.height}return c=Math.max(0,c-i.width),h=Math.max(0,r?c/r:h-i.height),c=bs(Math.min(c,a,l.maxWidth)),h=bs(Math.min(h,o,l.maxHeight)),c&&!h&&(h=bs(c/2)),(e!==void 0||t!==void 0)&&r&&l.height&&h>l.height&&(h=l.height,c=bs(Math.floor(h*r))),{width:c,height:h}}function ii(s,e,t){const r=e||1,n=Math.floor(s.height*r),i=Math.floor(s.width*r);s.height=Math.floor(s.height),s.width=Math.floor(s.width);const a=s.canvas;return a.style&&(t||!a.style.height&&!a.style.width)&&(a.style.height=`${s.height}px`,a.style.width=`${s.width}px`),s.currentDevicePixelRatio!==r||a.height!==n||a.width!==i?(s.currentDevicePixelRatio=r,a.height=n,a.width=i,s.ctx.setTransform(r,0,0,r,0,0),!0):!1}const gu=function(){let s=!1;try{const e={get passive(){return s=!0,!1}};hn()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return s}();function ai(s,e){const t=lu(s,e),r=t&&t.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}const mu=function(s,e){return{x(t){return s+s+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,r){return t-r},leftForLtr(t,r){return t-r}}},pu=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,e){return s+e},leftForLtr(s,e){return s}}};function vt(s,e,t){return s?mu(e,t):pu()}function eo(s,e){let t,r;(e==="ltr"||e==="rtl")&&(t=s.canvas.style,r=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),s.prevTextDirection=r)}function to(s,e){e!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",e[0],e[1]))}function xs(s,e,t){return s.options.clip?s[t]:e[t]}function bu(s,e){const{xScale:t,yScale:r}=s;return t&&r?{left:xs(t,e,"left"),right:xs(t,e,"right"),top:xs(r,e,"top"),bottom:xs(r,e,"bottom")}:e}function xu(s,e){const t=e._clip;if(t.disabled)return!1;const r=bu(e,s.chartArea);return{left:t.left===!1?0:r.left-(t.left===!0?0:t.left),right:t.right===!1?s.width:r.right+(t.right===!0?0:t.right),top:t.top===!1?0:r.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?s.height:r.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class yu{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,r,n){const i=t.listeners[n],a=t.duration;i.forEach(o=>o({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(r-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=za.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((r,n)=>{if(!r.running||!r.items.length)return;const i=r.items;let a=i.length-1,o=!1,l;for(;a>=0;--a)l=i[a],l._active?(l._total>r.duration&&(r.duration=l._total),l.tick(e),o=!0):(i[a]=i[i.length-1],i.pop());o&&(n.draw(),this._notify(n,r,e,"progress")),i.length||(r.running=!1,this._notify(n,r,e,"complete"),r.initial=!1),t+=i.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let r=t.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,r)),r}listen(e,t,r){this._getAnims(e).listeners[t].push(r)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((r,n)=>Math.max(r,n._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const r=t.items;let n=r.length-1;for(;n>=0;--n)r[n].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Ie=new yu;const oi="transparent",vu={boolean(s,e,t){return t>.5?e:s},color(s,e,t){const r=Qn(s||oi),n=r.valid&&Qn(e||oi);return n&&n.valid?n.mix(r,t).hexString():e},number(s,e,t){return s+(e-s)*t}};class wu{constructor(e,t,r,n){const i=t[r];n=ps([e.to,n,i,e.from]);const a=ps([e.from,i,n]);this._active=!0,this._fn=e.fn||vu[e.type||typeof a],this._easing=Vt[e.easing]||Vt.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=r,this._from=a,this._to=n,this._promises=void 0}active(){return this._active}update(e,t,r){if(this._active){this._notify(!1);const n=this._target[this._prop],i=r-this._start,a=this._duration-i;this._start=r,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=ps([e.to,t,n,e.from]),this._from=ps([e.from,n,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,r=this._duration,n=this._prop,i=this._from,a=this._loop,o=this._to;let l;if(this._active=i!==o&&(a||t<r),!this._active){this._target[n]=o,this._notify(!0);return}if(t<0){this._target[n]=i;return}l=t/r%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[n]=this._fn(i,o,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,r)=>{e.push({res:t,rej:r})})}_notify(e){const t=e?"res":"rej",r=this._promises||[];for(let n=0;n<r.length;n++)r[n][t]()}}class so{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!W(e))return;const t=Object.keys(Q.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(n=>{const i=e[n];if(!W(i))return;const a={};for(const o of t)a[o]=i[o];(ne(i.properties)&&i.properties||[n]).forEach(o=>{(o===n||!r.has(o))&&r.set(o,a)})})}_animateOptions(e,t){const r=t.options,n=ku(e,r);if(!n)return[];const i=this._createAnimations(n,r);return r.$shared&&_u(e.options.$animations,r).then(()=>{e.options=r},()=>{}),i}_createAnimations(e,t){const r=this._properties,n=[],i=e.$animations||(e.$animations={}),a=Object.keys(t),o=Date.now();let l;for(l=a.length-1;l>=0;--l){const c=a[l];if(c.charAt(0)==="$")continue;if(c==="options"){n.push(...this._animateOptions(e,t));continue}const h=t[c];let u=i[c];const f=r.get(c);if(u)if(f&&u.active()){u.update(f,h,o);continue}else u.cancel();if(!f||!f.duration){e[c]=h;continue}i[c]=u=new wu(f,e,c,h),n.push(u)}return n}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const r=this._createAnimations(e,t);if(r.length)return Ie.add(this._chart,r),!0}}function _u(s,e){const t=[],r=Object.keys(e);for(let n=0;n<r.length;n++){const i=s[r[n]];i&&i.active()&&t.push(i.wait())}return Promise.all(t)}function ku(s,e){if(!e)return;let t=s.options;if(!t){s.options=e;return}return t.$shared&&(s.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function li(s,e){const t=s&&s.options||{},r=t.reverse,n=t.min===void 0?e:0,i=t.max===void 0?e:0;return{start:r?i:n,end:r?n:i}}function ju(s,e,t){if(t===!1)return!1;const r=li(s,t),n=li(e,t);return{top:n.end,right:r.end,bottom:n.start,left:r.start}}function Su(s){let e,t,r,n;return W(s)?(e=s.top,t=s.right,r=s.bottom,n=s.left):e=t=r=n=s,{top:e,right:t,bottom:r,left:n,disabled:s===!1}}function ro(s,e){const t=[],r=s._getSortedDatasetMetas(e);let n,i;for(n=0,i=r.length;n<i;++n)t.push(r[n].index);return t}function ci(s,e,t,r={}){const n=s.keys,i=r.mode==="single";let a,o,l,c;if(e===null)return;let h=!1;for(a=0,o=n.length;a<o;++a){if(l=+n[a],l===t){if(h=!0,r.all)continue;break}c=s.values[l],Le(c)&&(i||e===0||Gn(e)===Gn(c))&&(e+=c)}return!h&&!r.all?0:e}function Nu(s,e){const{iScale:t,vScale:r}=e,n=t.axis==="x"?"x":"y",i=r.axis==="x"?"x":"y",a=Object.keys(s),o=new Array(a.length);let l,c,h;for(l=0,c=a.length;l<c;++l)h=a[l],o[l]={[n]:h,[i]:s[h]};return o}function wr(s,e){const t=s&&s.options.stacked;return t||t===void 0&&e.stack!==void 0}function Cu(s,e,t){return`${s.id}.${e.id}.${t.stack||t.type}`}function Tu(s){const{min:e,max:t,minDefined:r,maxDefined:n}=s.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:n?t:Number.POSITIVE_INFINITY}}function Au(s,e,t){const r=s[e]||(s[e]={});return r[t]||(r[t]={})}function di(s,e,t,r){for(const n of e.getMatchingVisibleMetas(r).reverse()){const i=s[n.index];if(t&&i>0||!t&&i<0)return n.index}return null}function hi(s,e){const{chart:t,_cachedMeta:r}=s,n=t._stacks||(t._stacks={}),{iScale:i,vScale:a,index:o}=r,l=i.axis,c=a.axis,h=Cu(i,a,r),u=e.length;let f;for(let g=0;g<u;++g){const p=e[g],{[l]:b,[c]:m}=p,x=p._stacks||(p._stacks={});f=x[c]=Au(n,h,b),f[o]=m,f._top=di(f,a,!0,r.type),f._bottom=di(f,a,!1,r.type);const w=f._visualValues||(f._visualValues={});w[o]=m}}function _r(s,e){const t=s.scales;return Object.keys(t).filter(r=>t[r].axis===e).shift()}function Ou(s,e){return Nt(s,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Eu(s,e,t){return Nt(s,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function At(s,e){const t=s.controller.index,r=s.vScale&&s.vScale.axis;if(r){e=e||s._parsed;for(const n of e){const i=n._stacks;if(!i||i[r]===void 0||i[r][t]===void 0)return;delete i[r][t],i[r]._visualValues!==void 0&&i[r]._visualValues[t]!==void 0&&delete i[r]._visualValues[t]}}}const kr=s=>s==="reset"||s==="none",ui=(s,e)=>e?s:Object.assign({},s),Pu=(s,e,t)=>s&&!e.hidden&&e._stacked&&{keys:ro(t,!0),values:null};class Yt{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=wr(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&At(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,r=this.getDataset(),n=(u,f,g,p)=>u==="x"?f:u==="r"?p:g,i=t.xAxisID=V(r.xAxisID,_r(e,"x")),a=t.yAxisID=V(r.yAxisID,_r(e,"y")),o=t.rAxisID=V(r.rAxisID,_r(e,"r")),l=t.indexAxis,c=t.iAxisID=n(l,i,a,o),h=t.vAxisID=n(l,a,i,o);t.xScale=this.getScaleForId(i),t.yScale=this.getScaleForId(a),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(c),t.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&Yn(this._data,this),e._stacked&&At(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),r=this._data;if(W(t)){const n=this._cachedMeta;this._data=Nu(t,n)}else if(r!==t){if(r){Yn(r,this);const n=this._cachedMeta;At(n),n._parsed=[]}t&&Object.isExtensible(t)&&Oh(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,r=this.getDataset();let n=!1;this._dataCheck();const i=t._stacked;t._stacked=wr(t.vScale,t),t.stack!==r.stack&&(n=!0,At(t),t.stack=r.stack),this._resyncElements(e),(n||i!==t._stacked)&&(hi(this,t._parsed),t._stacked=wr(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:r,_data:n}=this,{iScale:i,_stacked:a}=r,o=i.axis;let l=e===0&&t===n.length?!0:r._sorted,c=e>0&&r._parsed[e-1],h,u,f;if(this._parsing===!1)r._parsed=n,r._sorted=!0,f=n;else{ne(n[e])?f=this.parseArrayData(r,n,e,t):W(n[e])?f=this.parseObjectData(r,n,e,t):f=this.parsePrimitiveData(r,n,e,t);const g=()=>u[o]===null||c&&u[o]<c[o];for(h=0;h<t;++h)r._parsed[h+e]=u=f[h],l&&(g()&&(l=!1),c=u);r._sorted=l}a&&hi(this,f)}parsePrimitiveData(e,t,r,n){const{iScale:i,vScale:a}=e,o=i.axis,l=a.axis,c=i.getLabels(),h=i===a,u=new Array(n);let f,g,p;for(f=0,g=n;f<g;++f)p=f+r,u[f]={[o]:h||i.parse(c[p],p),[l]:a.parse(t[p],p)};return u}parseArrayData(e,t,r,n){const{xScale:i,yScale:a}=e,o=new Array(n);let l,c,h,u;for(l=0,c=n;l<c;++l)h=l+r,u=t[h],o[l]={x:i.parse(u[0],h),y:a.parse(u[1],h)};return o}parseObjectData(e,t,r,n){const{xScale:i,yScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,c=new Array(n);let h,u,f,g;for(h=0,u=n;h<u;++h)f=h+r,g=t[f],c[h]={x:i.parse(Zt(g,o),f),y:a.parse(Zt(g,l),f)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,r){const n=this.chart,i=this._cachedMeta,a=t[e.axis],o={keys:ro(n,!0),values:t._stacks[e.axis]._visualValues};return ci(o,a,i.index,{mode:r})}updateRangeFromParsed(e,t,r,n){const i=r[t.axis];let a=i===null?NaN:i;const o=n&&r._stacks[t.axis];n&&o&&(n.values=o,a=ci(n,i,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,t){const r=this._cachedMeta,n=r._parsed,i=r._sorted&&e===r.iScale,a=n.length,o=this._getOtherScale(e),l=Pu(t,r,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:u}=Tu(o);let f,g;function p(){g=n[f];const b=g[o.axis];return!Le(g[e.axis])||h>b||u<b}for(f=0;f<a&&!(!p()&&(this.updateRangeFromParsed(c,e,g,l),i));++f);if(i){for(f=a-1;f>=0;--f)if(!p()){this.updateRangeFromParsed(c,e,g,l);break}}return c}getAllParsedValues(e){const t=this._cachedMeta._parsed,r=[];let n,i,a;for(n=0,i=t.length;n<i;++n)a=t[n][e.axis],Le(a)&&r.push(a);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,r=t.iScale,n=t.vScale,i=this.getParsed(e);return{label:r?""+r.getLabelForValue(i[r.axis]):"",value:n?""+n.getLabelForValue(i[n.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=Su(V(this.options.clip,ju(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,r=this._cachedMeta,n=r.data||[],i=t.chartArea,a=[],o=this._drawStart||0,l=this._drawCount||n.length-o,c=this.options.drawActiveElementsOnTop;let h;for(r.dataset&&r.dataset.draw(e,i,o,l),h=o;h<o+l;++h){const u=n[h];u.hidden||(u.active&&c?a.push(u):u.draw(e,i))}for(h=0;h<a.length;++h)a[h].draw(e,i)}getStyle(e,t){const r=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,t,r){const n=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];i=a.$context||(a.$context=Eu(this.getContext(),e,a)),i.parsed=this.getParsed(e),i.raw=n.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=Ou(this.chart.getContext(),this.index)),i.dataset=n,i.index=i.datasetIndex=this.index;return i.active=!!t,i.mode=r,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",r){const n=t==="active",i=this._cachedDataOpts,a=e+"-"+t,o=i[a],l=this.enableOptionSharing&&$s(r);if(o)return ui(o,l);const c=this.chart.config,h=c.datasetElementScopeKeys(this._type,e),u=n?[`${e}Hover`,"hover",e,""]:[e,""],f=c.getOptionScopes(this.getDataset(),h),g=Object.keys(Q.elements[e]),p=()=>this.getContext(r,n,t),b=c.resolveNamedOptions(f,g,p,u);return b.$shared&&(b.$shared=l,i[a]=Object.freeze(ui(b,l))),b}_resolveAnimations(e,t,r){const n=this.chart,i=this._cachedDataOpts,a=`animation-${t}`,o=i[a];if(o)return o;let l;if(n.options.animation!==!1){const h=this.chart.config,u=h.datasetAnimationScopeKeys(this._type,t),f=h.getOptionScopes(this.getDataset(),u);l=h.createResolver(f,this.getContext(e,r,t))}const c=new so(n,l&&l.animations);return l&&l._cacheable&&(i[a]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||kr(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const r=this.resolveDataElementOptions(e,t),n=this._sharedOptions,i=this.getSharedOptions(r),a=this.includeOptions(t,i)||i!==n;return this.updateSharedOptions(i,t,r),{sharedOptions:i,includeOptions:a}}updateElement(e,t,r,n){kr(n)?Object.assign(e,r):this._resolveAnimations(t,n).update(e,r)}updateSharedOptions(e,t,r){e&&!kr(t)&&this._resolveAnimations(void 0,t).update(e,r)}_setStyle(e,t,r,n){e.active=n;const i=this.getStyle(t,n);this._resolveAnimations(t,r,n).update(e,{options:!n&&this.getSharedOptions(i)||i})}removeHoverStyle(e,t,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,t,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,r=this._cachedMeta.data;for(const[o,l,c]of this._syncList)this[o](l,c);this._syncList=[];const n=r.length,i=t.length,a=Math.min(i,n);a&&this.parse(0,a),i>n?this._insertElements(n,i-n,e):i<n&&this._removeElements(i,n-i)}_insertElements(e,t,r=!0){const n=this._cachedMeta,i=n.data,a=e+t;let o;const l=c=>{for(c.length+=t,o=c.length-1;o>=a;o--)c[o]=c[o-t]};for(l(i),o=e;o<a;++o)i[o]=new this.dataElementType;this._parsing&&l(n._parsed),this.parse(e,t),r&&this.updateElements(i,e,t,"reset")}updateElements(e,t,r,n){}_removeElements(e,t){const r=this._cachedMeta;if(this._parsing){const n=r._parsed.splice(e,t);r._stacked&&At(r,n)}r.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,r,n]=e;this[t](r,n)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}$(Yt,"defaults",{}),$(Yt,"datasetElementType",null),$(Yt,"dataElementType",null);function Iu(s,e,t){let r=1,n=1,i=0,a=0;if(e<te){const o=s,l=o+e,c=Math.cos(o),h=Math.sin(o),u=Math.cos(l),f=Math.sin(l),g=(y,v,k)=>Us(y,o,l,!0)?1:Math.max(v,v*t,k,k*t),p=(y,v,k)=>Us(y,o,l,!0)?-1:Math.min(v,v*t,k,k*t),b=g(0,c,u),m=g(se,h,f),x=p(Y,c,u),w=p(Y+se,h,f);r=(b-x)/2,n=(m-w)/2,i=-(b+x)/2,a=-(m+w)/2}return{ratioX:r,ratioY:n,offsetX:i,offsetY:a}}class Lt extends Yt{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const r=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=r;else{let i=l=>+r[l];if(W(r[e])){const{key:l="value"}=this._parsing;i=c=>+Zt(r[c],l)}let a,o;for(a=e,o=e+t;a<o;++a)n._parsed[a]=i(a)}}_getRotation(){return it(this.options.rotation-90)}_getCircumference(){return it(this.options.circumference)}_getRotationExtents(){let e=te,t=-te;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const n=this.chart.getDatasetMeta(r).controller,i=n._getRotation(),a=n._getCircumference();e=Math.min(e,i),t=Math.max(t,i+a)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:r}=t,n=this._cachedMeta,i=n.data,a=this.getMaxBorderWidth()+this.getMaxOffset(i)+this.options.spacing,o=Math.max((Math.min(r.width,r.height)-a)/2,0),l=Math.min(ph(this.options.cutout,o),1),c=this._getRingWeight(this.index),{circumference:h,rotation:u}=this._getRotationExtents(),{ratioX:f,ratioY:g,offsetX:p,offsetY:b}=Iu(u,h,l),m=(r.width-a)/f,x=(r.height-a)/g,w=Math.max(Math.min(m,x)/2,0),y=$a(this.options.radius,w),v=Math.max(y*l,0),k=(y-v)/this._getVisibleDatasetWeightTotal();this.offsetX=p*y,this.offsetY=b*y,n.total=this.calculateTotal(),this.outerRadius=y-k*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-k*c,0),this.updateElements(i,0,i.length,e)}_circumference(e,t){const r=this.options,n=this._cachedMeta,i=this._getCircumference();return t&&r.animation.animateRotate||!this.chart.getDataVisibility(e)||n._parsed[e]===null||n.data[e].hidden?0:this.calculateCircumference(n._parsed[e]*i/te)}updateElements(e,t,r,n){const i=n==="reset",a=this.chart,o=a.chartArea,c=a.options.animation,h=(o.left+o.right)/2,u=(o.top+o.bottom)/2,f=i&&c.animateScale,g=f?0:this.innerRadius,p=f?0:this.outerRadius,{sharedOptions:b,includeOptions:m}=this._getSharedOptions(t,n);let x=this._getRotation(),w;for(w=0;w<t;++w)x+=this._circumference(w,i);for(w=t;w<t+r;++w){const y=this._circumference(w,i),v=e[w],k={x:h+this.offsetX,y:u+this.offsetY,startAngle:x,endAngle:x+y,circumference:y,outerRadius:p,innerRadius:g};m&&(k.options=b||this.resolveDataElementOptions(w,v.active?"active":n)),x+=y,this.updateElement(v,w,k,n)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let r=0,n;for(n=0;n<t.length;n++){const i=e._parsed[n];i!==null&&!isNaN(i)&&this.chart.getDataVisibility(n)&&!t[n].hidden&&(r+=Math.abs(i))}return r}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?te*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,r=this.chart,n=r.data.labels||[],i=Va(t._parsed[e],r.options.locale);return{label:n[e]||"",value:i}}getMaxBorderWidth(e){let t=0;const r=this.chart;let n,i,a,o,l;if(!e){for(n=0,i=r.data.datasets.length;n<i;++n)if(r.isDatasetVisible(n)){a=r.getDatasetMeta(n),e=a.data,o=a.controller;break}}if(!e)return 0;for(n=0,i=e.length;n<i;++n)l=o.resolveDataElementOptions(n),l.borderAlign!=="inner"&&(t=Math.max(t,l.borderWidth||0,l.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let r=0,n=e.length;r<n;++r){const i=this.resolveDataElementOptions(r);t=Math.max(t,i.offset||0,i.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let r=0;r<e;++r)this.chart.isDatasetVisible(r)&&(t+=this._getRingWeight(r));return t}_getRingWeight(e){return Math.max(V(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}$(Lt,"id","doughnut"),$(Lt,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),$(Lt,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),$(Lt,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:r,color:n}}=e.legend.options;return t.labels.map((i,a)=>{const l=e.getDatasetMeta(0).controller.getStyle(a);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:n,lineWidth:l.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(a),index:a}})}return[]}},onClick(e,t,r){r.chart.toggleDataVisibility(t.index),r.chart.update()}}}});class Ur extends Lt{}$(Ur,"id","pie"),$(Ur,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});function tt(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fn{constructor(e){$(this,"options");this.options=e||{}}static override(e){Object.assign(fn.prototype,e)}init(){}formats(){return tt()}parse(){return tt()}format(){return tt()}add(){return tt()}diff(){return tt()}startOf(){return tt()}endOf(){return tt()}}var Du={_date:fn};function Mu(s,e,t,r){const{controller:n,data:i,_sorted:a}=s,o=n._cachedMeta.iScale,l=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(o&&e===o.axis&&e!=="r"&&a&&i.length){const c=o._reversePixels?Th:$r;if(r){if(n._sharedOptions){const h=i[0],u=typeof h.getRange=="function"&&h.getRange(e);if(u){const f=c(i,e,t-u),g=c(i,e,t+u);return{lo:f.lo,hi:g.hi}}}}else{const h=c(i,e,t);if(l){const{vScale:u}=n._cachedMeta,{_parsed:f}=s,g=f.slice(0,h.lo+1).reverse().findIndex(b=>!oe(b[u.axis]));h.lo-=Math.max(0,g);const p=f.slice(h.hi).findIndex(b=>!oe(b[u.axis]));h.hi+=Math.max(0,p)}return h}}return{lo:0,hi:i.length-1}}function is(s,e,t,r,n){const i=s.getSortedVisibleDatasetMetas(),a=t[e];for(let o=0,l=i.length;o<l;++o){const{index:c,data:h}=i[o],{lo:u,hi:f}=Mu(i[o],e,a,n);for(let g=u;g<=f;++g){const p=h[g];p.skip||r(p,c,g)}}}function Ru(s){const e=s.indexOf("x")!==-1,t=s.indexOf("y")!==-1;return function(r,n){const i=e?Math.abs(r.x-n.x):0,a=t?Math.abs(r.y-n.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(a,2))}}function jr(s,e,t,r,n){const i=[];return!n&&!s.isPointInArea(e)||is(s,t,e,function(o,l,c){!n&&!Ya(o,s.chartArea,0)||o.inRange(e.x,e.y,r)&&i.push({element:o,datasetIndex:l,index:c})},!0),i}function Lu(s,e,t,r){let n=[];function i(a,o,l){const{startAngle:c,endAngle:h}=a.getProps(["startAngle","endAngle"],r),{angle:u}=Ba(a,{x:e.x,y:e.y});Us(u,c,h)&&n.push({element:a,datasetIndex:o,index:l})}return is(s,t,e,i),n}function $u(s,e,t,r,n,i){let a=[];const o=Ru(t);let l=Number.POSITIVE_INFINITY;function c(h,u,f){const g=h.inRange(e.x,e.y,n);if(r&&!g)return;const p=h.getCenterPoint(n);if(!(!!i||s.isPointInArea(p))&&!g)return;const m=o(e,p);m<l?(a=[{element:h,datasetIndex:u,index:f}],l=m):m===l&&a.push({element:h,datasetIndex:u,index:f})}return is(s,t,e,c),a}function Sr(s,e,t,r,n,i){return!i&&!s.isPointInArea(e)?[]:t==="r"&&!r?Lu(s,e,t,n):$u(s,e,t,r,n,i)}function fi(s,e,t,r,n){const i=[],a=t==="x"?"inXRange":"inYRange";let o=!1;return is(s,t,e,(l,c,h)=>{l[a]&&l[a](e[t],n)&&(i.push({element:l,datasetIndex:c,index:h}),o=o||l.inRange(e.x,e.y,n))}),r&&!o?[]:i}var Fu={evaluateInteractionItems:is,modes:{index(s,e,t,r){const n=rt(e,s),i=t.axis||"x",a=t.includeInvisible||!1,o=t.intersect?jr(s,n,i,r,a):Sr(s,n,i,!1,r,a),l=[];return o.length?(s.getSortedVisibleDatasetMetas().forEach(c=>{const h=o[0].index,u=c.data[h];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:h})}),l):[]},dataset(s,e,t,r){const n=rt(e,s),i=t.axis||"xy",a=t.includeInvisible||!1;let o=t.intersect?jr(s,n,i,r,a):Sr(s,n,i,!1,r,a);if(o.length>0){const l=o[0].datasetIndex,c=s.getDatasetMeta(l).data;o=[];for(let h=0;h<c.length;++h)o.push({element:c[h],datasetIndex:l,index:h})}return o},point(s,e,t,r){const n=rt(e,s),i=t.axis||"xy",a=t.includeInvisible||!1;return jr(s,n,i,r,a)},nearest(s,e,t,r){const n=rt(e,s),i=t.axis||"xy",a=t.includeInvisible||!1;return Sr(s,n,i,t.intersect,r,a)},x(s,e,t,r){const n=rt(e,s);return fi(s,n,"x",t.intersect,r)},y(s,e,t,r){const n=rt(e,s);return fi(s,n,"y",t.intersect,r)}}};const no=["left","top","right","bottom"];function Ot(s,e){return s.filter(t=>t.pos===e)}function gi(s,e){return s.filter(t=>no.indexOf(t.pos)===-1&&t.box.axis===e)}function Et(s,e){return s.sort((t,r)=>{const n=e?r:t,i=e?t:r;return n.weight===i.weight?n.index-i.index:n.weight-i.weight})}function Bu(s){const e=[];let t,r,n,i,a,o;for(t=0,r=(s||[]).length;t<r;++t)n=s[t],{position:i,options:{stack:a,stackWeight:o=1}}=n,e.push({index:t,box:n,pos:i,horizontal:n.isHorizontal(),weight:n.weight,stack:a&&i+a,stackWeight:o});return e}function Uu(s){const e={};for(const t of s){const{stack:r,pos:n,stackWeight:i}=t;if(!r||!no.includes(n))continue;const a=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=i}return e}function zu(s,e){const t=Uu(s),{vBoxMaxWidth:r,hBoxMaxHeight:n}=e;let i,a,o;for(i=0,a=s.length;i<a;++i){o=s[i];const{fullSize:l}=o.box,c=t[o.stack],h=c&&o.stackWeight/c.weight;o.horizontal?(o.width=h?h*r:l&&e.availableWidth,o.height=n):(o.width=r,o.height=h?h*n:l&&e.availableHeight)}return t}function Wu(s){const e=Bu(s),t=Et(e.filter(c=>c.box.fullSize),!0),r=Et(Ot(e,"left"),!0),n=Et(Ot(e,"right")),i=Et(Ot(e,"top"),!0),a=Et(Ot(e,"bottom")),o=gi(e,"x"),l=gi(e,"y");return{fullSize:t,leftAndTop:r.concat(i),rightAndBottom:n.concat(l).concat(a).concat(o),chartArea:Ot(e,"chartArea"),vertical:r.concat(n).concat(l),horizontal:i.concat(a).concat(o)}}function mi(s,e,t,r){return Math.max(s[t],e[t])+Math.max(s[r],e[r])}function io(s,e){s.top=Math.max(s.top,e.top),s.left=Math.max(s.left,e.left),s.bottom=Math.max(s.bottom,e.bottom),s.right=Math.max(s.right,e.right)}function Hu(s,e,t,r){const{pos:n,box:i}=t,a=s.maxPadding;if(!W(n)){t.size&&(s[n]-=t.size);const u=r[t.stack]||{size:0,count:1};u.size=Math.max(u.size,t.horizontal?i.height:i.width),t.size=u.size/u.count,s[n]+=t.size}i.getPadding&&io(a,i.getPadding());const o=Math.max(0,e.outerWidth-mi(a,s,"left","right")),l=Math.max(0,e.outerHeight-mi(a,s,"top","bottom")),c=o!==s.w,h=l!==s.h;return s.w=o,s.h=l,t.horizontal?{same:c,other:h}:{same:h,other:c}}function qu(s){const e=s.maxPadding;function t(r){const n=Math.max(e[r]-s[r],0);return s[r]+=n,n}s.y+=t("top"),s.x+=t("left"),t("right"),t("bottom")}function Vu(s,e){const t=e.maxPadding;function r(n){const i={left:0,top:0,right:0,bottom:0};return n.forEach(a=>{i[a]=Math.max(e[a],t[a])}),i}return r(s?["left","right"]:["top","bottom"])}function $t(s,e,t,r){const n=[];let i,a,o,l,c,h;for(i=0,a=s.length,c=0;i<a;++i){o=s[i],l=o.box,l.update(o.width||e.w,o.height||e.h,Vu(o.horizontal,e));const{same:u,other:f}=Hu(e,t,o,r);c|=u&&n.length,h=h||f,l.fullSize||n.push(o)}return c&&$t(n,e,t,r)||h}function ys(s,e,t,r,n){s.top=t,s.left=e,s.right=e+r,s.bottom=t+n,s.width=r,s.height=n}function pi(s,e,t,r){const n=t.padding;let{x:i,y:a}=e;for(const o of s){const l=o.box,c=r[o.stack]||{count:1,placed:0,weight:1},h=o.stackWeight/c.weight||1;if(o.horizontal){const u=e.w*h,f=c.size||l.height;$s(c.start)&&(a=c.start),l.fullSize?ys(l,n.left,a,t.outerWidth-n.right-n.left,f):ys(l,e.left+c.placed,a,u,f),c.start=a,c.placed+=u,a=l.bottom}else{const u=e.h*h,f=c.size||l.width;$s(c.start)&&(i=c.start),l.fullSize?ys(l,i,n.top,f,t.outerHeight-n.bottom-n.top):ys(l,i,e.top+c.placed,f,u),c.start=i,c.placed+=u,i=l.right}}e.x=i,e.y=a}var qe={addBox(s,e){s.boxes||(s.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},s.boxes.push(e)},removeBox(s,e){const t=s.boxes?s.boxes.indexOf(e):-1;t!==-1&&s.boxes.splice(t,1)},configure(s,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(s,e,t,r){if(!s)return;const n=je(s.options.layout.padding),i=Math.max(e-n.width,0),a=Math.max(t-n.height,0),o=Wu(s.boxes),l=o.vertical,c=o.horizontal;q(s.boxes,b=>{typeof b.beforeLayout=="function"&&b.beforeLayout()});const h=l.reduce((b,m)=>m.box.options&&m.box.options.display===!1?b:b+1,0)||1,u=Object.freeze({outerWidth:e,outerHeight:t,padding:n,availableWidth:i,availableHeight:a,vBoxMaxWidth:i/2/h,hBoxMaxHeight:a/2}),f=Object.assign({},n);io(f,je(r));const g=Object.assign({maxPadding:f,w:i,h:a,x:n.left,y:n.top},n),p=zu(l.concat(c),u);$t(o.fullSize,g,u,p),$t(l,g,u,p),$t(c,g,u,p)&&$t(l,g,u,p),qu(g),pi(o.leftAndTop,g,u,p),g.x+=g.w,g.y+=g.h,pi(o.rightAndBottom,g,u,p),s.chartArea={left:g.left,top:g.top,right:g.left+g.w,bottom:g.top+g.h,height:g.h,width:g.w},q(o.chartArea,b=>{const m=b.box;Object.assign(m,s.chartArea),m.update(g.w,g.h,{left:0,top:0,right:0,bottom:0})})}};class ao{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,r){}removeEventListener(e,t,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,r,n){return t=Math.max(0,t||e.width),r=r||e.height,{width:t,height:Math.max(0,n?Math.floor(t/n):r)}}isAttached(e){return!0}updateConfig(e){}}class Ku extends ao{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Ns="$chartjs",Gu={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},bi=s=>s===null||s==="";function Yu(s,e){const t=s.style,r=s.getAttribute("height"),n=s.getAttribute("width");if(s[Ns]={initial:{height:r,width:n,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",bi(n)){const i=ai(s,"width");i!==void 0&&(s.width=i)}if(bi(r))if(s.style.height==="")s.height=s.width/(e||2);else{const i=ai(s,"height");i!==void 0&&(s.height=i)}return s}const oo=gu?{passive:!0}:!1;function Ju(s,e,t){s&&s.addEventListener(e,t,oo)}function Xu(s,e,t){s&&s.canvas&&s.canvas.removeEventListener(e,t,oo)}function Qu(s,e){const t=Gu[s.type]||s.type,{x:r,y:n}=rt(s,e);return{type:t,chart:e,native:s,x:r!==void 0?r:null,y:n!==void 0?n:null}}function Hs(s,e){for(const t of s)if(t===e||t.contains(e))return!0}function Zu(s,e,t){const r=s.canvas,n=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||Hs(o.addedNodes,r),a=a&&!Hs(o.removedNodes,r);a&&t()});return n.observe(document,{childList:!0,subtree:!0}),n}function ef(s,e,t){const r=s.canvas,n=new MutationObserver(i=>{let a=!1;for(const o of i)a=a||Hs(o.removedNodes,r),a=a&&!Hs(o.addedNodes,r);a&&t()});return n.observe(document,{childList:!0,subtree:!0}),n}const es=new Map;let xi=0;function lo(){const s=window.devicePixelRatio;s!==xi&&(xi=s,es.forEach((e,t)=>{t.currentDevicePixelRatio!==s&&e()}))}function tf(s,e){es.size||window.addEventListener("resize",lo),es.set(s,e)}function sf(s){es.delete(s),es.size||window.removeEventListener("resize",lo)}function rf(s,e,t){const r=s.canvas,n=r&&un(r);if(!n)return;const i=Wa((o,l)=>{const c=n.clientWidth;t(o,l),c<n.clientWidth&&t()},window),a=new ResizeObserver(o=>{const l=o[0],c=l.contentRect.width,h=l.contentRect.height;c===0&&h===0||i(c,h)});return a.observe(n),tf(s,i),a}function Nr(s,e,t){t&&t.disconnect(),e==="resize"&&sf(s)}function nf(s,e,t){const r=s.canvas,n=Wa(i=>{s.ctx!==null&&t(Qu(i,s))},s);return Ju(r,e,n),n}class af extends ao{acquireContext(e,t){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(Yu(e,t),r):null}releaseContext(e){const t=e.canvas;if(!t[Ns])return!1;const r=t[Ns].initial;["height","width"].forEach(i=>{const a=r[i];oe(a)?t.removeAttribute(i):t.setAttribute(i,a)});const n=r.style||{};return Object.keys(n).forEach(i=>{t.style[i]=n[i]}),t.width=t.width,delete t[Ns],!0}addEventListener(e,t,r){this.removeEventListener(e,t);const n=e.$proxies||(e.$proxies={}),a={attach:Zu,detach:ef,resize:rf}[t]||nf;n[t]=a(e,t,r)}removeEventListener(e,t){const r=e.$proxies||(e.$proxies={}),n=r[t];if(!n)return;({attach:Nr,detach:Nr,resize:Nr}[t]||Xu)(e,t,n),r[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,r,n){return fu(e,t,r,n)}isAttached(e){const t=e&&un(e);return!!(t&&t.isConnected)}}function of(s){return!hn()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?Ku:af}class ct{constructor(){$(this,"x");$(this,"y");$(this,"active",!1);$(this,"options");$(this,"$animations")}tooltipPosition(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}hasValue(){return Bs(this.x)&&Bs(this.y)}getProps(e,t){const r=this.$animations;if(!t||!r)return this;const n={};return e.forEach(i=>{n[i]=r[i]&&r[i].active()?r[i]._to:this[i]}),n}}$(ct,"defaults",{}),$(ct,"defaultRoutes");function lf(s,e){const t=s.options.ticks,r=cf(s),n=Math.min(t.maxTicksLimit||r,r),i=t.major.enabled?hf(e):[],a=i.length,o=i[0],l=i[a-1],c=[];if(a>n)return uf(e,c,i,a/n),c;const h=df(i,e,n);if(a>0){let u,f;const g=a>1?Math.round((l-o)/(a-1)):null;for(vs(e,c,h,oe(g)?0:o-g,o),u=0,f=a-1;u<f;u++)vs(e,c,h,i[u],i[u+1]);return vs(e,c,h,l,oe(g)?e.length:l+g),c}return vs(e,c,h),c}function cf(s){const e=s.options.offset,t=s._tickSize(),r=s._length/t+(e?0:1),n=s._maxLength/t;return Math.floor(Math.min(r,n))}function df(s,e,t){const r=ff(s),n=e.length/t;if(!r)return Math.max(n,1);const i=kh(r);for(let a=0,o=i.length-1;a<o;a++){const l=i[a];if(l>n)return l}return Math.max(n,1)}function hf(s){const e=[];let t,r;for(t=0,r=s.length;t<r;t++)s[t].major&&e.push(t);return e}function uf(s,e,t,r){let n=0,i=t[0],a;for(r=Math.ceil(r),a=0;a<s.length;a++)a===i&&(e.push(s[a]),n++,i=t[n*r])}function vs(s,e,t,r,n){const i=V(r,0),a=Math.min(V(n,s.length),s.length);let o=0,l,c,h;for(t=Math.ceil(t),n&&(l=n-r,t=l/Math.floor(l/t)),h=i;h<0;)o++,h=Math.round(i+o*t);for(c=Math.max(i,0);c<a;c++)c===h&&(e.push(s[c]),o++,h=Math.round(i+o*t))}function ff(s){const e=s.length;let t,r;if(e<2)return!1;for(r=s[0],t=1;t<e;++t)if(s[t]-s[t-1]!==r)return!1;return r}const gf=s=>s==="left"?"right":s==="right"?"left":s,yi=(s,e,t)=>e==="top"||e==="left"?s[e]+t:s[e]-t,vi=(s,e)=>Math.min(e||s,s);function wi(s,e){const t=[],r=s.length/e,n=s.length;let i=0;for(;i<n;i+=r)t.push(s[Math.floor(i)]);return t}function mf(s,e,t){const r=s.ticks.length,n=Math.min(e,r-1),i=s._startPixel,a=s._endPixel,o=1e-6;let l=s.getPixelForTick(n),c;if(!(t&&(r===1?c=Math.max(l-i,a-l):e===0?c=(s.getPixelForTick(1)-l)/2:c=(l-s.getPixelForTick(n-1))/2,l+=n<e?c:-c,l<i-o||l>a+o)))return l}function pf(s,e){q(s,t=>{const r=t.gc,n=r.length/2;let i;if(n>e){for(i=0;i<n;++i)delete t.data[r[i]];r.splice(0,n)}})}function Pt(s){return s.drawTicks?s.tickLength:0}function _i(s,e){if(!s.display)return 0;const t=fe(s.font,e),r=je(s.padding);return(ne(s.text)?s.text.length:1)*t.lineHeight+r.height}function bf(s,e){return Nt(s,{scale:e,type:"scale"})}function xf(s,e,t){return Nt(s,{tick:t,index:e,type:"tick"})}function yf(s,e,t){let r=Ha(s);return(t&&e!=="right"||!t&&e==="right")&&(r=gf(r)),r}function vf(s,e,t,r){const{top:n,left:i,bottom:a,right:o,chart:l}=s,{chartArea:c,scales:h}=l;let u=0,f,g,p;const b=a-n,m=o-i;if(s.isHorizontal()){if(g=me(r,i,o),W(t)){const x=Object.keys(t)[0],w=t[x];p=h[x].getPixelForValue(w)+b-e}else t==="center"?p=(c.bottom+c.top)/2+b-e:p=yi(s,t,e);f=o-i}else{if(W(t)){const x=Object.keys(t)[0],w=t[x];g=h[x].getPixelForValue(w)-m+e}else t==="center"?g=(c.left+c.right)/2-m+e:g=yi(s,t,e);p=me(r,a,n),u=t==="left"?-se:se}return{titleX:g,titleY:p,maxWidth:f,rotation:u}}class rr extends ct{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:r,_suggestedMax:n}=this;return e=Ne(e,Number.POSITIVE_INFINITY),t=Ne(t,Number.NEGATIVE_INFINITY),r=Ne(r,Number.POSITIVE_INFINITY),n=Ne(n,Number.NEGATIVE_INFINITY),{min:Ne(e,r),max:Ne(t,n),minDefined:Le(e),maxDefined:Le(t)}}getMinMax(e){let{min:t,max:r,minDefined:n,maxDefined:i}=this.getUserBounds(),a;if(n&&i)return{min:t,max:r};const o=this.getMatchingVisibleMetas();for(let l=0,c=o.length;l<c;++l)a=o[l].controller.getMinMax(this,e),n||(t=Math.min(t,a.min)),i||(r=Math.max(r,a.max));return t=i&&t>r?r:t,r=n&&t>r?t:r,{min:Ne(t,Ne(r,t)),max:Ne(r,Ne(t,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){G(this.options.beforeUpdate,[this])}update(e,t,r){const{beginAtZero:n,grace:i,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Qh(this,i,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=o<this.ticks.length;this._convertTicksToLabels(l?wi(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=lf(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,r;this.isHorizontal()?(t=this.left,r=this.right):(t=this.top,r=this.bottom,e=!e),this._startPixel=t,this._endPixel=r,this._reversePixels=e,this._length=r-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){G(this.options.afterUpdate,[this])}beforeSetDimensions(){G(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){G(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),G(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){G(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let r,n,i;for(r=0,n=e.length;r<n;r++)i=e[r],i.label=G(t.callback,[i.value,r,e],this)}afterTickToLabelConversion(){G(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){G(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,r=vi(this.ticks.length,e.ticks.maxTicksLimit),n=t.minRotation||0,i=t.maxRotation;let a=n,o,l,c;if(!this._isVisible()||!t.display||n>=i||r<=1||!this.isHorizontal()){this.labelRotation=n;return}const h=this._getLabelSizes(),u=h.widest.width,f=h.highest.height,g=xe(this.chart.width-u,0,this.maxWidth);o=e.offset?this.maxWidth/r:g/(r-1),u+6>o&&(o=g/(r-(e.offset?.5:1)),l=this.maxHeight-Pt(e.grid)-t.padding-_i(e.title,this.chart.options.font),c=Math.sqrt(u*u+f*f),a=Sh(Math.min(Math.asin(xe((h.highest.height+6)/o,-1,1)),Math.asin(xe(l/c,-1,1))-Math.asin(xe(f/c,-1,1)))),a=Math.max(n,Math.min(i,a))),this.labelRotation=a}afterCalculateLabelRotation(){G(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){G(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:r,title:n,grid:i}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const l=_i(n,t.options.font);if(o?(e.width=this.maxWidth,e.height=Pt(i)+l):(e.height=this.maxHeight,e.width=Pt(i)+l),r.display&&this.ticks.length){const{first:c,last:h,widest:u,highest:f}=this._getLabelSizes(),g=r.padding*2,p=it(this.labelRotation),b=Math.cos(p),m=Math.sin(p);if(o){const x=r.mirror?0:m*u.width+b*f.height;e.height=Math.min(this.maxHeight,e.height+x+g)}else{const x=r.mirror?0:b*u.width+m*f.height;e.width=Math.min(this.maxWidth,e.width+x+g)}this._calculatePadding(c,h,m,b)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,r,n){const{ticks:{align:i,padding:a},position:o}=this.options,l=this.labelRotation!==0,c=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,g=0;l?c?(f=n*e.width,g=r*t.height):(f=r*e.height,g=n*t.width):i==="start"?g=t.width:i==="end"?f=e.width:i!=="inner"&&(f=e.width/2,g=t.width/2),this.paddingLeft=Math.max((f-h+a)*this.width/(this.width-h),0),this.paddingRight=Math.max((g-u+a)*this.width/(this.width-u),0)}else{let h=t.height/2,u=e.height/2;i==="start"?(h=0,u=e.height):i==="end"&&(h=t.height,u=0),this.paddingTop=h+a,this.paddingBottom=u+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){G(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,r;for(t=0,r=e.length;t<r;t++)oe(e[t].label)&&(e.splice(t,1),r--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let r=this.ticks;t<r.length&&(r=wi(r,t)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,r){const{ctx:n,_longestTextCache:i}=this,a=[],o=[],l=Math.floor(t/vi(t,r));let c=0,h=0,u,f,g,p,b,m,x,w,y,v,k;for(u=0;u<t;u+=l){if(p=e[u].label,b=this._resolveTickFontOptions(u),n.font=m=b.string,x=i[m]=i[m]||{data:{},gc:[]},w=b.lineHeight,y=v=0,!oe(p)&&!ne(p))y=ei(n,x.data,x.gc,y,p),v=w;else if(ne(p))for(f=0,g=p.length;f<g;++f)k=p[f],!oe(k)&&!ne(k)&&(y=ei(n,x.data,x.gc,y,k),v+=w);a.push(y),o.push(v),c=Math.max(y,c),h=Math.max(v,h)}pf(i,t);const N=a.indexOf(c),A=o.indexOf(h),P=F=>({width:a[F]||0,height:o[F]||0});return{first:P(0),last:P(t-1),widest:P(N),highest:P(A),widths:a,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return Ch(this._alignToPixels?et(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const r=t[e];return r.$context||(r.$context=xf(this.getContext(),e,r))}return this.$context||(this.$context=bf(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=it(this.labelRotation),r=Math.abs(Math.cos(t)),n=Math.abs(Math.sin(t)),i=this._getLabelSizes(),a=e.autoSkipPadding||0,o=i?i.widest.width+a:0,l=i?i.highest.height+a:0;return this.isHorizontal()?l*r>o*n?o/r:l/n:l*n<o*r?l/r:o/n}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,r=this.chart,n=this.options,{grid:i,position:a,border:o}=n,l=i.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),f=Pt(i),g=[],p=o.setContext(this.getContext()),b=p.display?p.width:0,m=b/2,x=function(D){return et(r,D,b)};let w,y,v,k,N,A,P,F,E,I,L,z;if(a==="top")w=x(this.bottom),A=this.bottom-f,F=w-m,I=x(e.top)+m,z=e.bottom;else if(a==="bottom")w=x(this.top),I=e.top,z=x(e.bottom)-m,A=w+m,F=this.top+f;else if(a==="left")w=x(this.right),N=this.right-f,P=w-m,E=x(e.left)+m,L=e.right;else if(a==="right")w=x(this.left),E=e.left,L=x(e.right)-m,N=w+m,P=this.left+f;else if(t==="x"){if(a==="center")w=x((e.top+e.bottom)/2+.5);else if(W(a)){const D=Object.keys(a)[0],U=a[D];w=x(this.chart.scales[D].getPixelForValue(U))}I=e.top,z=e.bottom,A=w+m,F=A+f}else if(t==="y"){if(a==="center")w=x((e.left+e.right)/2);else if(W(a)){const D=Object.keys(a)[0],U=a[D];w=x(this.chart.scales[D].getPixelForValue(U))}N=w-m,P=N-f,E=e.left,L=e.right}const T=V(n.ticks.maxTicksLimit,u),S=Math.max(1,Math.ceil(u/T));for(y=0;y<u;y+=S){const D=this.getContext(y),U=i.setContext(D),X=o.setContext(D),_=U.lineWidth,M=U.color,C=X.dash||[],H=X.dashOffset,le=U.tickWidth,ie=U.tickColor,Se=U.tickBorderDash||[],pe=U.tickBorderDashOffset;v=mf(this,y,l),v!==void 0&&(k=et(r,v,_),c?N=P=E=L=k:A=F=I=z=k,g.push({tx1:N,ty1:A,tx2:P,ty2:F,x1:E,y1:I,x2:L,y2:z,width:_,color:M,borderDash:C,borderDashOffset:H,tickWidth:le,tickColor:ie,tickBorderDash:Se,tickBorderDashOffset:pe}))}return this._ticksLength=u,this._borderValue=w,g}_computeLabelItems(e){const t=this.axis,r=this.options,{position:n,ticks:i}=r,a=this.isHorizontal(),o=this.ticks,{align:l,crossAlign:c,padding:h,mirror:u}=i,f=Pt(r.grid),g=f+h,p=u?-h:g,b=-it(this.labelRotation),m=[];let x,w,y,v,k,N,A,P,F,E,I,L,z="middle";if(n==="top")N=this.bottom-p,A=this._getXAxisLabelAlignment();else if(n==="bottom")N=this.top+p,A=this._getXAxisLabelAlignment();else if(n==="left"){const S=this._getYAxisLabelAlignment(f);A=S.textAlign,k=S.x}else if(n==="right"){const S=this._getYAxisLabelAlignment(f);A=S.textAlign,k=S.x}else if(t==="x"){if(n==="center")N=(e.top+e.bottom)/2+g;else if(W(n)){const S=Object.keys(n)[0],D=n[S];N=this.chart.scales[S].getPixelForValue(D)+g}A=this._getXAxisLabelAlignment()}else if(t==="y"){if(n==="center")k=(e.left+e.right)/2-g;else if(W(n)){const S=Object.keys(n)[0],D=n[S];k=this.chart.scales[S].getPixelForValue(D)}A=this._getYAxisLabelAlignment(f).textAlign}t==="y"&&(l==="start"?z="top":l==="end"&&(z="bottom"));const T=this._getLabelSizes();for(x=0,w=o.length;x<w;++x){y=o[x],v=y.label;const S=i.setContext(this.getContext(x));P=this.getPixelForTick(x)+i.labelOffset,F=this._resolveTickFontOptions(x),E=F.lineHeight,I=ne(v)?v.length:1;const D=I/2,U=S.color,X=S.textStrokeColor,_=S.textStrokeWidth;let M=A;a?(k=P,A==="inner"&&(x===w-1?M=this.options.reverse?"left":"right":x===0?M=this.options.reverse?"right":"left":M="center"),n==="top"?c==="near"||b!==0?L=-I*E+E/2:c==="center"?L=-T.highest.height/2-D*E+E:L=-T.highest.height+E/2:c==="near"||b!==0?L=E/2:c==="center"?L=T.highest.height/2-D*E:L=T.highest.height-I*E,u&&(L*=-1),b!==0&&!S.showLabelBackdrop&&(k+=E/2*Math.sin(b))):(N=P,L=(1-I)*E/2);let C;if(S.showLabelBackdrop){const H=je(S.backdropPadding),le=T.heights[x],ie=T.widths[x];let Se=L-H.top,pe=0-H.left;switch(z){case"middle":Se-=le/2;break;case"bottom":Se-=le;break}switch(A){case"center":pe-=ie/2;break;case"right":pe-=ie;break;case"inner":x===w-1?pe-=ie:x>0&&(pe-=ie/2);break}C={left:pe,top:Se,width:ie+H.width,height:le+H.height,color:S.backdropColor}}m.push({label:v,font:F,textOffset:L,options:{rotation:b,color:U,strokeColor:X,strokeWidth:_,textAlign:M,textBaseline:z,translation:[k,N],backdrop:C}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-it(this.labelRotation))return e==="top"?"left":"right";let n="center";return t.align==="start"?n="left":t.align==="end"?n="right":t.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:r,mirror:n,padding:i}}=this.options,a=this._getLabelSizes(),o=e+i,l=a.widest.width;let c,h;return t==="left"?n?(h=this.right+i,r==="near"?c="left":r==="center"?(c="center",h+=l/2):(c="right",h+=l)):(h=this.right-o,r==="near"?c="right":r==="center"?(c="center",h-=l/2):(c="left",h=this.left)):t==="right"?n?(h=this.left+i,r==="near"?c="right":r==="center"?(c="center",h-=l/2):(c="left",h-=l)):(h=this.left+o,r==="near"?c="left":r==="center"?(c="center",h+=l/2):(c="right",h=this.right)):c="right",{textAlign:c,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:r,top:n,width:i,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(r,n,i,a),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const n=this.ticks.findIndex(i=>i.value===e);return n>=0?t.setContext(this.getContext(n)).lineWidth:0}drawGrid(e){const t=this.options.grid,r=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,a;const o=(l,c,h)=>{!h.width||!h.color||(r.save(),r.lineWidth=h.width,r.strokeStyle=h.color,r.setLineDash(h.borderDash||[]),r.lineDashOffset=h.borderDashOffset,r.beginPath(),r.moveTo(l.x,l.y),r.lineTo(c.x,c.y),r.stroke(),r.restore())};if(t.display)for(i=0,a=n.length;i<a;++i){const l=n[i];t.drawOnChartArea&&o({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),t.drawTicks&&o({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:r,grid:n}}=this,i=r.setContext(this.getContext()),a=r.display?i.width:0;if(!a)return;const o=n.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,h,u,f;this.isHorizontal()?(c=et(e,this.left,a)-a/2,h=et(e,this.right,o)+o/2,u=f=l):(u=et(e,this.top,a)-a/2,f=et(e,this.bottom,o)+o/2,c=h=l),t.save(),t.lineWidth=i.width,t.strokeStyle=i.color,t.beginPath(),t.moveTo(c,u),t.lineTo(h,f),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,n=this._computeLabelArea();n&&nn(r,n);const i=this.getLabelItems(e);for(const a of i){const o=a.options,l=a.font,c=a.label,h=a.textOffset;zs(r,c,0,h,l,o)}n&&an(r)}drawTitle(){const{ctx:e,options:{position:t,title:r,reverse:n}}=this;if(!r.display)return;const i=fe(r.font),a=je(r.padding),o=r.align;let l=i.lineHeight/2;t==="bottom"||t==="center"||W(t)?(l+=a.bottom,ne(r.text)&&(l+=i.lineHeight*(r.text.length-1))):l+=a.top;const{titleX:c,titleY:h,maxWidth:u,rotation:f}=vf(this,l,t,o);zs(e,r.text,0,0,i,{color:r.color,maxWidth:u,rotation:f,textAlign:yf(o,t,n),textBaseline:"middle",translation:[c,h]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,r=V(e.grid&&e.grid.z,-1),n=V(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==rr.prototype.draw?[{z:t,draw:i=>{this.draw(i)}}]:[{z:r,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",n=[];let i,a;for(i=0,a=t.length;i<a;++i){const o=t[i];o[r]===this.id&&(!e||o.type===e)&&n.push(o)}return n}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return fe(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class ws{constructor(e,t,r){this.type=e,this.scope=t,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let r;kf(t)&&(r=this.register(t));const n=this.items,i=e.id,a=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in n||(n[i]=e,wf(e,a,r),this.override&&Q.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const t=this.items,r=e.id,n=this.scope;r in t&&delete t[r],n&&r in Q[n]&&(delete Q[n][r],this.override&&delete lt[r])}}function wf(s,e,t){const r=Qt(Object.create(null),[t?Q.get(t):{},Q.get(e),s.defaults]);Q.set(e,r),s.defaultRoutes&&_f(e,s.defaultRoutes),s.descriptors&&Q.describe(e,s.descriptors)}function _f(s,e){Object.keys(e).forEach(t=>{const r=t.split("."),n=r.pop(),i=[s].concat(r).join("."),a=e[t].split("."),o=a.pop(),l=a.join(".");Q.route(i,n,l,o)})}function kf(s){return"id"in s&&"defaults"in s}class jf{constructor(){this.controllers=new ws(Yt,"datasets",!0),this.elements=new ws(ct,"elements"),this.plugins=new ws(Object,"plugins"),this.scales=new ws(rr,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,r){[...t].forEach(n=>{const i=r||this._getRegistryForType(n);r||i.isForType(n)||i===this.plugins&&n.id?this._exec(e,i,n):q(n,a=>{const o=r||this._getRegistryForType(a);this._exec(e,o,a)})})}_exec(e,t,r){const n=sn(e);G(r["before"+n],[],r),t[e](r),G(r["after"+n],[],r)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const r=this._typedRegistries[t];if(r.isForType(e))return r}return this.plugins}_get(e,t,r){const n=t.get(e);if(n===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return n}}var Ae=new jf;class Sf{constructor(){this._init=[]}notify(e,t,r,n){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const i=n?this._descriptors(e).filter(n):this._descriptors(e),a=this._notify(i,e,t,r);return t==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall")),a}_notify(e,t,r,n){n=n||{};for(const i of e){const a=i.plugin,o=a[r],l=[t,n,i.options];if(G(o,l,a)===!1&&n.cancelable)return!1}return!0}invalidate(){oe(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const r=e&&e.config,n=V(r.options&&r.options.plugins,{}),i=Nf(r);return n===!1&&!t?[]:Tf(e,i,n,t)}_notifyStateChanges(e){const t=this._oldCache||[],r=this._cache,n=(i,a)=>i.filter(o=>!a.some(l=>o.plugin.id===l.plugin.id));this._notify(n(t,r),e,"stop"),this._notify(n(r,t),e,"start")}}function Nf(s){const e={},t=[],r=Object.keys(Ae.plugins.items);for(let i=0;i<r.length;i++)t.push(Ae.getPlugin(r[i]));const n=s.plugins||[];for(let i=0;i<n.length;i++){const a=n[i];t.indexOf(a)===-1&&(t.push(a),e[a.id]=!0)}return{plugins:t,localIds:e}}function Cf(s,e){return!e&&s===!1?null:s===!0?{}:s}function Tf(s,{plugins:e,localIds:t},r,n){const i=[],a=s.getContext();for(const o of e){const l=o.id,c=Cf(r[l],n);c!==null&&i.push({plugin:o,options:Af(s.config,{plugin:o,local:t[l]},c,a)})}return i}function Af(s,{plugin:e,local:t},r,n){const i=s.pluginScopeKeys(e),a=s.getOptionScopes(r,i);return t&&e.defaults&&a.push(e.defaults),s.createResolver(a,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function zr(s,e){const t=Q.datasets[s]||{};return((e.datasets||{})[s]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function Of(s,e){let t=s;return s==="_index_"?t=e:s==="_value_"&&(t=e==="x"?"y":"x"),t}function Ef(s,e){return s===e?"_index_":"_value_"}function ki(s){if(s==="x"||s==="y"||s==="r")return s}function Pf(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function Wr(s,...e){if(ki(s))return s;for(const t of e){const r=t.axis||Pf(t.position)||s.length>1&&ki(s[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function ji(s,e,t){if(t[e+"AxisID"]===s)return{axis:e}}function If(s,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(r=>r.xAxisID===s||r.yAxisID===s);if(t.length)return ji(s,"x",t[0])||ji(s,"y",t[0])}return{}}function Df(s,e){const t=lt[s.type]||{scales:{}},r=e.scales||{},n=zr(s.type,e),i=Object.create(null);return Object.keys(r).forEach(a=>{const o=r[a];if(!W(o))return console.error(`Invalid scale configuration for scale: ${a}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const l=Wr(a,o,If(a,s),Q.scales[o.type]),c=Ef(l,n),h=t.scales||{};i[a]=qt(Object.create(null),[{axis:l},o,h[l],h[c]])}),s.data.datasets.forEach(a=>{const o=a.type||s.type,l=a.indexAxis||zr(o,e),h=(lt[o]||{}).scales||{};Object.keys(h).forEach(u=>{const f=Of(u,l),g=a[f+"AxisID"]||f;i[g]=i[g]||Object.create(null),qt(i[g],[{axis:f},r[g],h[u]])})}),Object.keys(i).forEach(a=>{const o=i[a];qt(o,[Q.scales[o.type],Q.scale])}),i}function co(s){const e=s.options||(s.options={});e.plugins=V(e.plugins,{}),e.scales=Df(s,e)}function ho(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function Mf(s){return s=s||{},s.data=ho(s.data),co(s),s}const Si=new Map,uo=new Set;function _s(s,e){let t=Si.get(s);return t||(t=e(),Si.set(s,t),uo.add(t)),t}const It=(s,e,t)=>{const r=Zt(e,t);r!==void 0&&s.add(r)};class Rf{constructor(e){this._config=Mf(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=ho(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),co(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return _s(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return _s(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return _s(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,r=this.type;return _s(`${r}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const r=this._scopeCache;let n=r.get(e);return(!n||t)&&(n=new Map,r.set(e,n)),n}getOptionScopes(e,t,r){const{options:n,type:i}=this,a=this._cachedScopes(e,r),o=a.get(t);if(o)return o;const l=new Set;t.forEach(h=>{e&&(l.add(e),h.forEach(u=>It(l,e,u))),h.forEach(u=>It(l,n,u)),h.forEach(u=>It(l,lt[i]||{},u)),h.forEach(u=>It(l,Q,u)),h.forEach(u=>It(l,Fr,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),uo.has(t)&&a.set(t,c),c}chartOptionScopes(){const{options:e,type:t}=this;return[e,lt[t]||{},Q.datasets[t]||{},{type:t},Q,Fr]}resolveNamedOptions(e,t,r,n=[""]){const i={$shared:!0},{resolver:a,subPrefixes:o}=Ni(this._resolverCache,e,n);let l=a;if($f(a,t)){i.$shared=!1,r=Ge(r)?r():r;const c=this.createResolver(e,r,o);l=kt(a,r,c)}for(const c of t)i[c]=l[c];return i}createResolver(e,t,r=[""],n){const{resolver:i}=Ni(this._resolverCache,e,r);return W(t)?kt(i,t,void 0,n):i}}function Ni(s,e,t){let r=s.get(e);r||(r=new Map,s.set(e,r));const n=t.join();let i=r.get(n);return i||(i={resolver:ln(e,t),subPrefixes:t.filter(o=>!o.toLowerCase().includes("hover"))},r.set(n,i)),i}const Lf=s=>W(s)&&Object.getOwnPropertyNames(s).some(e=>Ge(s[e]));function $f(s,e){const{isScriptable:t,isIndexable:r}=Ja(s);for(const n of e){const i=t(n),a=r(n),o=(a||i)&&s[n];if(i&&(Ge(o)||Lf(o))||a&&ne(o))return!0}return!1}var Ff="4.5.0";const Bf=["top","bottom","left","right","chartArea"];function Ci(s,e){return s==="top"||s==="bottom"||Bf.indexOf(s)===-1&&e==="x"}function Ti(s,e){return function(t,r){return t[s]===r[s]?t[e]-r[e]:t[s]-r[s]}}function Ai(s){const e=s.chart,t=e.options.animation;e.notifyPlugins("afterRender"),G(t&&t.onComplete,[s],e)}function Uf(s){const e=s.chart,t=e.options.animation;G(t&&t.onProgress,[s],e)}function fo(s){return hn()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const Cs={},Oi=s=>{const e=fo(s);return Object.values(Cs).filter(t=>t.canvas===e).pop()};function zf(s,e,t){const r=Object.keys(s);for(const n of r){const i=+n;if(i>=e){const a=s[n];delete s[n],(t>0||i>e)&&(s[i+t]=a)}}}function Wf(s,e,t,r){return!t||s.type==="mouseout"?null:r?e:s}var Fe;let nr=(Fe=class{static register(...e){Ae.add(...e),Ei()}static unregister(...e){Ae.remove(...e),Ei()}constructor(e,t){const r=this.config=new Rf(t),n=fo(e),i=Oi(n);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const a=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||of(n)),this.platform.updateConfig(r);const o=this.platform.acquireContext(n,a.aspectRatio),l=o&&o.canvas,c=l&&l.height,h=l&&l.width;if(this.id=mh(),this.ctx=o,this.canvas=l,this.width=h,this.height=c,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Sf,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Ph(u=>this.update(u),a.resizeDelay||0),this._dataChanges=[],Cs[this.id]=this,!o||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Ie.listen(this,"complete",Ai),Ie.listen(this,"progress",Uf),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:r,height:n,_aspectRatio:i}=this;return oe(e)?t&&i?i:n?r/n:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Ae}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ii(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return ti(this.canvas,this.ctx),this}stop(){return Ie.stop(this),this}resize(e,t){Ie.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const r=this.options,n=this.canvas,i=r.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(n,e,t,i),o=r.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,ii(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),G(r.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};q(t,(r,n)=>{r.id=n})}buildOrUpdateScales(){const e=this.options,t=e.scales,r=this.scales,n=Object.keys(r).reduce((a,o)=>(a[o]=!1,a),{});let i=[];t&&(i=i.concat(Object.keys(t).map(a=>{const o=t[a],l=Wr(a,o),c=l==="r",h=l==="x";return{options:o,dposition:c?"chartArea":h?"bottom":"left",dtype:c?"radialLinear":h?"category":"linear"}}))),q(i,a=>{const o=a.options,l=o.id,c=Wr(l,o),h=V(o.type,a.dtype);(o.position===void 0||Ci(o.position,c)!==Ci(a.dposition))&&(o.position=a.dposition),n[l]=!0;let u=null;if(l in r&&r[l].type===h)u=r[l];else{const f=Ae.getScale(h);u=new f({id:l,type:h,ctx:this.ctx,chart:this}),r[u.id]=u}u.init(o,e)}),q(n,(a,o)=>{a||delete r[o]}),q(r,a=>{qe.configure(this,a,a.options),qe.addBox(this,a)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,r=e.length;if(e.sort((n,i)=>n.index-i.index),r>t){for(let n=t;n<r;++n)this._destroyDatasetMeta(n);e.splice(t,r-t)}this._sortedMetasets=e.slice(0).sort(Ti("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((r,n)=>{t.filter(i=>i===r._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let r,n;for(this._removeUnreferencedMetasets(),r=0,n=t.length;r<n;r++){const i=t[r];let a=this.getDatasetMeta(r);const o=i.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(r),a=this.getDatasetMeta(r)),a.type=o,a.indexAxis=i.indexAxis||zr(o,this.options),a.order=i.order||0,a.index=r,a.label=""+i.label,a.visible=this.isDatasetVisible(r),a.controller)a.controller.updateIndex(r),a.controller.linkScales();else{const l=Ae.getController(o),{datasetElementType:c,dataElementType:h}=Q.datasets[o];Object.assign(l,{dataElementType:Ae.getElement(h),datasetElementType:c&&Ae.getElement(c)}),a.controller=new l(this,r),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){q(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const r=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let c=0,h=this.data.datasets.length;c<h;c++){const{controller:u}=this.getDatasetMeta(c),f=!n&&i.indexOf(u)===-1;u.buildOrUpdateElements(f),a=Math.max(+u.getMaxOverflow(),a)}a=this._minPadding=r.layout.autoPadding?a:0,this._updateLayout(a),n||q(i,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Ti("z","_idx"));const{_active:o,_lastEvent:l}=this;l?this._eventHandler(l,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){q(this.scales,e=>{qe.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!qn(t,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:r,start:n,count:i}of t){const a=r==="_removeElements"?-i:i;zf(e,n,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,r=i=>new Set(e.filter(a=>a[0]===i).map((a,o)=>o+","+a.splice(1).join(","))),n=r(0);for(let i=1;i<t;i++)if(!qn(n,r(i)))return;return Array.from(n).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;qe.update(this,this.width,this.height,e);const t=this.chartArea,r=t.width<=0||t.height<=0;this._layers=[],q(this.boxes,n=>{r&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,i)=>{n._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,r=this.data.datasets.length;t<r;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,r=this.data.datasets.length;t<r;++t)this._updateDataset(t,Ge(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const r=this.getDatasetMeta(e),n={meta:r,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(r.controller._update(t),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ie.has(this)?this.attached&&!Ie.running(this)&&Ie.start(this):(this.draw(),Ai({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,r=[];let n,i;for(n=0,i=t.length;n<i;++n){const a=t[n];(!e||a.visible)&&r.push(a)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,r={meta:e,index:e.index,cancelable:!0},n=xu(this,e);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(n&&nn(t,n),e.controller.draw(),n&&an(t),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return Ya(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,r,n){const i=Fu.modes[t];return typeof i=="function"?i(this,e,r,n):[]}getDatasetMeta(e){const t=this.data.datasets[e],r=this._metasets;let n=r.filter(i=>i&&i._dataset===t).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},r.push(n)),n}getContext(){return this.$context||(this.$context=Nt(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!t.hidden}setDatasetVisibility(e,t){const r=this.getDatasetMeta(e);r.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,r){const n=r?"show":"hide",i=this.getDatasetMeta(e),a=i.controller._resolveAnimations(void 0,n);$s(t)?(i.data[t].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),a.update(i,{visible:r}),this.update(o=>o.datasetIndex===e?n:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Ie.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),ti(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete Cs[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,r=(i,a)=>{t.addEventListener(this,i,a),e[i]=a},n=(i,a,o)=>{i.offsetX=a,i.offsetY=o,this._eventHandler(i)};q(this.options.events,i=>r(i,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,r=(l,c)=>{t.addEventListener(this,l,c),e[l]=c},n=(l,c)=>{e[l]&&(t.removeEventListener(this,l,c),delete e[l])},i=(l,c)=>{this.canvas&&this.resize(l,c)};let a;const o=()=>{n("attach",o),this.attached=!0,this.resize(),r("resize",i),r("detach",a)};a=()=>{this.attached=!1,n("resize",i),this._stop(),this._resize(0,0),r("attach",o)},t.isAttached(this.canvas)?o():a()}unbindEvents(){q(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},q(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,r){const n=r?"set":"remove";let i,a,o,l;for(t==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+n+"DatasetHoverStyle"]()),o=0,l=e.length;o<l;++o){a=e[o];const c=a&&this.getDatasetMeta(a.datasetIndex).controller;c&&c[n+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],r=e.map(({datasetIndex:i,index:a})=>{const o=this.getDatasetMeta(i);if(!o)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:o.data[a],index:a}});!Rs(r,t)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,t))}notifyPlugins(e,t,r){return this._plugins.notify(this,e,t,r)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,r){const n=this.options.hover,i=(l,c)=>l.filter(h=>!c.some(u=>h.datasetIndex===u.datasetIndex&&h.index===u.index)),a=i(t,e),o=r?e:i(e,t);a.length&&this.updateHoverStyle(a,n.mode,!1),o.length&&n.mode&&this.updateHoverStyle(o,n.mode,!0)}_eventHandler(e,t){const r={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},n=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,n)===!1)return;const i=this._handleEvent(e,t,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,n),(i||r.changed)&&this.render(),this}_handleEvent(e,t,r){const{_active:n=[],options:i}=this,a=t,o=this._getActiveElements(e,n,r,a),l=wh(e),c=Wf(e,this._lastEvent,r,l);r&&(this._lastEvent=null,G(i.onHover,[e,o,this],this),l&&G(i.onClick,[e,o,this],this));const h=!Rs(o,n);return(h||t)&&(this._active=o,this._updateHoverStyles(o,n,t)),this._lastEvent=c,h}_getActiveElements(e,t,r,n){if(e.type==="mouseout")return[];if(!r)return t;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,n)}},$(Fe,"defaults",Q),$(Fe,"instances",Cs),$(Fe,"overrides",lt),$(Fe,"registry",Ae),$(Fe,"version",Ff),$(Fe,"getChart",Oi),Fe);function Ei(){return q(nr.instances,s=>s._plugins.invalidate())}function Hf(s,e,t){const{startAngle:r,x:n,y:i,outerRadius:a,innerRadius:o,options:l}=e,{borderWidth:c,borderJoinStyle:h}=l,u=Math.min(c/a,Oe(r-t));if(s.beginPath(),s.arc(n,i,a-c/2,r+u/2,t-u/2),o>0){const f=Math.min(c/o,Oe(r-t));s.arc(n,i,o+c/2,t-f/2,r+f/2,!0)}else{const f=Math.min(c/2,a*Oe(r-t));if(h==="round")s.arc(n,i,f,t-Y/2,r+Y/2,!0);else if(h==="bevel"){const g=2*f*f,p=-g*Math.cos(t+Y/2)+n,b=-g*Math.sin(t+Y/2)+i,m=g*Math.cos(r+Y/2)+n,x=g*Math.sin(r+Y/2)+i;s.lineTo(p,b),s.lineTo(m,x)}}s.closePath(),s.moveTo(0,0),s.rect(0,0,s.canvas.width,s.canvas.height),s.clip("evenodd")}function qf(s,e,t){const{startAngle:r,pixelMargin:n,x:i,y:a,outerRadius:o,innerRadius:l}=e;let c=n/o;s.beginPath(),s.arc(i,a,o,r-c,t+c),l>n?(c=n/l,s.arc(i,a,l,t+c,r-c,!0)):s.arc(i,a,n,t+se,r-se),s.closePath(),s.clip()}function Vf(s){return on(s,["outerStart","outerEnd","innerStart","innerEnd"])}function Kf(s,e,t,r){const n=Vf(s.options.borderRadius),i=(t-e)/2,a=Math.min(i,r*e/2),o=l=>{const c=(t-Math.min(i,l))*r/2;return xe(l,0,Math.min(i,c))};return{outerStart:o(n.outerStart),outerEnd:o(n.outerEnd),innerStart:xe(n.innerStart,0,a),innerEnd:xe(n.innerEnd,0,a)}}function bt(s,e,t,r){return{x:t+s*Math.cos(e),y:r+s*Math.sin(e)}}function qs(s,e,t,r,n,i){const{x:a,y:o,startAngle:l,pixelMargin:c,innerRadius:h}=e,u=Math.max(e.outerRadius+r+t-c,0),f=h>0?h+r+t+c:0;let g=0;const p=n-l;if(r){const S=h>0?h-r:0,D=u>0?u-r:0,U=(S+D)/2,X=U!==0?p*U/(U+r):p;g=(p-X)/2}const b=Math.max(.001,p*u-t/Y)/u,m=(p-b)/2,x=l+m+g,w=n-m-g,{outerStart:y,outerEnd:v,innerStart:k,innerEnd:N}=Kf(e,f,u,w-x),A=u-y,P=u-v,F=x+y/A,E=w-v/P,I=f+k,L=f+N,z=x+k/I,T=w-N/L;if(s.beginPath(),i){const S=(F+E)/2;if(s.arc(a,o,u,F,S),s.arc(a,o,u,S,E),v>0){const _=bt(P,E,a,o);s.arc(_.x,_.y,v,E,w+se)}const D=bt(L,w,a,o);if(s.lineTo(D.x,D.y),N>0){const _=bt(L,T,a,o);s.arc(_.x,_.y,N,w+se,T+Math.PI)}const U=(w-N/f+(x+k/f))/2;if(s.arc(a,o,f,w-N/f,U,!0),s.arc(a,o,f,U,x+k/f,!0),k>0){const _=bt(I,z,a,o);s.arc(_.x,_.y,k,z+Math.PI,x-se)}const X=bt(A,x,a,o);if(s.lineTo(X.x,X.y),y>0){const _=bt(A,F,a,o);s.arc(_.x,_.y,y,x-se,F)}}else{s.moveTo(a,o);const S=Math.cos(F)*u+a,D=Math.sin(F)*u+o;s.lineTo(S,D);const U=Math.cos(E)*u+a,X=Math.sin(E)*u+o;s.lineTo(U,X)}s.closePath()}function Gf(s,e,t,r,n){const{fullCircles:i,startAngle:a,circumference:o}=e;let l=e.endAngle;if(i){qs(s,e,t,r,l,n);for(let c=0;c<i;++c)s.fill();isNaN(o)||(l=a+(o%te||te))}return qs(s,e,t,r,l,n),s.fill(),l}function Yf(s,e,t,r,n){const{fullCircles:i,startAngle:a,circumference:o,options:l}=e,{borderWidth:c,borderJoinStyle:h,borderDash:u,borderDashOffset:f,borderRadius:g}=l,p=l.borderAlign==="inner";if(!c)return;s.setLineDash(u||[]),s.lineDashOffset=f,p?(s.lineWidth=c*2,s.lineJoin=h||"round"):(s.lineWidth=c,s.lineJoin=h||"bevel");let b=e.endAngle;if(i){qs(s,e,t,r,b,n);for(let m=0;m<i;++m)s.stroke();isNaN(o)||(b=a+(o%te||te))}p&&qf(s,e,b),l.selfJoin&&b-a>=Y&&g===0&&h!=="miter"&&Hf(s,e,b),i||(qs(s,e,t,r,b,n),s.stroke())}class Ft extends ct{constructor(t){super();$(this,"circumference");$(this,"endAngle");$(this,"fullCircles");$(this,"innerRadius");$(this,"outerRadius");$(this,"pixelMargin");$(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,r,n){const i=this.getProps(["x","y"],n),{angle:a,distance:o}=Ba(i,{x:t,y:r}),{startAngle:l,endAngle:c,innerRadius:h,outerRadius:u,circumference:f}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),g=(this.options.spacing+this.options.borderWidth)/2,p=V(f,c-l),b=Us(a,l,c)&&l!==c,m=p>=te||b,x=Rt(o,h+g,u+g);return m&&x}getCenterPoint(t){const{x:r,y:n,startAngle:i,endAngle:a,innerRadius:o,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:c,spacing:h}=this.options,u=(i+a)/2,f=(o+l+h+c)/2;return{x:r+Math.cos(u)*f,y:n+Math.sin(u)*f}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:r,circumference:n}=this,i=(r.offset||0)/4,a=(r.spacing||0)/2,o=r.circular;if(this.pixelMargin=r.borderAlign==="inner"?.33:0,this.fullCircles=n>te?Math.floor(n/te):0,n===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const l=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(l)*i,Math.sin(l)*i);const c=1-Math.sin(Math.min(Y,n||0)),h=i*c;t.fillStyle=r.backgroundColor,t.strokeStyle=r.borderColor,Gf(t,this,h,a,o),Yf(t,this,h,a,o),t.restore()}}$(Ft,"id","arc"),$(Ft,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),$(Ft,"defaultRoutes",{backgroundColor:"backgroundColor"}),$(Ft,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"});const Pi=(s,e)=>{let{boxHeight:t=e,boxWidth:r=e}=s;return s.usePointStyle&&(t=Math.min(t,e),r=s.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:t,itemHeight:Math.max(e,t)}},Jf=(s,e)=>s!==null&&e!==null&&s.datasetIndex===e.datasetIndex&&s.index===e.index;class Ii extends ct{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,r){this.maxWidth=e,this.maxHeight=t,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=G(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(r=>e.filter(r,this.chart.data))),e.sort&&(t=t.sort((r,n)=>e.sort(r,n,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,n=fe(r.font),i=n.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:l}=Pi(r,i);let c,h;t.font=n.string,this.isHorizontal()?(c=this.maxWidth,h=this._fitRows(a,i,o,l)+10):(h=this.maxHeight,c=this._fitCols(a,n,o,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(h,e.maxHeight||this.maxHeight)}_fitRows(e,t,r,n){const{ctx:i,maxWidth:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],h=n+o;let u=e;i.textAlign="left",i.textBaseline="middle";let f=-1,g=-h;return this.legendItems.forEach((p,b)=>{const m=r+t/2+i.measureText(p.text).width;(b===0||c[c.length-1]+m+2*o>a)&&(u+=h,c[c.length-(b>0?0:1)]=0,g+=h,f++),l[b]={left:0,top:g,row:f,width:m,height:n},c[c.length-1]+=m+o}),u}_fitCols(e,t,r,n){const{ctx:i,maxHeight:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],h=a-e;let u=o,f=0,g=0,p=0,b=0;return this.legendItems.forEach((m,x)=>{const{itemWidth:w,itemHeight:y}=Xf(r,t,i,m,n);x>0&&g+y+2*o>h&&(u+=f+o,c.push({width:f,height:g}),p+=f+o,b++,f=g=0),l[x]={left:p,top:g,col:b,width:w,height:y},f=Math.max(f,w),g+=y+o}),u+=f,c.push({width:f,height:g}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:r,labels:{padding:n},rtl:i}}=this,a=vt(i,this.left,this.width);if(this.isHorizontal()){let o=0,l=me(r,this.left+n,this.right-this.lineWidths[o]);for(const c of t)o!==c.row&&(o=c.row,l=me(r,this.left+n,this.right-this.lineWidths[o])),c.top+=this.top+e+n,c.left=a.leftForLtr(a.x(l),c.width),l+=c.width+n}else{let o=0,l=me(r,this.top+e+n,this.bottom-this.columnSizes[o].height);for(const c of t)c.col!==o&&(o=c.col,l=me(r,this.top+e+n,this.bottom-this.columnSizes[o].height)),c.top=l,c.left+=this.left+n,c.left=a.leftForLtr(a.x(c.left),c.width),l+=c.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;nn(e,this),this._draw(),an(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:r,ctx:n}=this,{align:i,labels:a}=e,o=Q.color,l=vt(e.rtl,this.left,this.width),c=fe(a.font),{padding:h}=a,u=c.size,f=u/2;let g;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;const{boxWidth:p,boxHeight:b,itemHeight:m}=Pi(a,u),x=function(N,A,P){if(isNaN(p)||p<=0||isNaN(b)||b<0)return;n.save();const F=V(P.lineWidth,1);if(n.fillStyle=V(P.fillStyle,o),n.lineCap=V(P.lineCap,"butt"),n.lineDashOffset=V(P.lineDashOffset,0),n.lineJoin=V(P.lineJoin,"miter"),n.lineWidth=F,n.strokeStyle=V(P.strokeStyle,o),n.setLineDash(V(P.lineDash,[])),a.usePointStyle){const E={radius:b*Math.SQRT2/2,pointStyle:P.pointStyle,rotation:P.rotation,borderWidth:F},I=l.xPlus(N,p/2),L=A+f;Ga(n,E,I,L,a.pointStyleWidth&&p)}else{const E=A+Math.max((u-b)/2,0),I=l.leftForLtr(N,p),L=Gt(P.borderRadius);n.beginPath(),Object.values(L).some(z=>z!==0)?Br(n,{x:I,y:E,w:p,h:b,radius:L}):n.rect(I,E,p,b),n.fill(),F!==0&&n.stroke()}n.restore()},w=function(N,A,P){zs(n,P.text,N,A+m/2,c,{strikethrough:P.hidden,textAlign:l.textAlign(P.textAlign)})},y=this.isHorizontal(),v=this._computeTitleHeight();y?g={x:me(i,this.left+h,this.right-r[0]),y:this.top+h+v,line:0}:g={x:this.left+h,y:me(i,this.top+v+h,this.bottom-t[0].height),line:0},eo(this.ctx,e.textDirection);const k=m+h;this.legendItems.forEach((N,A)=>{n.strokeStyle=N.fontColor,n.fillStyle=N.fontColor;const P=n.measureText(N.text).width,F=l.textAlign(N.textAlign||(N.textAlign=a.textAlign)),E=p+f+P;let I=g.x,L=g.y;l.setWidth(this.width),y?A>0&&I+E+h>this.right&&(L=g.y+=k,g.line++,I=g.x=me(i,this.left+h,this.right-r[g.line])):A>0&&L+k>this.bottom&&(I=g.x=I+t[g.line].width+h,g.line++,L=g.y=me(i,this.top+v+h,this.bottom-t[g.line].height));const z=l.x(I);if(x(z,L,N),I=Ih(F,I+p+f,y?I+E:this.right,e.rtl),w(l.x(I),L,N),y)g.x+=E+h;else if(typeof N.text!="string"){const T=c.lineHeight;g.y+=go(N,T)+h}else g.y+=k}),to(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,r=fe(t.font),n=je(t.padding);if(!t.display)return;const i=vt(e.rtl,this.left,this.width),a=this.ctx,o=t.position,l=r.size/2,c=n.top+l;let h,u=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),h=this.top+c,u=me(e.align,u,this.right-f);else{const p=this.columnSizes.reduce((b,m)=>Math.max(b,m.height),0);h=c+me(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}const g=me(o,u,u+f);a.textAlign=i.textAlign(Ha(o)),a.textBaseline="middle",a.strokeStyle=t.color,a.fillStyle=t.color,a.font=r.string,zs(a,t.text,g,h,r)}_computeTitleHeight(){const e=this.options.title,t=fe(e.font),r=je(e.padding);return e.display?t.lineHeight+r.height:0}_getLegendItemAt(e,t){let r,n,i;if(Rt(e,this.left,this.right)&&Rt(t,this.top,this.bottom)){for(i=this.legendHitBoxes,r=0;r<i.length;++r)if(n=i[r],Rt(e,n.left,n.left+n.width)&&Rt(t,n.top,n.top+n.height))return this.legendItems[r]}return null}handleEvent(e){const t=this.options;if(!eg(e.type,t))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const n=this._hoveredItem,i=Jf(n,r);n&&!i&&G(t.onLeave,[e,n,this],this),this._hoveredItem=r,r&&!i&&G(t.onHover,[e,r,this],this)}else r&&G(t.onClick,[e,r,this],this)}}function Xf(s,e,t,r,n){const i=Qf(r,s,e,t),a=Zf(n,r,e.lineHeight);return{itemWidth:i,itemHeight:a}}function Qf(s,e,t,r){let n=s.text;return n&&typeof n!="string"&&(n=n.reduce((i,a)=>i.length>a.length?i:a)),e+t.size/2+r.measureText(n).width}function Zf(s,e,t){let r=s;return typeof e.text!="string"&&(r=go(e,t)),r}function go(s,e){const t=s.text?s.text.length:0;return e*t}function eg(s,e){return!!((s==="mousemove"||s==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(s==="click"||s==="mouseup"))}var tg={id:"legend",_element:Ii,start(s,e,t){const r=s.legend=new Ii({ctx:s.ctx,options:t,chart:s});qe.configure(s,r,t),qe.addBox(s,r)},stop(s){qe.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,e,t){const r=s.legend;qe.configure(s,r,t),r.options=t},afterUpdate(s){const e=s.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(s,e){e.replay||s.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,e,t){const r=e.datasetIndex,n=t.chart;n.isDatasetVisible(r)?(n.hide(r),e.hidden=!0):(n.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const e=s.data.datasets,{labels:{usePointStyle:t,pointStyle:r,textAlign:n,color:i,useBorderRadius:a,borderRadius:o}}=s.legend.options;return s._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(t?0:void 0),h=je(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:i,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:c.borderColor,pointStyle:r||c.pointStyle,rotation:c.rotation,textAlign:n||c.textAlign,borderRadius:a&&(o||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};const Bt={average(s){if(!s.length)return!1;let e,t,r=new Set,n=0,i=0;for(e=0,t=s.length;e<t;++e){const o=s[e].element;if(o&&o.hasValue()){const l=o.tooltipPosition();r.add(l.x),n+=l.y,++i}}return i===0||r.size===0?!1:{x:[...r].reduce((o,l)=>o+l)/r.size,y:n/i}},nearest(s,e){if(!s.length)return!1;let t=e.x,r=e.y,n=Number.POSITIVE_INFINITY,i,a,o;for(i=0,a=s.length;i<a;++i){const l=s[i].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),h=Nh(e,c);h<n&&(n=h,o=l)}}if(o){const l=o.tooltipPosition();t=l.x,r=l.y}return{x:t,y:r}}};function Ce(s,e){return e&&(ne(e)?Array.prototype.push.apply(s,e):s.push(e)),s}function De(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function sg(s,e){const{element:t,datasetIndex:r,index:n}=e,i=s.getDatasetMeta(r).controller,{label:a,value:o}=i.getLabelAndValue(n);return{chart:s,label:a,parsed:i.getParsed(n),raw:s.data.datasets[r].data[n],formattedValue:o,dataset:i.getDataset(),dataIndex:n,datasetIndex:r,element:t}}function Di(s,e){const t=s.chart.ctx,{body:r,footer:n,title:i}=s,{boxWidth:a,boxHeight:o}=e,l=fe(e.bodyFont),c=fe(e.titleFont),h=fe(e.footerFont),u=i.length,f=n.length,g=r.length,p=je(e.padding);let b=p.height,m=0,x=r.reduce((v,k)=>v+k.before.length+k.lines.length+k.after.length,0);if(x+=s.beforeBody.length+s.afterBody.length,u&&(b+=u*c.lineHeight+(u-1)*e.titleSpacing+e.titleMarginBottom),x){const v=e.displayColors?Math.max(o,l.lineHeight):l.lineHeight;b+=g*v+(x-g)*l.lineHeight+(x-1)*e.bodySpacing}f&&(b+=e.footerMarginTop+f*h.lineHeight+(f-1)*e.footerSpacing);let w=0;const y=function(v){m=Math.max(m,t.measureText(v).width+w)};return t.save(),t.font=c.string,q(s.title,y),t.font=l.string,q(s.beforeBody.concat(s.afterBody),y),w=e.displayColors?a+2+e.boxPadding:0,q(r,v=>{q(v.before,y),q(v.lines,y),q(v.after,y)}),w=0,t.font=h.string,q(s.footer,y),t.restore(),m+=p.width,{width:m,height:b}}function rg(s,e){const{y:t,height:r}=e;return t<r/2?"top":t>s.height-r/2?"bottom":"center"}function ng(s,e,t,r){const{x:n,width:i}=r,a=t.caretSize+t.caretPadding;if(s==="left"&&n+i+a>e.width||s==="right"&&n-i-a<0)return!0}function ig(s,e,t,r){const{x:n,width:i}=t,{width:a,chartArea:{left:o,right:l}}=s;let c="center";return r==="center"?c=n<=(o+l)/2?"left":"right":n<=i/2?c="left":n>=a-i/2&&(c="right"),ng(c,s,e,t)&&(c="center"),c}function Mi(s,e,t){const r=t.yAlign||e.yAlign||rg(s,t);return{xAlign:t.xAlign||e.xAlign||ig(s,e,t,r),yAlign:r}}function ag(s,e){let{x:t,width:r}=s;return e==="right"?t-=r:e==="center"&&(t-=r/2),t}function og(s,e,t){let{y:r,height:n}=s;return e==="top"?r+=t:e==="bottom"?r-=n+t:r-=n/2,r}function Ri(s,e,t,r){const{caretSize:n,caretPadding:i,cornerRadius:a}=s,{xAlign:o,yAlign:l}=t,c=n+i,{topLeft:h,topRight:u,bottomLeft:f,bottomRight:g}=Gt(a);let p=ag(e,o);const b=og(e,l,c);return l==="center"?o==="left"?p+=c:o==="right"&&(p-=c):o==="left"?p-=Math.max(h,f)+n:o==="right"&&(p+=Math.max(u,g)+n),{x:xe(p,0,r.width-e.width),y:xe(b,0,r.height-e.height)}}function ks(s,e,t){const r=je(t.padding);return e==="center"?s.x+s.width/2:e==="right"?s.x+s.width-r.right:s.x+r.left}function Li(s){return Ce([],De(s))}function lg(s,e,t){return Nt(s,{tooltip:e,tooltipItems:t,type:"tooltip"})}function $i(s,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?s.override(t):s}const mo={beforeTitle:Ee,title(s){if(s.length>0){const e=s[0],t=e.chart.data.labels,r=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return t[e.dataIndex]}return""},afterTitle:Ee,beforeBody:Ee,beforeLabel:Ee,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let e=s.dataset.label||"";e&&(e+=": ");const t=s.formattedValue;return oe(t)||(e+=t),e},labelColor(s){const t=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const t=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Ee,afterBody:Ee,beforeFooter:Ee,footer:Ee,afterFooter:Ee};function de(s,e,t,r){const n=s[e].call(t,r);return typeof n>"u"?mo[e].call(t,r):n}class Hr extends ct{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,r=this.options.setContext(this.getContext()),n=r.enabled&&t.options.animation&&r.animations,i=new so(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=lg(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:r}=t,n=de(r,"beforeTitle",this,e),i=de(r,"title",this,e),a=de(r,"afterTitle",this,e);let o=[];return o=Ce(o,De(n)),o=Ce(o,De(i)),o=Ce(o,De(a)),o}getBeforeBody(e,t){return Li(de(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:r}=t,n=[];return q(e,i=>{const a={before:[],lines:[],after:[]},o=$i(r,i);Ce(a.before,De(de(o,"beforeLabel",this,i))),Ce(a.lines,de(o,"label",this,i)),Ce(a.after,De(de(o,"afterLabel",this,i))),n.push(a)}),n}getAfterBody(e,t){return Li(de(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:r}=t,n=de(r,"beforeFooter",this,e),i=de(r,"footer",this,e),a=de(r,"afterFooter",this,e);let o=[];return o=Ce(o,De(n)),o=Ce(o,De(i)),o=Ce(o,De(a)),o}_createItems(e){const t=this._active,r=this.chart.data,n=[],i=[],a=[];let o=[],l,c;for(l=0,c=t.length;l<c;++l)o.push(sg(this.chart,t[l]));return e.filter&&(o=o.filter((h,u,f)=>e.filter(h,u,f,r))),e.itemSort&&(o=o.sort((h,u)=>e.itemSort(h,u,r))),q(o,h=>{const u=$i(e.callbacks,h);n.push(de(u,"labelColor",this,h)),i.push(de(u,"labelPointStyle",this,h)),a.push(de(u,"labelTextColor",this,h))}),this.labelColors=n,this.labelPointStyles=i,this.labelTextColors=a,this.dataPoints=o,o}update(e,t){const r=this.options.setContext(this.getContext()),n=this._active;let i,a=[];if(!n.length)this.opacity!==0&&(i={opacity:0});else{const o=Bt[r.position].call(this,n,this._eventPosition);a=this._createItems(r),this.title=this.getTitle(a,r),this.beforeBody=this.getBeforeBody(a,r),this.body=this.getBody(a,r),this.afterBody=this.getAfterBody(a,r),this.footer=this.getFooter(a,r);const l=this._size=Di(this,r),c=Object.assign({},o,l),h=Mi(this.chart,r,c),u=Ri(r,c,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,i={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:o.x,caretY:o.y}}this._tooltipItems=a,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,r,n){const i=this.getCaretPosition(e,r,n);t.lineTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineTo(i.x3,i.y3)}getCaretPosition(e,t,r){const{xAlign:n,yAlign:i}=this,{caretSize:a,cornerRadius:o}=r,{topLeft:l,topRight:c,bottomLeft:h,bottomRight:u}=Gt(o),{x:f,y:g}=e,{width:p,height:b}=t;let m,x,w,y,v,k;return i==="center"?(v=g+b/2,n==="left"?(m=f,x=m-a,y=v+a,k=v-a):(m=f+p,x=m+a,y=v-a,k=v+a),w=m):(n==="left"?x=f+Math.max(l,h)+a:n==="right"?x=f+p-Math.max(c,u)-a:x=this.caretX,i==="top"?(y=g,v=y-a,m=x-a,w=x+a):(y=g+b,v=y+a,m=x+a,w=x-a),k=y),{x1:m,x2:x,x3:w,y1:y,y2:v,y3:k}}drawTitle(e,t,r){const n=this.title,i=n.length;let a,o,l;if(i){const c=vt(r.rtl,this.x,this.width);for(e.x=ks(this,r.titleAlign,r),t.textAlign=c.textAlign(r.titleAlign),t.textBaseline="middle",a=fe(r.titleFont),o=r.titleSpacing,t.fillStyle=r.titleColor,t.font=a.string,l=0;l<i;++l)t.fillText(n[l],c.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+o,l+1===i&&(e.y+=r.titleMarginBottom-o)}}_drawColorBox(e,t,r,n,i){const a=this.labelColors[r],o=this.labelPointStyles[r],{boxHeight:l,boxWidth:c}=i,h=fe(i.bodyFont),u=ks(this,"left",i),f=n.x(u),g=l<h.lineHeight?(h.lineHeight-l)/2:0,p=t.y+g;if(i.usePointStyle){const b={radius:Math.min(c,l)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},m=n.leftForLtr(f,c)+c/2,x=p+l/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,si(e,b,m,x),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,si(e,b,m,x)}else{e.lineWidth=W(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const b=n.leftForLtr(f,c),m=n.leftForLtr(n.xPlus(f,1),c-2),x=Gt(a.borderRadius);Object.values(x).some(w=>w!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,Br(e,{x:b,y:p,w:c,h:l,radius:x}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),Br(e,{x:m,y:p+1,w:c-2,h:l-2,radius:x}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(b,p,c,l),e.strokeRect(b,p,c,l),e.fillStyle=a.backgroundColor,e.fillRect(m,p+1,c-2,l-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,t,r){const{body:n}=this,{bodySpacing:i,bodyAlign:a,displayColors:o,boxHeight:l,boxWidth:c,boxPadding:h}=r,u=fe(r.bodyFont);let f=u.lineHeight,g=0;const p=vt(r.rtl,this.x,this.width),b=function(P){t.fillText(P,p.x(e.x+g),e.y+f/2),e.y+=f+i},m=p.textAlign(a);let x,w,y,v,k,N,A;for(t.textAlign=a,t.textBaseline="middle",t.font=u.string,e.x=ks(this,m,r),t.fillStyle=r.bodyColor,q(this.beforeBody,b),g=o&&m!=="right"?a==="center"?c/2+h:c+2+h:0,v=0,N=n.length;v<N;++v){for(x=n[v],w=this.labelTextColors[v],t.fillStyle=w,q(x.before,b),y=x.lines,o&&y.length&&(this._drawColorBox(t,e,v,p,r),f=Math.max(u.lineHeight,l)),k=0,A=y.length;k<A;++k)b(y[k]),f=u.lineHeight;q(x.after,b)}g=0,f=u.lineHeight,q(this.afterBody,b),e.y-=i}drawFooter(e,t,r){const n=this.footer,i=n.length;let a,o;if(i){const l=vt(r.rtl,this.x,this.width);for(e.x=ks(this,r.footerAlign,r),e.y+=r.footerMarginTop,t.textAlign=l.textAlign(r.footerAlign),t.textBaseline="middle",a=fe(r.footerFont),t.fillStyle=r.footerColor,t.font=a.string,o=0;o<i;++o)t.fillText(n[o],l.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+r.footerSpacing}}drawBackground(e,t,r,n){const{xAlign:i,yAlign:a}=this,{x:o,y:l}=e,{width:c,height:h}=r,{topLeft:u,topRight:f,bottomLeft:g,bottomRight:p}=Gt(n.cornerRadius);t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.beginPath(),t.moveTo(o+u,l),a==="top"&&this.drawCaret(e,t,r,n),t.lineTo(o+c-f,l),t.quadraticCurveTo(o+c,l,o+c,l+f),a==="center"&&i==="right"&&this.drawCaret(e,t,r,n),t.lineTo(o+c,l+h-p),t.quadraticCurveTo(o+c,l+h,o+c-p,l+h),a==="bottom"&&this.drawCaret(e,t,r,n),t.lineTo(o+g,l+h),t.quadraticCurveTo(o,l+h,o,l+h-g),a==="center"&&i==="left"&&this.drawCaret(e,t,r,n),t.lineTo(o,l+u),t.quadraticCurveTo(o,l,o+u,l),t.closePath(),t.fill(),n.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,r=this.$animations,n=r&&r.x,i=r&&r.y;if(n||i){const a=Bt[e.position].call(this,this._active,this._eventPosition);if(!a)return;const o=this._size=Di(this,e),l=Object.assign({},a,this._size),c=Mi(t,e,l),h=Ri(e,l,c,t);(n._to!==h.x||i._to!==h.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(t);const n={width:this.width,height:this.height},i={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const a=je(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=r,this.drawBackground(i,e,n,t),eo(e,t.textDirection),i.y+=a.top,this.drawTitle(i,e,t),this.drawBody(i,e,t),this.drawFooter(i,e,t),to(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const r=this._active,n=e.map(({datasetIndex:o,index:l})=>{const c=this.chart.getDatasetMeta(o);if(!c)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:c.data[l],index:l}}),i=!Rs(r,n),a=this._positionChanged(n,t);(i||a)&&(this._active=n,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,r=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,i=this._active||[],a=this._getActiveElements(e,i,t,r),o=this._positionChanged(a,e),l=t||!Rs(a,i)||o;return l&&(this._active=a,(n.enabled||n.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),l}_getActiveElements(e,t,r,n){const i=this.options;if(e.type==="mouseout")return[];if(!n)return t.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,i.mode,i,r);return i.reverse&&a.reverse(),a}_positionChanged(e,t){const{caretX:r,caretY:n,options:i}=this,a=Bt[i.position].call(this,e,t);return a!==!1&&(r!==a.x||n!==a.y)}}$(Hr,"positioners",Bt);var cg={id:"tooltip",_element:Hr,positioners:Bt,afterInit(s,e,t){t&&(s.tooltip=new Hr({chart:s,options:t}))},beforeUpdate(s,e,t){s.tooltip&&s.tooltip.initialize(t)},reset(s,e,t){s.tooltip&&s.tooltip.initialize(t)},afterDraw(s){const e=s.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(s.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",t)}},afterEvent(s,e){if(s.tooltip){const t=e.replay;s.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,e)=>e.bodyFont.size,boxWidth:(s,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:mo},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const ir={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ue=Object.keys(ir);function Fi(s,e){return s-e}function Bi(s,e){if(oe(e))return null;const t=s._adapter,{parser:r,round:n,isoWeekday:i}=s._parseOpts;let a=e;return typeof r=="function"&&(a=r(a)),Le(a)||(a=typeof r=="string"?t.parse(a,r):t.parse(a)),a===null?null:(n&&(a=n==="week"&&(Bs(i)||i===!0)?t.startOf(a,"isoWeek",i):t.startOf(a,n)),+a)}function Ui(s,e,t,r){const n=ue.length;for(let i=ue.indexOf(s);i<n-1;++i){const a=ir[ue[i]],o=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((t-e)/(o*a.size))<=r)return ue[i]}return ue[n-1]}function dg(s,e,t,r,n){for(let i=ue.length-1;i>=ue.indexOf(t);i--){const a=ue[i];if(ir[a].common&&s._adapter.diff(n,r,a)>=e-1)return a}return ue[t?ue.indexOf(t):0]}function hg(s){for(let e=ue.indexOf(s)+1,t=ue.length;e<t;++e)if(ir[ue[e]].common)return ue[e]}function zi(s,e,t){if(!t)s[e]=!0;else if(t.length){const{lo:r,hi:n}=rn(t,e),i=t[r]>=e?t[r]:t[n];s[i]=!0}}function ug(s,e,t,r){const n=s._adapter,i=+n.startOf(e[0].value,r),a=e[e.length-1].value;let o,l;for(o=i;o<=a;o=+n.add(o,1,r))l=t[o],l>=0&&(e[l].major=!0);return e}function Wi(s,e,t){const r=[],n={},i=e.length;let a,o;for(a=0;a<i;++a)o=e[a],n[o]=a,r.push({value:o,major:!1});return i===0||!t?r:ug(s,r,n,t)}class Vs extends rr{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const r=e.time||(e.time={}),n=this._adapter=new Du._date(e.adapters.date);n.init(t),qt(r.displayFormats,n.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:Bi(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,r=e.time.unit||"day";let{min:n,max:i,minDefined:a,maxDefined:o}=this.getUserBounds();function l(c){!a&&!isNaN(c.min)&&(n=Math.min(n,c.min)),!o&&!isNaN(c.max)&&(i=Math.max(i,c.max))}(!a||!o)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),n=Le(n)&&!isNaN(n)?n:+t.startOf(Date.now(),r),i=Le(i)&&!isNaN(i)?i:+t.endOf(Date.now(),r)+1,this.min=Math.min(n,i-1),this.max=Math.max(n+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],r=e[e.length-1]),{min:t,max:r}}buildTicks(){const e=this.options,t=e.time,r=e.ticks,n=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const i=this.min,a=this.max,o=Ah(n,i,a);return this._unit=t.unit||(r.autoSkip?Ui(t.minUnit,this.min,this.max,this._getLabelCapacity(i)):dg(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:hg(this._unit),this.initOffsets(n),e.reverse&&o.reverse(),Wi(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,r=0,n,i;this.options.offset&&e.length&&(n=this.getDecimalForValue(e[0]),e.length===1?t=1-n:t=(this.getDecimalForValue(e[1])-n)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?r=i:r=(i-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;t=xe(t,0,a),r=xe(r,0,a),this._offsets={start:t,end:r,factor:1/(t+1+r)}}_generate(){const e=this._adapter,t=this.min,r=this.max,n=this.options,i=n.time,a=i.unit||Ui(i.minUnit,t,r,this._getLabelCapacity(t)),o=V(n.ticks.stepSize,1),l=a==="week"?i.isoWeekday:!1,c=Bs(l)||l===!0,h={};let u=t,f,g;if(c&&(u=+e.startOf(u,"isoWeek",l)),u=+e.startOf(u,c?"day":a),e.diff(r,t,a)>1e5*o)throw new Error(t+" and "+r+" are too far apart with stepSize of "+o+" "+a);const p=n.ticks.source==="data"&&this.getDataTimestamps();for(f=u,g=0;f<r;f=+e.add(f,o,a),g++)zi(h,f,p);return(f===r||n.bounds==="ticks"||g===1)&&zi(h,f,p),Object.keys(h).sort(Fi).map(b=>+b)}getLabelForValue(e){const t=this._adapter,r=this.options.time;return r.tooltipFormat?t.format(e,r.tooltipFormat):t.format(e,r.displayFormats.datetime)}format(e,t){const n=this.options.time.displayFormats,i=this._unit,a=t||n[i];return this._adapter.format(e,a)}_tickFormatFunction(e,t,r,n){const i=this.options,a=i.ticks.callback;if(a)return G(a,[e,t,r],this);const o=i.time.displayFormats,l=this._unit,c=this._majorUnit,h=l&&o[l],u=c&&o[c],f=r[t],g=c&&u&&f&&f.major;return this._adapter.format(e,n||(g?u:h))}generateTickLabels(e){let t,r,n;for(t=0,r=e.length;t<r;++t)n=e[t],n.label=this._tickFormatFunction(n.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+r)*t.factor)}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,r=this.ctx.measureText(e).width,n=it(this.isHorizontal()?t.maxRotation:t.minRotation),i=Math.cos(n),a=Math.sin(n),o=this._resolveTickFontOptions(0).size;return{w:r*i+o*a,h:r*a+o*i}}_getLabelCapacity(e){const t=this.options.time,r=t.displayFormats,n=r[t.unit]||r.millisecond,i=this._tickFormatFunction(e,0,Wi(this,[e],this._majorUnit),n),a=this._getLabelSize(i),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],t,r;if(e.length)return e;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(t=0,r=n.length;t<r;++t)e=e.concat(n[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,r;if(e.length)return e;const n=this.getLabels();for(t=0,r=n.length;t<r;++t)e.push(Bi(this,n[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Eh(e.sort(Fi))}}$(Vs,"id","time"),$(Vs,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function js(s,e,t){let r=0,n=s.length-1,i,a,o,l;t?(e>=s[r].pos&&e<=s[n].pos&&({lo:r,hi:n}=$r(s,"pos",e)),{pos:i,time:o}=s[r],{pos:a,time:l}=s[n]):(e>=s[r].time&&e<=s[n].time&&({lo:r,hi:n}=$r(s,"time",e)),{time:i,pos:o}=s[r],{time:a,pos:l}=s[n]);const c=a-i;return c?o+(l-o)*(e-i)/c:o}class Hi extends Vs{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=js(t,this.min),this._tableRange=js(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:r}=this,n=[],i=[];let a,o,l,c,h;for(a=0,o=e.length;a<o;++a)c=e[a],c>=t&&c<=r&&n.push(c);if(n.length<2)return[{time:t,pos:0},{time:r,pos:1}];for(a=0,o=n.length;a<o;++a)h=n[a+1],l=n[a-1],c=n[a],Math.round((h+l)/2)!==c&&i.push({time:c,pos:a/(o-1)});return i}_generate(){const e=this.min,t=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(t)||r.length===1)&&r.push(t),r.sort((n,i)=>n-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),r=this.getLabelTimestamps();return t.length&&r.length?e=this.normalize(t.concat(r)):e=t.length?t:r,e=this._cache.all=e,e}getDecimalForValue(e){return(js(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return js(this._table,r*this._tableRange+this._minPos,!0)}}$(Hi,"id","timeseries"),$(Hi,"defaults",Vs.defaults);const po="label";function qi(s,e){typeof s=="function"?s(e):s&&(s.current=e)}function fg(s,e){const t=s.options;t&&e&&Object.assign(t,e)}function bo(s,e){s.labels=e}function xo(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:po;const r=[];s.datasets=e.map(n=>{const i=s.datasets.find(a=>a[t]===n[t]);return!i||!n.data||r.includes(i)?{...n}:(r.push(i),Object.assign(i,n),i)})}function gg(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:po;const t={labels:[],datasets:[]};return bo(t,s.labels),xo(t,s.datasets,e),t}function mg(s,e){const{height:t=150,width:r=300,redraw:n=!1,datasetIdKey:i,type:a,data:o,options:l,plugins:c=[],fallbackContent:h,updateMode:u,...f}=s,g=j.useRef(null),p=j.useRef(null),b=()=>{g.current&&(p.current=new nr(g.current,{type:a,data:gg(o,i),options:l&&{...l},plugins:c}),qi(e,p.current))},m=()=>{qi(e,null),p.current&&(p.current.destroy(),p.current=null)};return j.useEffect(()=>{!n&&p.current&&l&&fg(p.current,l)},[n,l]),j.useEffect(()=>{!n&&p.current&&bo(p.current.config.data,o.labels)},[n,o.labels]),j.useEffect(()=>{!n&&p.current&&o.datasets&&xo(p.current.config.data,o.datasets,i)},[n,o.datasets]),j.useEffect(()=>{p.current&&(n?(m(),setTimeout(b)):p.current.update(u))},[n,l,o.labels,o.datasets,u]),j.useEffect(()=>{p.current&&(m(),setTimeout(b))},[a]),j.useEffect(()=>(b(),()=>m()),[]),Ji.createElement("canvas",{ref:g,role:"img",height:t,width:r,...f},h)}const pg=j.forwardRef(mg);function bg(s,e){return nr.register(e),j.forwardRef((t,r)=>Ji.createElement(pg,{...t,ref:r,type:s}))}const xg=bg("pie",Ur);nr.register(Ft,cg,tg);function yg({data:s,title:e="Expenses by Category",className:t=""}){const r=s.filter(l=>l.amount>0);if(r.length===0)return d.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 ${t}`,children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:d.jsx(ar,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e})]}),d.jsxs("div",{className:"text-center py-8",children:[d.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(ar,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),d.jsx("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-2",children:"No data to display"}),d.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Start adding transactions to see your spending breakdown"})]})]});const n={labels:r.map(l=>l.name),datasets:[{data:r.map(l=>l.amount),backgroundColor:r.map(l=>l.color),borderColor:r.map(l=>l.color),borderWidth:2,hoverBorderWidth:3,hoverOffset:8}]},i={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,pointStyle:"circle",font:{size:12},color:"rgb(107, 114, 128)"}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(l){const c=l.label||"",h=l.parsed,u=l.dataset.data.reduce((p,b)=>p+b,0),f=(h/u*100).toFixed(1),g=r[l.dataIndex];return[`${c}: ${new Intl.NumberFormat("en-NG").format(h)}`,`${f}% of total`,`${g.transactionCount} transaction${g.transactionCount!==1?"s":""}`]}}}},animation:{animateRotate:!0,animateScale:!0,duration:1e3}},a=r.reduce((l,c)=>l+c.amount,0),o=r.reduce((l,c)=>l+c.transactionCount,0);return d.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 transition-colors duration-200 ${t}`,children:[d.jsx("div",{className:"flex items-center justify-between mb-6",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:d.jsx(ar,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e}),d.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o," transaction",o!==1?"s":"","  ",new Intl.NumberFormat("en-NG").format(a)]})]})]})}),d.jsx("div",{className:"relative h-64 sm:h-80 mb-6",children:d.jsx(xg,{data:n,options:i})}),d.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.length}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Categories"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Transactions"})]}),d.jsxs("div",{className:"text-center col-span-2 sm:col-span-1",children:[d.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["",new Intl.NumberFormat("en-NG",{notation:"compact"}).format(a)]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Amount"})]})]})]})}function Vi({addToast:s}){const e=$e(),{user:t}=e,{accounts:r,transactions:n,categories:i,loadData:a,isOnline:o,syncInProgress:l,exchangeRate:c}=we(),[h,u]=j.useState(null),[f,g]=j.useState(!1),[p,b]=j.useState("thisMonth"),[m,x]=j.useState([]);j.useEffect(()=>{t&&(a(t.id),w())},[t,a]);const w=async()=>{if(t)try{const{data:_,error:M}=await J.from("user_profiles").select("full_name, currency").eq("id",t.id).single();if(M){console.error("Error loading user profile:",M);return}u(_)}catch(_){console.error("Error loading user profile:",_)}},y=async()=>{if(!(!o||l||f)){g(!0);try{await Te.sync(),t&&await a(t.id),s({type:"success",title:"Sync complete"})}catch(_){console.error("Manual sync failed:",_),s({type:"error",title:"Sync failed"})}finally{g(!1)}}},k=(()=>{const _=new Date;switch(p){case"thisMonth":return{start:lr(_),end:Ct(_),label:We(_,"MMMM yyyy")};case"last3Months":return{start:lr(Zo(_,2)),end:Ct(_),label:"Last 3 months"};case"thisYear":return{start:Qo(_),end:Ct(_),label:We(_,"yyyy")};case"allTime":return{start:new Date(0),end:Ct(_),label:"All time"};default:return{start:lr(_),end:Ct(_),label:We(_,"MMMM yyyy")}}})(),N=n.filter(_=>{const M=new Date(_.date);return M>=k.start&&M<=k.end}),A=N.filter(_=>_.type==="income").reduce((_,M)=>_+M.amount,0),P=N.filter(_=>_.type==="expense").reduce((_,M)=>_+M.amount,0),F=r.reduce((_,M)=>_+M.current_balance,0),E=A-P,I=i.filter(_=>_.type==="expense"),L=I.map(_=>{const M=N.filter(H=>H.type==="expense"&&H.category_id===_.id&&(m.length===0||m.includes(_.id))),C=M.reduce((H,le)=>H+le.amount,0);return{id:_.id,name:_.name,amount:C,color:_.color,transactionCount:M.length}}).filter(_=>_.amount>0),z=[{title:"Total Balance",value:F,icon:Ks,color:"blue",bgColor:"bg-blue-50 dark:bg-blue-900/20",iconColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-700"},{title:`Income (${k.label})`,value:A,icon:Ts,color:"green",bgColor:"bg-green-50 dark:bg-green-900/20",iconColor:"text-green-600 dark:text-green-400",borderColor:"border-green-200 dark:border-green-700"},{title:`Expenses (${k.label})`,value:P,icon:gn,color:"red",bgColor:"bg-red-50 dark:bg-red-900/20",iconColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-700"},{title:"Net Income",value:E,icon:E>=0?$o:gn,color:E>=0?"green":"red",bgColor:E>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20",iconColor:E>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",borderColor:E>=0?"border-green-200 dark:border-green-700":"border-red-200 dark:border-red-700"}],T=_=>{const M=(h==null?void 0:h.currency)||"NGN";if(M==="USD"&&c){const C=_/c;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(C)}else return M==="NGN"?`${new Intl.NumberFormat("en-NG").format(_)}`:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(_)},S=()=>{var M;const _=(M=h==null?void 0:h.full_name)==null?void 0:M.split(" ")[0];return _?`Welcome back, ${_}!`:"Welcome to ChurchTrack!"},D=r.some(_=>!_.is_synced)||n.some(_=>_.sync_status==="pending"),U=[{value:"thisMonth",label:"This Month"},{value:"last3Months",label:"Last 3 Months"},{value:"thisYear",label:"This Year"},{value:"allTime",label:"All Time"}],X=_=>{x(M=>M.includes(_)?M.filter(C=>C!==_):[...M,_])};return d.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-4 sm:space-y-6 bg-gray-50 dark:bg-gray-950 transition-colors duration-200",children:[d.jsx("div",{className:"bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-700 dark:from-blue-500 dark:via-blue-600 dark:to-indigo-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-lg",children:d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",children:S()}),d.jsxs("p",{className:"text-blue-100 text-sm sm:text-base opacity-90",children:["Here's the church financial overview for ",k.label]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[D&&o&&d.jsxs("div",{className:"flex items-center gap-2 bg-blue-500/30 px-3 py-1.5 rounded-full",children:[d.jsx("div",{className:"w-2 h-2 bg-orange-300 rounded-full animate-pulse"}),d.jsx("span",{className:"text-xs font-medium text-blue-100",children:"Pending sync"})]}),d.jsxs("button",{onClick:y,disabled:!o||l||f,className:`
                flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium text-sm transition-all duration-200
                ${o&&!l&&!f?"bg-white/20 hover:bg-white/30 text-white border border-white/30 hover:border-white/50 hover:scale-105 active:scale-95 shadow-sm":"bg-white/10 text-white/60 border border-white/20 cursor-not-allowed"}
              `,title:o?"Synchronize your data":"You are offline",children:[d.jsx(As,{className:`w-4 h-4 ${l||f?"animate-spin":""}`}),d.jsx("span",{className:"hidden sm:inline",children:f?"Syncing...":"Sync Data"})]})]})]})}),d.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:z.map((_,M)=>{const C=_.icon;return d.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-xl border ${_.borderColor} p-3 sm:p-4 lg:p-6 hover:shadow-md dark:hover:shadow-lg transition-all duration-200 hover:scale-105`,children:[d.jsx("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:d.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 rounded-lg border ${_.borderColor} ${_.bgColor} flex items-center justify-center`,children:d.jsx(C,{className:`w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 ${_.iconColor}`})})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:_.title}),d.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold text-gray-900 dark:text-white",children:T(_.value)})]})]},M)})}),d.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 sm:gap-6",children:[d.jsxs("div",{className:"xl:col-span-2",children:[d.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 mb-4",children:d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Fo,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Period:"}),d.jsx("select",{value:p,onChange:_=>b(_.target.value),className:"px-3 py-1.5 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition-colors duration-200",children:U.map(_=>d.jsx("option",{value:_.value,children:_.label},_.value))})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(sa,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Categories:"}),d.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.jsx("button",{onClick:()=>x([]),className:`px-2 py-1 rounded text-xs font-medium transition-colors ${m.length===0?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:"All"}),I.slice(0,3).map(_=>d.jsx("button",{onClick:()=>X(_.id),className:`px-2 py-1 rounded text-xs font-medium transition-colors ${m.includes(_.id)?"text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,style:m.includes(_.id)?{backgroundColor:_.color}:{},children:_.name},_.id)),I.length>3&&d.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1",children:["+",I.length-3," more"]})]})]})]})}),d.jsx(yg,{data:L,title:`Expenses by Category (${k.label})`})]}),d.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 transition-colors duration-200",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[d.jsx(Bo,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),"Accounts"]})}),d.jsxs("div",{className:"space-y-3",children:[r.slice(0,4).map(_=>d.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:[d.jsxs("div",{className:"min-w-0 flex-1",children:[d.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:_.name}),d.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 capitalize",children:_.type})]}),d.jsxs("div",{className:"text-right ml-3",children:[d.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm sm:text-base",children:T(_.current_balance)}),!_.is_synced&&d.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full ml-auto mt-1"})]})]},_.id)),r.length===0&&d.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4 text-sm",children:"No accounts yet"})]})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 transition-colors duration-200",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[d.jsx(Ts,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),"Recent Transactions"]})}),d.jsxs("div",{className:"space-y-3",children:[n.sort((_,M)=>new Date(M.created_at).getTime()-new Date(_.created_at).getTime()).slice(0,5).map(_=>{const M=r.find(C=>C.id===_.account_id);return d.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:[d.jsxs("div",{className:"min-w-0 flex-1",children:[d.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:_.description||"Transaction"}),d.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:[M==null?void 0:M.name,"  ",We(new Date(_.date),"MMM d")]})]}),d.jsxs("div",{className:"text-right flex items-center gap-2 ml-3",children:[d.jsxs("p",{className:`font-semibold text-sm sm:text-base ${_.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[_.type==="income"?"+":"-",T(Math.abs(_.amount))]}),_.sync_status==="pending"&&d.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full flex-shrink-0"})]})]},_.id)}),n.length===0&&d.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4 text-sm",children:"No transactions yet"})]})]})]})]})]})}function vg({onClose:s,onSuccess:e}){const[t,r]=j.useState(""),[n,i]=j.useState("checking"),[a,o]=j.useState(""),[l,c]=j.useState(!1),[h,u]=j.useState(""),{createAccount:f}=we(),{user:g}=$e(),p=[{id:"checking",name:"Checking",description:"For everyday spending",icon:qr,color:"blue"},{id:"savings",name:"Savings",description:"For saving money",icon:Vr,color:"green"},{id:"credit",name:"Credit Card",description:"For credit spending",icon:at,color:"red"},{id:"cash",name:"Cash",description:"Physical cash",icon:Ks,color:"gray"}],b=async m=>{if(m.preventDefault(),!!g){c(!0),u("");try{const x=parseFloat(a)||0;await f({user_id:g.id,name:t,type:n,initial_balance:x,current_balance:x}),e()}catch(x){u(x.message||"Failed to create account")}finally{c(!1)}}};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 rounded-t-2xl",children:[d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Create Account"}),d.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("form",{onSubmit:b,className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[h&&d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-sm",children:h}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Account Name"}),d.jsx("input",{id:"name",type:"text",value:t,onChange:m=>r(m.target.value),placeholder:"e.g., Main Checking, Emergency Fund",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Account Type"}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:p.map(m=>{const x=m.icon,w=n===m.id,y={blue:w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600",green:w?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600",red:w?"border-red-500 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600",gray:w?"border-gray-500 bg-gray-50 dark:bg-gray-800":"border-gray-300 dark:border-gray-600"};return d.jsxs("button",{type:"button",onClick:()=>i(m.id),className:`p-3 sm:p-4 border-2 rounded-lg text-left hover:border-gray-400 dark:hover:border-gray-500 transition-colors ${y[m.color]}`,children:[d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[d.jsx(x,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400"}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:m.name})]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:m.description})]},m.id)})})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"balance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Initial Balance"}),d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:""}),d.jsx("input",{id:"balance",type:"number",step:"0.01",value:a,onChange:m=>o(m.target.value),placeholder:"0.00",className:"w-full pl-7 sm:pl-8 pr-3 sm:pr-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200"})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 sticky bottom-0 bg-white dark:bg-gray-900 pb-2",children:[d.jsx("button",{type:"button",onClick:s,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:l||!t.trim(),className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-blue-600 dark:bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm sm:text-base",children:l?"Creating...":"Create Account"})]})]})]})})}function wg({account:s,onClose:e,onSuccess:t}){const[r,n]=j.useState(s.name),[i,a]=j.useState(s.type),[o,l]=j.useState(s.initial_balance.toString()),[c,h]=j.useState(!1),[u,f]=j.useState(""),{updateAccount:g}=we(),p=[{id:"checking",name:"Checking",description:"For everyday spending",icon:qr,color:"blue"},{id:"savings",name:"Savings",description:"For saving money",icon:Vr,color:"green"},{id:"credit",name:"Credit Card",description:"For credit spending",icon:at,color:"red"},{id:"cash",name:"Cash",description:"Physical cash",icon:Ks,color:"gray"}],b=async m=>{m.preventDefault(),h(!0),f("");try{const x=parseFloat(o)||0,w=x-s.initial_balance,y={...s,name:r,type:i,initial_balance:x,current_balance:s.current_balance+w,updated_at:new Date().toISOString()};await g(y),t()}catch(x){f(x.message||"Failed to update account")}finally{h(!1)}};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 rounded-t-2xl",children:[d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Edit Account"}),d.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("form",{onSubmit:b,className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[u&&d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-sm",children:u}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Account Name"}),d.jsx("input",{id:"name",type:"text",value:r,onChange:m=>n(m.target.value),placeholder:"e.g., Main Checking, Emergency Fund",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Account Type"}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:p.map(m=>{const x=m.icon,w=i===m.id,y={blue:w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600",green:w?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600",red:w?"border-red-500 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600",gray:w?"border-gray-500 bg-gray-50 dark:bg-gray-800":"border-gray-300 dark:border-gray-600"};return d.jsxs("button",{type:"button",onClick:()=>a(m.id),className:`p-3 sm:p-4 border-2 rounded-lg text-left hover:border-gray-400 dark:hover:border-gray-500 transition-colors ${y[m.color]}`,children:[d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[d.jsx(x,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400"}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:m.name})]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:m.description})]},m.id)})})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"balance",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Initial Balance"}),d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:""}),d.jsx("input",{id:"balance",type:"number",step:"0.01",value:o,onChange:m=>l(m.target.value),placeholder:"0.00",className:"w-full pl-7 sm:pl-8 pr-3 sm:pr-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200"})]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Current balance will be adjusted by the difference"})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 sticky bottom-0 bg-white dark:bg-gray-900 pb-2",children:[d.jsx("button",{type:"button",onClick:e,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:c||!r.trim(),className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-blue-600 dark:bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm sm:text-base",children:c?"Updating...":"Update Account"})]})]})]})})}function yo({isOpen:s,title:e,message:t,confirmText:r="Confirm",cancelText:n="Cancel",onConfirm:i,onCancel:a,type:o="danger"}){if(!s)return null;const c={danger:{icon:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-700",button:"bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 focus:ring-red-500"},warning:{icon:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-700",button:"bg-yellow-600 hover:bg-yellow-700 dark:bg-yellow-500 dark:hover:bg-yellow-600 focus:ring-yellow-500"},info:{icon:"text-blue-600 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-700",button:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 focus:ring-blue-500"}}[o];return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full border border-gray-200 dark:border-gray-700 shadow-xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${c.bg} ${c.border} border`,children:d.jsx(Uo,{className:`w-5 h-5 ${c.icon}`})}),d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:e})]}),d.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"p-4 sm:p-6",children:[d.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm sm:text-base leading-relaxed mb-6",children:t}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[d.jsx("button",{onClick:a,className:"flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:n}),d.jsx("button",{onClick:i,className:`flex-1 px-4 py-3 text-white rounded-lg font-medium transition-colors text-sm sm:text-base ${c.button}`,children:r})]})]})]})})}function _g({addToast:s}){const[e,t]=j.useState(!1),[r,n]=j.useState(null),[i,a]=j.useState(null),[o,l]=j.useState(null),{accounts:c,deleteAccount:h}=we(),u=useAuthStore(),f=(u==null?void 0:u.isAdmin)??!1,g=v=>{switch(v){case"checking":return qr;case"savings":return Vr;case"credit":return at;case"cash":return Ks;default:return at}},p=v=>{switch(v){case"checking":return"blue";case"savings":return"green";case"credit":return"red";case"cash":return"gray";default:return"blue"}},b=v=>`${new Intl.NumberFormat("en-NG").format(v)}`,m=()=>{t(!1),s({type:"success",title:"Account created"})},x=()=>{n(null),s({type:"success",title:"Account updated"})},w=async()=>{if(i)try{await h(i.id),a(null),s({type:"success",title:"Account deleted"})}catch{s({type:"error",title:"Delete failed"})}},y=v=>{l(o===v?null:v)};return d.jsxs("div",{className:"p-4 sm:p-6 bg-gray-50 dark:bg-gray-950 transition-colors duration-200",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Accounts"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:f?"Manage church financial accounts":"View church financial accounts"})]}),f&&d.jsxs("button",{onClick:()=>t(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(wt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Add Account"]})]}),c.length>0?d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:c.map(v=>{const k=g(v.type),N=p(v.type),A={blue:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-700",green:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border-green-200 dark:border-green-700",red:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border-red-200 dark:border-red-700",gray:"bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-400 border-gray-200 dark:border-gray-600"};return d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 hover:shadow-lg dark:hover:shadow-2xl transition-all duration-200 relative group hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-lg border flex items-center justify-center ${A[N]}`,children:d.jsx(k,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),d.jsxs("div",{className:"flex items-center gap-2",children:[!v.is_synced&&d.jsx("div",{className:"w-3 h-3 bg-orange-400 rounded-full",title:"Not synced"}),f&&d.jsxs("div",{className:"relative",children:[d.jsx("button",{onClick:()=>y(v.id),className:"p-2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:d.jsx(ra,{className:"w-4 h-4"})}),o===v.id&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(null)}),d.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-20",children:[d.jsxs("button",{onClick:()=>{n(v),l(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2",children:[d.jsx(Os,{className:"w-4 h-4"}),"Edit Account"]}),d.jsxs("button",{onClick:()=>{a(v),l(null)},className:"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[d.jsx(Es,{className:"w-4 h-4"}),"Delete Account"]})]})]})]})]})]}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-1 truncate",children:v.name}),d.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 capitalize mb-3",children:[v.type," Account"]}),d.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:b(v.current_balance)}),d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Initial: ",b(v.initial_balance)]})]})]},v.id)})}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(at,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),d.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No accounts yet"}),d.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 text-sm sm:text-base",children:f?"Create your first account to start tracking church finances":"No church accounts have been created yet"}),f&&d.jsxs("button",{onClick:()=>t(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 transition-all duration-200 inline-flex items-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(wt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Create Account"]})]}),e&&f&&d.jsx(vg,{onClose:()=>t(!1),onSuccess:m}),r&&f&&d.jsx(wg,{account:r,onClose:()=>n(null),onSuccess:x}),d.jsx(yo,{isOpen:!!i,title:"Delete Account",message:`Are you sure you want to delete "${i==null?void 0:i.name}"? This will also delete all associated transactions. This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",type:"danger",onConfirm:w,onCancel:()=>a(null)})]})}function vo({onClose:s,onSuccess:e}){var z,T;const[t,r]=j.useState("expense"),[n,i]=j.useState(""),[a,o]=j.useState(""),[l,c]=j.useState(""),[h,u]=j.useState(""),[f,g]=j.useState(""),[p,b]=j.useState(We(new Date,"yyyy-MM-dd")),[m,x]=j.useState(!1),[w,y]=j.useState(""),{createTransaction:v,accounts:k,categories:N}=we(),A=N.filter(S=>S.type===t),P=k.filter(S=>S.id!==n),F=async S=>{if(S.preventDefault(),!(!n||!h)){if(t==="transfer"&&!a){y("Please select a target account for the transfer");return}x(!0),y("");try{await v({account_id:n,target_account_id:t==="transfer"?a:null,category_id:t==="transfer"?null:l||null,amount:parseFloat(h),description:f||(t==="transfer"?"Transfer":""),date:p,type:t}),e()}catch(D){y(D.message||"Failed to create transaction")}finally{x(!1)}}},E=S=>{r(S),S!=="transfer"&&o(""),S==="transfer"&&c("")};return(()=>{switch(t){case"income":return{icon:yt,color:"green",description:"Money coming in"};case"expense":return{icon:Ps,color:"red",description:"Money going out"};case"transfer":return{icon:Is,color:"blue",description:"Move money between accounts"}}})().icon,d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 rounded-t-2xl",children:[d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Add Transaction"}),d.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("form",{onSubmit:F,className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[w&&d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-sm",children:w}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Transaction Type"}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[{id:"income",label:"Income",icon:yt,color:"green"},{id:"expense",label:"Expense",icon:Ps,color:"red"},{id:"transfer",label:"Transfer",icon:Is,color:"blue"}].map(S=>{const D=S.icon,U=t===S.id,X={green:U?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600",red:U?"border-red-500 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600",blue:U?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600"},_={green:"text-green-600 dark:text-green-400",red:"text-red-600 dark:text-red-400",blue:"text-blue-600 dark:text-blue-400"};return d.jsxs("button",{type:"button",onClick:()=>E(S.id),className:`p-3 sm:p-4 border-2 rounded-lg text-left hover:border-gray-400 dark:hover:border-gray-500 transition-colors ${X[S.color]}`,children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx(D,{className:`w-4 h-4 sm:w-5 sm:h-5 ${_[S.color]}`}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:S.label})]}),d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[S.id==="income"&&"Money coming in",S.id==="expense"&&"Money going out",S.id==="transfer"&&"Between accounts"]})]},S.id)})})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"account",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t==="transfer"?"From Account":"Account"}),d.jsxs("select",{id:"account",value:n,onChange:S=>i(S.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0,children:[d.jsx("option",{value:"",children:"Select an account"}),k.map(S=>d.jsxs("option",{value:S.id,children:[S.name," (",new Intl.NumberFormat("en-NG").format(S.current_balance),")"]},S.id))]})]}),t==="transfer"&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"targetAccount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"To Account"}),d.jsxs("select",{id:"targetAccount",value:a,onChange:S=>o(S.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0,children:[d.jsx("option",{value:"",children:"Select target account"}),P.map(S=>d.jsxs("option",{value:S.id,children:[S.name," (",new Intl.NumberFormat("en-NG").format(S.current_balance),")"]},S.id))]})]}),t!=="transfer"&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),d.jsxs("select",{id:"category",value:l,onChange:S=>c(S.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",children:[d.jsx("option",{value:"",children:"Select a category (optional)"}),A.map(S=>d.jsx("option",{value:S.id,children:S.name},S.id))]})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Amount"}),d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:""}),d.jsx("input",{id:"amount",type:"number",step:"0.01",value:h,onChange:S=>u(S.target.value),placeholder:"0.00",className:"w-full pl-7 sm:pl-8 pr-3 sm:pr-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),t==="transfer"&&d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"This amount will be moved from the source to the target account"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),d.jsx("input",{id:"description",type:"text",value:f,onChange:S=>g(S.target.value),placeholder:t==="transfer"?"Transfer description (optional)":"What was this transaction for?",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date"}),d.jsx("input",{id:"date",type:"date",value:p,onChange:S=>b(S.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),t==="transfer"&&n&&a&&h&&d.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-sm font-medium text-blue-900 dark:text-blue-300 mb-2",children:"Transfer Summary"}),d.jsxs("div",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-400",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:"From:"}),d.jsx("span",{className:"font-medium",children:(z=k.find(S=>S.id===n))==null?void 0:z.name})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:"To:"}),d.jsx("span",{className:"font-medium",children:(T=k.find(S=>S.id===a))==null?void 0:T.name})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:"Amount:"}),d.jsxs("span",{className:"font-medium",children:["",new Intl.NumberFormat("en-NG").format(parseFloat(h)||0)]})]})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 sticky bottom-0 bg-white dark:bg-gray-900 pb-2",children:[d.jsx("button",{type:"button",onClick:s,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:m||!n||!h||t==="transfer"&&!a,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-blue-600 dark:bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm sm:text-base",children:m?"Adding...":`Add ${t==="transfer"?"Transfer":t==="income"?"Income":"Expense"}`})]})]})]})})}function kg({transaction:s,onClose:e,onSuccess:t}){var L,z;const[r,n]=j.useState(s.type),[i,a]=j.useState(s.account_id),[o,l]=j.useState(s.target_account_id||""),[c,h]=j.useState(s.category_id||""),[u,f]=j.useState(Math.abs(s.amount).toString()),[g,p]=j.useState(s.description),[b,m]=j.useState(We(new Date(s.date),"yyyy-MM-dd")),[x,w]=j.useState(!1),[y,v]=j.useState(""),{updateTransaction:k,accounts:N,categories:A}=we(),P=A.filter(T=>T.type===r),F=N.filter(T=>T.id!==i),E=async T=>{if(T.preventDefault(),!(!i||!u)){if(r==="transfer"&&!o){v("Please select a target account for the transfer");return}w(!0),v("");try{const S={...s,account_id:i,target_account_id:r==="transfer"?o:null,category_id:r==="transfer"?null:c||null,amount:parseFloat(u),description:g,date:b,type:r,updated_at:new Date().toISOString()};await k(S),t()}catch(S){v(S.message||"Failed to update transaction")}finally{w(!1)}}},I=T=>{n(T),T!=="transfer"&&l(""),T==="transfer"&&h("")};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 rounded-t-2xl",children:[d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Edit Transaction"}),d.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("form",{onSubmit:E,className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[y&&d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-sm",children:y}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Transaction Type"}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[{id:"income",label:"Income",icon:yt,color:"green"},{id:"expense",label:"Expense",icon:Ps,color:"red"},{id:"transfer",label:"Transfer",icon:Is,color:"blue"}].map(T=>{const S=T.icon,D=r===T.id,U={green:D?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600",red:D?"border-red-500 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600",blue:D?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600"},X={green:"text-green-600 dark:text-green-400",red:"text-red-600 dark:text-red-400",blue:"text-blue-600 dark:text-blue-400"};return d.jsxs("button",{type:"button",onClick:()=>I(T.id),className:`p-3 sm:p-4 border-2 rounded-lg text-left hover:border-gray-400 dark:hover:border-gray-500 transition-colors ${U[T.color]}`,children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx(S,{className:`w-4 h-4 sm:w-5 sm:h-5 ${X[T.color]}`}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:T.label})]}),d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[T.id==="income"&&"Money coming in",T.id==="expense"&&"Money going out",T.id==="transfer"&&"Between accounts"]})]},T.id)})})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"account",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r==="transfer"?"From Account":"Account"}),d.jsxs("select",{id:"account",value:i,onChange:T=>a(T.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0,children:[d.jsx("option",{value:"",children:"Select an account"}),N.map(T=>d.jsxs("option",{value:T.id,children:[T.name," (",new Intl.NumberFormat("en-NG").format(T.current_balance),")"]},T.id))]})]}),r==="transfer"&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"targetAccount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"To Account"}),d.jsxs("select",{id:"targetAccount",value:o,onChange:T=>l(T.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0,children:[d.jsx("option",{value:"",children:"Select target account"}),F.map(T=>d.jsxs("option",{value:T.id,children:[T.name," (",new Intl.NumberFormat("en-NG").format(T.current_balance),")"]},T.id))]})]}),r!=="transfer"&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),d.jsxs("select",{id:"category",value:c,onChange:T=>h(T.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",children:[d.jsx("option",{value:"",children:"Select a category (optional)"}),P.map(T=>d.jsx("option",{value:T.id,children:T.name},T.id))]})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Amount"}),d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:""}),d.jsx("input",{id:"amount",type:"number",step:"0.01",value:u,onChange:T=>f(T.target.value),placeholder:"0.00",className:"w-full pl-7 sm:pl-8 pr-3 sm:pr-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),r==="transfer"&&d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"This amount will be moved from the source to the target account"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),d.jsx("input",{id:"description",type:"text",value:g,onChange:T=>p(T.target.value),placeholder:r==="transfer"?"Transfer description (optional)":"What was this transaction for?",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date"}),d.jsx("input",{id:"date",type:"date",value:b,onChange:T=>m(T.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),r==="transfer"&&i&&o&&u&&d.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-sm font-medium text-blue-900 dark:text-blue-300 mb-2",children:"Transfer Summary"}),d.jsxs("div",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-400",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:"From:"}),d.jsx("span",{className:"font-medium",children:(L=N.find(T=>T.id===i))==null?void 0:L.name})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:"To:"}),d.jsx("span",{className:"font-medium",children:(z=N.find(T=>T.id===o))==null?void 0:z.name})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:"Amount:"}),d.jsxs("span",{className:"font-medium",children:["",new Intl.NumberFormat("en-NG").format(parseFloat(u)||0)]})]})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 sticky bottom-0 bg-white dark:bg-gray-900 pb-2",children:[d.jsx("button",{type:"button",onClick:e,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:x||!i||!u||r==="transfer"&&!o,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-blue-600 dark:bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm sm:text-base",children:x?"Updating...":"Update Transaction"})]})]})]})})}const Ss=10;function jg({addToast:s}){const[e,t]=j.useState(!1),[r,n]=j.useState(null),[i,a]=j.useState(null),[o,l]=j.useState("all"),[c,h]=j.useState("all"),[u,f]=j.useState(null),[g,p]=j.useState(Ss),{transactions:b,accounts:m,categories:x,deleteTransaction:w,exchangeRate:y}=we(),v=$e(),k=(v==null?void 0:v.isAdmin)??!1,N=b.filter(C=>o!=="all"&&C.type!==o?!1:c!=="all"?c==="uncategorized"?!C.category_id:C.category_id===c:!0).sort((C,H)=>new Date(H.created_at).getTime()-new Date(C.created_at).getTime()),A=N.slice(0,g),P=N.length>g,F=N.reduce((C,H)=>C+Math.abs(H.amount),0),E=C=>{if(y){const H=C/y;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(H)}return`${new Intl.NumberFormat("en-NG").format(C)}`},I=C=>{switch(C){case"income":return yt;case"expense":return Ps;case"transfer":return Is;default:return yt}},L=C=>{switch(C){case"income":return"text-green-600 dark:text-green-400";case"expense":return"text-red-600 dark:text-red-400";case"transfer":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}},z=()=>{t(!1),s({type:"success",title:"Transaction added"})},T=()=>{n(null),s({type:"success",title:"Transaction updated"})},S=async()=>{if(i)try{await w(i.id),a(null),s({type:"success",title:"Transaction deleted"})}catch{s({type:"error",title:"Delete failed"})}},D=C=>{f(u===C?null:C)},U=()=>{p(C=>C+Ss)},X=x.filter(C=>b.some(H=>H.category_id===C.id)),_=b.some(C=>!C.category_id),M=()=>{if(c==="all")return"all categories";if(c==="uncategorized")return"uncategorized";const C=x.find(H=>H.id===c);return C?C.name.toLowerCase():"selected category"};return d.jsxs("div",{className:"p-4 sm:p-6 bg-gray-50 dark:bg-gray-950 transition-colors duration-200",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Transactions"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:k?"Track church income, expenses, and transfers":"View church income, expenses, and transfers"})]}),k&&d.jsxs("button",{onClick:()=>t(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(wt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Add Transaction"]})]}),d.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(sa,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 dark:text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Type:"}),d.jsx("div",{className:"flex gap-2 overflow-x-auto",children:[{id:"all",label:"All"},{id:"income",label:"Income"},{id:"expense",label:"Expenses"},{id:"transfer",label:"Transfers"}].map(C=>d.jsx("button",{onClick:()=>{l(C.id),p(Ss)},className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 whitespace-nowrap ${o===C.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-700":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:C.label},C.id))})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(na,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 dark:text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category:"}),d.jsxs("select",{value:c,onChange:C=>{h(C.target.value),p(Ss)},className:"px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition-colors duration-200",children:[d.jsx("option",{value:"all",children:"All Categories"}),_&&d.jsx("option",{value:"uncategorized",children:"Uncategorized"}),X.map(C=>d.jsx("option",{value:C.id,children:C.name},C.id))]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 lg:ml-auto text-sm text-gray-500 dark:text-gray-400",children:[d.jsxs("span",{children:["Showing ",A.length," of ",N.length," transactions"]}),N.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"hidden sm:inline",children:""}),d.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["Total: ",E(F)," for ",M()]})]})]})]}),N.length>0?d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[d.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:A.map(C=>{const H=m.find(Je=>Je.id===C.account_id),le=m.find(Je=>Je.id===C.target_account_id),ie=x.find(Je=>Je.id===C.category_id),Se=I(C.type),pe=L(C.type);return d.jsx("div",{className:"p-4 sm:p-6 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0 flex-1",children:[d.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center ${pe} flex-shrink-0`,children:d.jsx(Se,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),d.jsxs("div",{className:"min-w-0 flex-1",children:[d.jsx("h3",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:C.type==="transfer"?`Transfer: ${H==null?void 0:H.name}  ${le==null?void 0:le.name}`:C.description||"Transaction"}),d.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:C.type==="transfer"?d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"truncate",children:C.description||"Transfer"}),d.jsx("span",{className:"hidden sm:inline",children:""}),d.jsx("span",{className:"whitespace-nowrap",children:We(new Date(C.date),"MMM d, yyyy")})]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"truncate",children:H==null?void 0:H.name}),ie&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"hidden sm:inline",children:""}),d.jsxs("span",{className:"truncate flex items-center gap-1",style:{color:ie.color},children:[d.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:ie.color}}),ie.name]})]}),!ie&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"hidden sm:inline",children:""}),d.jsx("span",{className:"text-gray-400 dark:text-gray-500 italic",children:"Uncategorized"})]}),d.jsx("span",{className:"hidden sm:inline",children:""}),d.jsx("span",{className:"whitespace-nowrap",children:We(new Date(C.date),"MMM d, yyyy")})]})})]})]}),d.jsxs("div",{className:"text-right flex items-center gap-2 sm:gap-3 ml-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:`text-base sm:text-lg font-semibold ${pe}`,children:C.type==="transfer"?E(Math.abs(C.amount)):`${C.type==="income"?"+":"-"}${E(Math.abs(C.amount))}`}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:C.type})]}),C.sync_status==="pending"&&d.jsx("div",{className:"w-3 h-3 bg-orange-400 rounded-full flex-shrink-0",title:"Not synced"}),k&&d.jsxs("div",{className:"relative",children:[d.jsx("button",{onClick:()=>D(C.id),className:"p-2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:d.jsx(ra,{className:"w-4 h-4"})}),u===C.id&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>f(null)}),d.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-20",children:[d.jsxs("button",{onClick:()=>{n(C),f(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2",children:[d.jsx(Os,{className:"w-4 h-4"}),"Edit Transaction"]}),d.jsxs("button",{onClick:()=>{a(C),f(null)},className:"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[d.jsx(Es,{className:"w-4 h-4"}),"Delete Transaction"]})]})]})]})]})]})},C.id)})}),P&&d.jsx("div",{className:"p-4 sm:p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:d.jsxs("button",{onClick:U,className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200 text-sm font-medium",children:[d.jsx(zo,{className:"w-4 h-4"}),"Load More (",N.length-g," remaining)"]})})]}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(yt,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),d.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2",children:o==="all"&&c==="all"?"No transactions yet":"No transactions match your filters"}),d.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 text-sm sm:text-base",children:o==="all"&&c==="all"?k?"Start by recording your first transaction":"No transactions have been recorded yet":"Try adjusting your filters or create a new transaction"}),k&&d.jsxs("button",{onClick:()=>t(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 transition-all duration-200 inline-flex items-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(wt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Add Transaction"]})]}),e&&k&&d.jsx(vo,{onClose:()=>t(!1),onSuccess:z}),r&&k&&d.jsx(kg,{transaction:r,onClose:()=>n(null),onSuccess:T}),d.jsx(yo,{isOpen:!!i,title:"Delete Transaction",message:"Are you sure you want to delete this transaction? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger",onConfirm:S,onCancel:()=>a(null)})]})}function Sg({onClose:s,onSuccess:e}){const[t,r]=j.useState(""),[n,i]=j.useState("expense"),[a,o]=j.useState("#6366f1"),[l,c]=j.useState(!1),[h,u]=j.useState(""),{user:f}=$e(),{createCategory:g}=we(),p=["#6366f1","#8b5cf6","#ec4899","#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6"],b=async m=>{if(m.preventDefault(),!(!f||!t.trim())){c(!0),u("");try{await g({user_id:f.id,name:t.trim(),type:n,color:a}),e()}catch(x){console.error("Error creating category:",x),u(x.message||"Failed to create category. Please try again.")}finally{c(!1)}}};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-900 rounded-t-2xl",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:d.jsx(na,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Create Category"})]}),d.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("form",{onSubmit:b,className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[h&&d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-sm",children:h}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category Name"}),d.jsx("input",{id:"name",type:"text",value:t,onChange:m=>r(m.target.value),placeholder:"e.g., Groceries, Rent, Salary",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-colors duration-200",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Category Type"}),d.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[d.jsxs("button",{type:"button",onClick:()=>i("income"),className:`p-3 sm:p-4 border-2 rounded-lg text-left transition-colors ${n==="income"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,children:[d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[d.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:"Income"})]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Money coming in"})]}),d.jsxs("button",{type:"button",onClick:()=>i("expense"),className:`p-3 sm:p-4 border-2 rounded-lg text-left transition-colors ${n==="expense"?"border-red-500 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,children:[d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[d.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:"Expense"})]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Money going out"})]})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Category Color"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("input",{type:"color",value:a,onChange:m=>o(m.target.value),className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Custom Color"}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Click to choose any color"})]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quick Colors"}),d.jsx("div",{className:"grid grid-cols-8 gap-2",children:p.map(m=>d.jsx("button",{type:"button",onClick:()=>o(m),className:`w-6 h-6 sm:w-8 sm:h-8 rounded-lg border-2 transition-all ${a===m?"border-gray-900 dark:border-gray-100 scale-110":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,style:{backgroundColor:m}},m))})]})]})]}),d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[d.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Preview"}),d.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[d.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:a}}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base",children:t||"Category Name"}),d.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full capitalize",children:n})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 sticky bottom-0 bg-white dark:bg-gray-900 pb-2",children:[d.jsx("button",{type:"button",onClick:s,className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:l||!t.trim(),className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-purple-600 dark:bg-purple-500 text-white rounded-lg font-medium hover:bg-purple-700 dark:hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm sm:text-base",children:l?"Creating...":"Create Category"})]})]})]})})}function Ng({addToast:s}){const e=$e(),{user:t}=e,r=(e==null?void 0:e.isAdmin)??!1,{categories:n,loadData:i,updateCategory:a,deleteCategory:o,exchangeRate:l,setExchangeRate:c}=we(),[h,u]=j.useState(null),[f,g]=j.useState(!0),[p,b]=j.useState(!1),[m,x]=j.useState(!1),[w,y]=j.useState(null),[v,k]=j.useState(""),[N,A]=j.useState(""),[P,F]=j.useState(!1),[E,I]=j.useState(""),[L,z]=j.useState(""),[T,S]=j.useState(""),[D,U]=j.useState("NGN");j.useEffect(()=>{t&&(X(),i(t.id))},[t,i]);const X=async()=>{if(t)try{const{data:O,error:Z}=await J.from("user_profiles").select("*").eq("id",t.id).single();if(Z){console.error("Error loading profile:",Z),s({type:"error",title:"Profile load failed"});return}u(O),S(O.full_name||""),U(O.currency||"NGN")}catch(O){console.error("Error loading profile:",O),s({type:"error",title:"Profile load failed"})}finally{g(!1)}},_=O=>{O==="USD"&&D==="NGN"?(z(O),F(!0),I((l==null?void 0:l.toString())||"")):(O==="NGN"&&D==="USD"&&c(null),U(O))},M=()=>{const O=parseFloat(E);if(!O||O<=0){s({type:"error",title:"Invalid exchange rate"});return}c(O),U(L),F(!1),I(""),z(""),s({type:"success",title:`Exchange rate set to ${O} per $1`})},C=async()=>{if(!(!t||!h)){b(!0);try{const{error:O}=await J.from("user_profiles").update({full_name:T,currency:D,updated_at:new Date().toISOString()}).eq("id",t.id);if(O){console.error("Error saving profile:",O),s({type:"error",title:"Save failed"});return}u(Z=>Z?{...Z,full_name:T,currency:D}:null),s({type:"success",title:"Profile updated"})}catch(O){console.error("Error saving profile:",O),s({type:"error",title:"Save failed"})}finally{b(!1)}}},H=O=>{y(O.id),k(O.name),A(O.color)},le=async O=>{try{const Z=n.find(jo=>jo.id===O);if(!Z)return;const ko={...Z,name:v,color:N};await a(ko),y(null),s({type:"success",title:"Category updated"})}catch(Z){console.error("Error updating category:",Z),s({type:"error",title:"Update failed"})}},ie=async O=>{if(confirm("Are you sure you want to delete this category?"))try{await o(O),s({type:"success",title:"Category deleted"})}catch(Z){console.error("Error deleting category:",Z),s({type:"error",title:"Delete failed"})}},Se=()=>{y(null),k(""),A("")},pe=()=>{x(!1),s({type:"success",title:"Category created"})},Je=n.filter(O=>O.type==="income"),wo=n.filter(O=>O.type==="expense"),_o=[{code:"NGN",name:"Nigerian Naira ()",symbol:""},{code:"USD",name:"US Dollar ($)",symbol:"$"}];return f?d.jsx("div",{className:"p-4 sm:p-6 bg-gray-50 dark:bg-gray-950 min-h-screen transition-colors duration-200",children:d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 dark:border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading settings..."})]})}):r?d.jsxs("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto space-y-6 sm:space-y-8 bg-gray-50 dark:bg-gray-950 min-h-screen transition-colors duration-200",children:[d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 shadow-sm",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[d.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:d.jsx(mn,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Profile Settings"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:"Manage administrator information"})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Full Name"}),d.jsx("input",{id:"fullName",type:"text",value:T,onChange:O=>S(O.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base transition-colors duration-200 placeholder-gray-400 dark:placeholder-gray-500",placeholder:"Enter your full name"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Default Currency"}),d.jsx("select",{id:"currency",value:D,onChange:O=>_(O.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base transition-colors duration-200",children:_o.map(O=>d.jsx("option",{value:O.code,children:O.name},O.code))}),d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[D==="USD"?"Amounts will be displayed in US Dollars":"Amounts will be displayed in Nigerian Naira",D==="USD"&&l&&d.jsxs("span",{className:"block mt-1",children:["Exchange rate: ",l," per $1"]})]})]})]}),d.jsx("div",{className:"flex justify-end mt-6",children:d.jsxs("button",{onClick:C,disabled:p,className:"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(or,{className:"w-4 h-4"}),p?"Saving...":"Save Changes"]})})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 shadow-sm",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:d.jsx(Wo,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Categories"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:"Manage your transaction categories"})]})]}),d.jsxs("button",{onClick:()=>x(!0),className:"bg-gradient-to-r from-purple-600 to-purple-700 dark:from-purple-500 dark:to-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-purple-800 dark:hover:from-purple-600 dark:hover:to-purple-700 transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(wt,{className:"w-4 h-4"}),"Add Category"]})]}),d.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 sm:gap-8",children:[d.jsxs("div",{children:[d.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[d.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),"Income Categories"]}),d.jsx("div",{className:"space-y-3",children:Je.map(O=>d.jsx("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:w===O.id?d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1",children:[d.jsx("input",{type:"color",value:N,onChange:Z=>A(Z.target.value),className:"w-6 h-6 sm:w-8 sm:h-8 rounded border border-gray-300 dark:border-gray-600"}),d.jsx("input",{type:"text",value:v,onChange:Z=>k(Z.target.value),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base transition-colors duration-200"}),d.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[d.jsx("button",{onClick:()=>le(O.id),className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/20 rounded-lg transition-colors",children:d.jsx(or,{className:"w-4 h-4"})}),d.jsx("button",{onClick:Se,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:d.jsx(ye,{className:"w-4 h-4"})})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[d.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:O.color}}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:O.name}),!O.user_id&&d.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded-full whitespace-nowrap",children:"Default"})]}),O.user_id&&d.jsxs("div",{className:"flex gap-1 sm:gap-2 ml-2",children:[d.jsx("button",{onClick:()=>H(O),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:d.jsx(Os,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>ie(O.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:d.jsx(Es,{className:"w-4 h-4"})})]})]})},O.id))})]}),d.jsxs("div",{children:[d.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[d.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),"Expense Categories"]}),d.jsx("div",{className:"space-y-3",children:wo.map(O=>d.jsx("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:w===O.id?d.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1",children:[d.jsx("input",{type:"color",value:N,onChange:Z=>A(Z.target.value),className:"w-6 h-6 sm:w-8 sm:h-8 rounded border border-gray-300 dark:border-gray-600"}),d.jsx("input",{type:"text",value:v,onChange:Z=>k(Z.target.value),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base transition-colors duration-200"}),d.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[d.jsx("button",{onClick:()=>le(O.id),className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/20 rounded-lg transition-colors",children:d.jsx(or,{className:"w-4 h-4"})}),d.jsx("button",{onClick:Se,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:d.jsx(ye,{className:"w-4 h-4"})})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[d.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:O.color}}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:O.name}),!O.user_id&&d.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded-full whitespace-nowrap",children:"Default"})]}),O.user_id&&d.jsxs("div",{className:"flex gap-1 sm:gap-2 ml-2",children:[d.jsx("button",{onClick:()=>H(O),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:d.jsx(Os,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>ie(O.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:d.jsx(Es,{className:"w-4 h-4"})})]})]})},O.id))})]})]})]}),m&&d.jsx(Sg,{onClose:()=>x(!1),onSuccess:pe}),P&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:d.jsx(Zi,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),d.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:"Set Exchange Rate"})]}),d.jsx("button",{onClick:()=>{F(!1),z(""),I("")},className:"w-8 h-8 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:d.jsx(ye,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"p-4 sm:p-6",children:[d.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm sm:text-base mb-4",children:"Please enter the current exchange rate from Naira to USD to help with currency conversion."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{htmlFor:"exchangeRate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Exchange Rate ( per $1)"}),d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:""}),d.jsx("input",{id:"exchangeRate",type:"number",step:"0.01",value:E,onChange:O=>I(O.target.value),placeholder:"1500.00",className:"w-full pl-8 pr-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm sm:text-base transition-colors duration-200"})]}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Example: If $1 = 1,500, enter 1500"})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[d.jsx("button",{onClick:()=>{F(!1),z(""),I("")},className:"flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Cancel"}),d.jsx("button",{onClick:M,disabled:!E||parseFloat(E)<=0,className:"flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 dark:from-green-500 dark:to-green-600 text-white rounded-lg font-medium hover:from-green-700 hover:to-green-800 dark:hover:from-green-600 dark:hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm sm:text-base",children:"Set Rate & Continue"})]})]})]})})]}):d.jsx("div",{className:"p-4 sm:p-6 bg-gray-50 dark:bg-gray-950 min-h-screen transition-colors duration-200",children:d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(mn,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Access Restricted"}),d.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Only administrators can access settings"})]})})}function Cg({id:s,type:e,title:t,message:r,duration:n=4e3,onClose:i}){j.useEffect(()=>{const h=setTimeout(()=>{i(s)},n);return()=>clearTimeout(h)},[s,n,i]);const a={success:Ho,error:qo,warning:Vo,info:Ko},o={success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-700 text-green-800 dark:text-green-300",error:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-700 text-red-800 dark:text-red-300",warning:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700 text-yellow-800 dark:text-yellow-300",info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700 text-blue-800 dark:text-blue-300"},l={success:"text-green-500 dark:text-green-400",error:"text-red-500 dark:text-red-400",warning:"text-yellow-500 dark:text-yellow-400",info:"text-blue-500 dark:text-blue-400"},c=a[e];return d.jsx("div",{className:`max-w-xs sm:max-w-sm w-full ${o[e]} border rounded-lg shadow-lg p-3 sm:p-4 pointer-events-auto transition-colors duration-200`,children:d.jsxs("div",{className:"flex items-start",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsx(c,{className:`h-4 w-4 sm:h-5 sm:w-5 ${l[e]}`})}),d.jsxs("div",{className:"ml-2 sm:ml-3 w-0 flex-1",children:[d.jsx("p",{className:"text-sm font-medium",children:t}),r&&d.jsx("p",{className:"mt-1 text-xs sm:text-sm opacity-90",children:r})]}),d.jsx("div",{className:"ml-2 sm:ml-4 flex-shrink-0 flex",children:d.jsx("button",{onClick:()=>i(s),className:"inline-flex text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors",children:d.jsx(ye,{className:"h-3 w-3 sm:h-4 sm:w-4"})})})]})})}function Ki({toasts:s,onClose:e}){return d.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:d.jsx("div",{className:"flex flex-col items-center space-y-2 max-w-xs sm:max-w-sm w-full px-4",children:s.map(t=>d.jsx(Cg,{...t,onClose:e},t.id))})})}function Gi({pwaHook:s}){const{showInstallPrompt:e,isIOS:t,isAndroid:r,canInstall:n,installApp:i,dismissInstallPrompt:a,timeSpent:o,pagesVisited:l,engagementMet:c}=s;if(!e)return null;const h=async()=>{n&&await i()},u=()=>t?d.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:d.jsxs("p",{children:["To install: Tap ",d.jsx("strong",{children:"Share"}),"  ",d.jsx("strong",{children:"Add to Home Screen"})]})}):null,f=()=>["Instant access from your home screen","Works offline when you're not connected","Faster loading and smoother experience","No browser bars for distraction-free use"];return d.jsx("div",{className:"fixed bottom-20 left-4 right-4 lg:bottom-4 lg:left-auto lg:right-4 lg:max-w-sm z-50 animate-slide-up",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 p-4 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg",children:r||!t&&window.innerWidth<768?d.jsx(Go,{className:"w-6 h-6 text-white"}):d.jsx(Yo,{className:"w-6 h-6 text-white"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("h3",{className:"font-bold text-gray-900 dark:text-white text-base",children:"Install FinTrack App"}),d.jsx("button",{onClick:a,className:"p-1 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0",children:d.jsx(ye,{className:"w-4 h-4"})})]}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Get the full app experience with these benefits:"}),d.jsx("ul",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1 mb-3",children:f().slice(0,2).map((g,p)=>d.jsxs("li",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full flex-shrink-0"}),g]},p))}),d.jsxs("div",{className:"flex items-center gap-3 mb-3 text-xs text-gray-500 dark:text-gray-400",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Jo,{className:"w-3 h-3"}),d.jsxs("span",{children:[o,"s spent"]})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Qi,{className:"w-3 h-3"}),d.jsxs("span",{children:[l," pages viewed"]})]})]}),u()]})]}),n&&!t&&d.jsxs("div",{className:"mt-4 flex gap-2",children:[d.jsxs("button",{onClick:h,className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 text-white px-4 py-2.5 rounded-lg text-sm font-medium hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-600 dark:hover:to-blue-700 transition-all duration-200 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",children:[d.jsx(Xo,{className:"w-4 h-4"}),"Install App"]}),d.jsx("button",{onClick:a,className:"px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm font-medium transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:"Later"})]}),t&&d.jsx("div",{className:"mt-4 flex justify-end",children:d.jsx("button",{onClick:a,className:"px-4 py-2.5 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm font-medium transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:"Got it"})})]})})}function Yi({isAppInstalled:s,newServiceWorker:e}){const[t,r]=j.useState(!1);j.useEffect(()=>{e&&r(!0)},[e]);const n=()=>{e&&(e.postMessage({type:"SKIP_WAITING"}),r(!1),window.location.reload())},i=()=>{r(!1)};return!t||!s||!e?null:d.jsx("div",{className:"fixed top-4 left-4 right-4 lg:left-auto lg:right-4 lg:max-w-sm z-50 animate-slide-up",children:d.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-green-700 dark:from-green-500 dark:to-green-600 rounded-lg flex items-center justify-center flex-shrink-0",children:d.jsx(As,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:"Update Available"}),d.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"A new version of FinTrack is ready to install"})]}),d.jsx("button",{onClick:i,className:"p-1 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0",children:d.jsx(ye,{className:"w-4 h-4"})})]}),d.jsxs("div",{className:"mt-3 flex gap-2",children:[d.jsxs("button",{onClick:n,className:"flex-1 bg-gradient-to-r from-green-600 to-green-700 dark:from-green-500 dark:to-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium hover:from-green-700 hover:to-green-800 dark:hover:from-green-600 dark:hover:to-green-700 transition-all duration-200 flex items-center justify-center gap-2",children:[d.jsx(As,{className:"w-4 h-4"}),"Update Now"]}),d.jsx("button",{onClick:i,className:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm font-medium transition-colors",children:"Later"})]})]})})}function Tg(){const[s,e]=j.useState("dashboard"),[t,r]=j.useState(!1),[n,i]=j.useState(!1),a=$e(),{user:o,loading:l,initialize:c}=a,h=(a==null?void 0:a.isAdmin)??!1,{updateSyncStatus:u}=we(),{toasts:f,addToast:g,removeToast:p}=Ud();Da();const b=zd(s);if(j.useEffect(()=>{c(),ee()},[c]),j.useEffect(()=>{const y=setInterval(u,5e3);return()=>clearInterval(y)},[u]),j.useEffect(()=>{const y=new URLSearchParams(window.location.search),v=y.get("action"),k=y.get("tab");v==="add-transaction"&&o&&i(!0),k&&o&&e(k)},[o]),l)return d.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center transition-colors duration-200",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 dark:border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})});if(!o)return d.jsxs(d.Fragment,{children:[d.jsx(Wd,{}),d.jsx(Ki,{toasts:f,onClose:p}),d.jsx(Gi,{pwaHook:b}),d.jsx(Yi,{isAppInstalled:b.isInstalled,newServiceWorker:b.newWorker})]});const m=()=>{switch(s){case"dashboard":return"Dashboard";case"accounts":return"Accounts";case"transactions":return"Transactions";case"settings":return"Settings";default:return"Dashboard"}},x=()=>{const y={addToast:g};switch(s){case"dashboard":return d.jsx(Vi,{...y});case"accounts":return d.jsx(_g,{...y});case"transactions":return d.jsx(jg,{...y});case"settings":return d.jsx(Ng,{...y});default:return d.jsx(Vi,{...y})}},w=()=>{i(!1),g({type:"success",title:"Transaction added"})};return d.jsxs("div",{className:"h-screen bg-gray-50 dark:bg-gray-950 flex transition-colors duration-200",children:[t&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>r(!1)}),d.jsx("div",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ease-in-out lg:transform-none
        ${t?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,children:d.jsx(Hd,{activeTab:s,onTabChange:y=>{e(y),r(!1)},isAdmin:h})}),d.jsxs("div",{className:"flex-1 flex flex-col min-w-0 lg:ml-0",children:[d.jsx(qd,{title:m(),onMenuClick:()=>r(!0)}),d.jsxs("main",{className:"flex-1 overflow-auto relative",children:[d.jsx("div",{className:"min-h-full",children:x()}),d.jsx("div",{className:"px-4 sm:px-6 py-3 mb-16 lg:mb-0",children:d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["ChurchTrack ver. 1.2.0 by"," ",d.jsx("a",{href:"https://elxis.com.ng",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors",children:"eLxis"})]})})]})]}),d.jsx(Vd,{activeTab:s,onTabChange:e,onAddTransaction:()=>i(!0),isAdmin:h}),n&&h&&d.jsx(vo,{onClose:()=>i(!1),onSuccess:w}),d.jsx(Gi,{pwaHook:b}),d.jsx(Yi,{isAppInstalled:b.isInstalled,newServiceWorker:b.newWorker}),d.jsx(Ki,{toasts:f,onClose:p})]})}oa(document.getElementById("root")).render(d.jsx(j.StrictMode,{children:d.jsx(Tg,{})}));
